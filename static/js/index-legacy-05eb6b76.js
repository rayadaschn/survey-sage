System.register(["./@ant-design/icons-legacy-2c3aafc8.js","./antd-legacy-e0f0c6fc.js","./react-redux-legacy-e5816d77.js","./@reduxjs/toolkit-legacy-35d123f6.js","./lodash-es-legacy-e3523841.js","./react-router-dom-legacy-cd50fcd0.js","./axios-legacy-787fab56.js","./ahooks-legacy-286c294c.js","./redux-undo-legacy-0558ac97.js"],(function(e,s){"use strict";var t,n,r,a,i,l,c,o,d,x,m,u,p,h,j,f,g,v,y,b,w,C,k,N,S,I,_,P,L,E,F,q,R,z,T,$,O,D,U,A,V,H,M,B,W,K,G,J,Y,Q,X,Z,ee,se,te,ne,re,ae,ie,le,ce,oe,de,xe,me,ue,pe,he,je;return{setters:[e=>{t=e.r,n=e.ae,r=e.af,a=e.U,i=e.M,l=e.ag,c=e.ah,o=e.ai,d=e.ac,x=e.aj,m=e.ad,u=e.ak,p=e.W,h=e.al,j=e.am,f=e.an,g=e.K,v=e.ao,y=e.ap,b=e.O,w=e.aq,C=e.z,k=e.ar,N=e.as,S=e.R},e=>{I=e.r,_=e.S,P=e.T,L=e.m,E=e.B,F=e.L,q=e.a,R=e.D,z=e.F,T=e.I,$=e.R,O=e.b,D=e.P,U=e.M,A=e.E,V=e.c,H=e.d,M=e.e,B=e.f,W=e.C,K=e.g,G=e.h,J=e.t},e=>{Y=e.u,Q=e.a,X=e.P},e=>{Z=e.c,ee=e.p,se=e.a},e=>{te=e.c},e=>{ne=e.L,re=e.u,ae=e.a,ie=e.b,le=e.c,ce=e.O,oe=e.d,de=e.R},e=>{xe=e.a},e=>{me=e.u,ue=e.a,pe=e.b,he=e.c},e=>{je=e.M}],execute:function(){var e=document.createElement("style");e.textContent='#--unocss--{layer:__ALL__}:root{--w-space-xs: 8px;--w-space-sm: 16px;--w-space: 24px;--w-space-lg: 32px;--w-radius-xs: 4px;--w-radius: 8px;--w-radius-lg: 12px;--w-radius-xl: 16px;--c-white: #fff;--c-black: #000;--c-blue: #3b82f6;--c-red: #ef4444;--c-yellow: #f59e0b;--c-green: #42b983;--c-gray: #9ca3af;--c-disable: rgba(0, 0, 0, .25);--c-brand: var(--c-green);--c-bg: #f8f8f8;--c-text: #374151;--c-tips: var(--c-gray);--c-border: var(--c-gray);--c-mask: rgba(0, 0, 0, .7);--c-hover: var(--c-brand)}:root.dark{--c-bg: #181818;--c-text: #e5e7eb}html{width:100%;overflow-x:hidden}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:"tnum";font-variant:tabular-nums;background-color:var(--c-bg);margin:0}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-thumb{background-color:#374151;border-radius:4px}::-webkit-scrollbar-thumb:hover{background-color:#1f2937}::-webkit-scrollbar-track{background-color:#6b7280;border-radius:4px}._container_1fxih_1 h1{font-size:28px;color:#f7f7f7}\n',document.head.appendChild(e);var s={exports:{}},fe={},ge=t,ve=Symbol.for("react.element"),ye=Symbol.for("react.fragment"),be=Object.prototype.hasOwnProperty,we=ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ce={key:!0,ref:!0,__self:!0,__source:!0};function ke(e,s,t){var n,r={},a=null,i=null;for(n in void 0!==t&&(a=""+t),void 0!==s.key&&(a=""+s.key),void 0!==s.ref&&(i=s.ref),s)be.call(s,n)&&!Ce.hasOwnProperty(n)&&(r[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===r[n]&&(r[n]=s[n]);return{$$typeof:ve,type:e,key:a,ref:i,props:r,_owner:we.current}}fe.Fragment=ye,fe.jsx=ke,fe.jsxs=ke,s.exports=fe;var Ne=s.exports,Se={},Ie=I;Se.createRoot=Ie.createRoot,Se.hydrateRoot=Ie.hydrateRoot;const _e={username:"",nickname:""},Pe=Z({name:"user",initialState:_e,reducers:{loginReducer:(e,s)=>s.payload,logoutReducer:()=>_e}}),Le=Pe.reducer,{loginReducer:Ee,logoutReducer:Fe}=Pe.actions,qe=Z({name:"pageInfo",initialState:{title:"",desc:"",js:"",css:""},reducers:{resetPageInfo:(e,s)=>s.payload}}),Re=qe.reducer,{resetPageInfo:ze}=qe.actions;let Te=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,s)=>e+=(s&=63)<36?s.toString(36):s<62?(s-26).toString(36).toUpperCase():s>62?"-":"_"),"");function $e(e,s){const t=s.filter((e=>!e.isHidden)),n=t.findIndex((s=>s.fe_id===e));if(n<0)return"";let r="";const a=t.length;return r=a<=1?"":n+1===a?t[n-1].fe_id:t[n+1].fe_id,r}function Oe(e,s){const{selectedId:t,componentList:n}=e,r=n.findIndex((e=>e.fe_id===t));r<0?e.componentList.push(s):e.componentList.splice(r+1,0,s),e.selectedId=s.fe_id}const De=Z({name:"components",initialState:{componentList:[],selectedId:"",copiedComponent:null},reducers:{resetComponents:(e,s)=>s.payload,changeSelectedId:ee(((e,s)=>{e.selectedId=s.payload})),addComponent:ee(((e,s)=>{Oe(e,s.payload)})),changeComponentProps:ee(((e,s)=>{const{fe_id:t,newProps:n}=s.payload,r=e.componentList.find((e=>e.fe_id===t));r&&(r.props={...r.props,...n})})),removeSelectedComponent:ee((e=>{const{componentList:s=[],selectedId:t}=e,n=$e(t,s);e.selectedId=n;const r=s.findIndex((e=>e.fe_id===t));s.splice(r,1)})),changeComponentHidden:ee(((e,s)=>{const{componentList:t=[]}=e,{fe_id:n,isHidden:r}=s.payload;let a="";a=r?$e(n,t):n,e.selectedId=a;const i=t.find((e=>e.fe_id===n));i&&(i.isHidden=r)})),toggleComponentLocked:ee(((e,s)=>{const{fe_id:t}=s.payload,n=e.componentList.find((e=>e.fe_id===t));n&&(n.isLocked=!n.isLocked)})),copySelectedComponent:ee((e=>{const{selectedId:s,componentList:t=[]}=e,n=t.find((e=>e.fe_id===s));null!=n&&(e.copiedComponent=te(n))})),pasteCopiedComponent:ee((e=>{const{copiedComponent:s}=e;null!=s&&(s.fe_id=Te(),Oe(e,s))})),selectPrevComponent:ee((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n<=0||(e.selectedId=t[n-1].fe_id)})),selectNextComponent:ee((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n+1!==t.length&&(e.selectedId=t[n+1].fe_id)})),changeComponentTitle:ee(((e,s)=>{const{title:t,fe_id:n}=s.payload,r=e.componentList.find((e=>e.fe_id===n));r&&(r.title=t)})),moveComponent:ee(((e,s)=>{s.payload}))}}),{resetComponents:Ue,changeSelectedId:Ae,addComponent:Ve,changeComponentProps:He,removeSelectedComponent:Me,changeComponentHidden:Be,toggleComponentLocked:We,copySelectedComponent:Ke,pasteCopiedComponent:Ge,selectPrevComponent:Je,selectNextComponent:Ye,changeComponentTitle:Qe,moveComponent:Xe}=De.actions,Ze=De.reducer,es=se({reducer:{user:Le,pageInfo:Re,components:Ze}}),ss="_container_1fxih_1",{Title:ts}=P,ns=()=>Ne.jsx("div",{children:Ne.jsx(ne,{to:"/",children:Ne.jsxs(_,{className:ss,children:[Ne.jsx(ts,{children:Ne.jsx(n,{})}),Ne.jsx(ts,{children:"问卷调查"})]})})}),rs="USER_TOKEN",as=()=>document.activeElement===document.body;function is(){const e=Q((e=>e.components)),{componentList:s=[],selectedId:t,copiedComponent:n}=e,r=s.find((e=>e.fe_id===t));return{componentList:s,selectedId:t,selectedComponent:r,copiedComponent:n}}function ls(){const{username:e,nickname:s}=Q((e=>e.user));return{username:e,nickname:s}}const cs="keyword",os="page",ds="pageSize",xs=xe.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});async function ms(){return await xs.post("/api/question/")}async function us(e={}){return await xs.get("/api/question",{params:e})}async function ps(e,s){const t=`/api/question/${e}`;return await xs.patch(t,s)}async function hs(){return await xs.get("/api/user/info")}function js(){const{id:e=""}=re(),s=Y(),{data:n,loading:r,error:a,run:i}=ue((async e=>{if(!e)throw new Error("缺少问卷 id");const s=await async function(e){const s=`/api/question/${e}`;return await xs.get(s)}(e);return s}),{manual:!0});return t.useEffect((()=>{if(!n)return;const{title:e="",desc:t="",js:r="",css:a="",componentList:i=[]}=n;let l="";i.length>0&&(l=i[0].fe_id),s(Ue({componentList:i,selectedId:l,copiedComponent:null})),s(ze({title:e,desc:t,js:r,css:a}))}),[n]),t.useEffect((()=>{i(e)}),[e]),{loading:r,error:a}}function fs(e={}){const{isStar:s,isDeleted:t}=e,[n]=ae(),{data:r,loading:a,error:i,refresh:l}=ue((async()=>{const e=n.get(cs)||"",r=parseInt(n.get(os)||"")||1,a=parseInt(n.get(ds)||"")||10;return await us({keyword:e,isStar:s,isDeleted:t,page:r,pageSize:a})}),{refreshDeps:[n]});return{data:r,loading:a,error:i,refresh:l}}function gs(){const e=Y(),[s,n]=t.useState(!0),{run:r}=ue(hs,{manual:!0,onSuccess(s){const{username:t,nickname:n}=s;e(Ee({username:t,nickname:n}))},onFinally(){n(!1)}}),{username:a}=ls();return t.useEffect((()=>{a?n(!1):r()}),[s]),{waitingUserData:s}}function vs(e){const{username:s}=ls(),{pathname:n}=ie(),r=le();t.useEffect((()=>{e||(s?function(e){return[ft,gt].includes(e)}(n)&&r(vt):function(e){return[jt,ft,gt].includes(e)}(n)||r(ft))}),[e,s,n])}xs.interceptors.request.use((e=>(e.headers.Authorization=`Bearer ${localStorage.getItem(rs)||""}`,e)),(e=>(L.error(e.message),Promise.reject(e)))),xs.interceptors.response.use((e=>{const s=e.data||{},{errno:t,data:n,msg:r}=s;return 203===t||0!==t&&200!==t?(L.error(r||"请求失败"),Promise.reject(n)):n}),(e=>{let s="";const t=e.response?.status;switch(t){case 401:s="token 失效，请重新登录";break;case 403:s="拒绝访问";break;case 404:s="请求地址错误";break;case 500:s="服务器故障";break;default:s="网络连接故障"}return L.error(s),Promise.reject(e)}));const ys=()=>{const e=le(),s=Y(),{username:t,nickname:n}=ls(),a=Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("span",{className:"color-light",children:[Ne.jsx(r,{}),n]}),Ne.jsx(E,{type:"link",onClick:function(){s(Fe()),localStorage.removeItem(rs),L.success("退出成功"),e(ft)},children:"退出"})]}),i=Ne.jsx(ne,{to:ft,children:"登录"});return Ne.jsx(Ne.Fragment,{children:t?a:i})},{Header:bs,Content:ws,Footer:Cs}=F,ks=()=>{const{waitingUserData:e}=gs();return vs(e),Ne.jsxs(F,{children:[Ne.jsxs(bs,{className:"px-6",children:[Ne.jsx("div",{className:"float-left",children:Ne.jsx(ns,{})}),"MainLayout header",Ne.jsx("div",{className:"float-right",children:Ne.jsx(ys,{})})]}),Ne.jsx(ws,{className:"min-h-[calc(100vh-140px)]",children:e?Ne.jsx("div",{className:"mt-15 text-center",children:Ne.jsx(q,{})}):Ne.jsx(ce,{})}),Ne.jsx(Cs,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"问卷调查@2023 Created by Huy"})]})},Ns=()=>{const e=le(),{pathname:s}=ie(),{loading:t,run:n}=ue(ms,{manual:!0,onSuccess(s){e(`question/edit/${s.id}`),L.success("创建成功")}});return Ne.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[Ne.jsx("div",{className:"w-30",children:Ne.jsxs(_,{direction:"vertical",children:[Ne.jsx(E,{type:"primary",size:"large",icon:Ne.jsx(a,{}),onClick:n,disabled:t,children:"新建问卷"}),Ne.jsx(R,{}),Ne.jsx(E,{type:s.startsWith("/manage/list")?"default":"text",size:"large",icon:Ne.jsx(i,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),Ne.jsx(E,{type:s.startsWith("/manage/star")?"default":"text",size:"large",icon:Ne.jsx(l,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),Ne.jsx(E,{type:s.startsWith("/manage/trash")?"default":"text",size:"large",icon:Ne.jsx(c,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),Ne.jsx("div",{className:"ml-15 flex-1",children:Ne.jsx(ce,{})})]})},Ss=()=>{const{waitingUserData:e}=gs();return vs(e),Ne.jsx("div",{className:"h-screen",children:e?Ne.jsx("div",{className:"mt-15 text-center",children:Ne.jsx(q,{})}):Ne.jsx(ce,{})})},{Title:Is}=P,_s=()=>{const e=le(),{run:s}=ue((async e=>{const{username:s,password:t,nickname:n}=e;await async function(e,s,t){const n={username:e,password:s,nickname:t||e};return await xs.post("/api/user/register",n)}(s,t,n)}),{manual:!0,onSuccess(){L.success("注册成功"),e(ft)}});return Ne.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[Ne.jsx("div",{children:Ne.jsxs(_,{children:[Ne.jsx(Is,{level:2,children:Ne.jsx(o,{})}),Ne.jsx(Is,{level:2,children:"注册新用户"})]})}),Ne.jsx("div",{children:Ne.jsxs(z,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{s(e)},children:[Ne.jsx(z.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:Ne.jsx(T,{})}),Ne.jsx(z.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:Ne.jsx(T.Password,{})}),Ne.jsx(z.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(s,t)=>t&&e("password")!==t?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:Ne.jsx(T.Password,{})}),Ne.jsx(z.Item,{label:"昵称",name:"nickname",children:Ne.jsx(T,{})}),Ne.jsx(z.Item,{wrapperCol:{offset:4,span:18},children:Ne.jsxs(_,{children:[Ne.jsx(E,{type:"primary",htmlType:"submit",children:"注册"}),Ne.jsx(ne,{to:ft,children:"已有账户，请登录"})]})})]})})]})},Ps=()=>{const e=le();return Ne.jsx(Ne.Fragment,{children:Ne.jsx($,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:Ne.jsx(E,{type:"primary",onClick:()=>e(vt),children:"返回首页"})})})},{confirm:Ls}=U,Es=e=>{const s=le(),{_id:n,title:r,isPublished:a,answerContent:i,currentAt:o,isStar:p}=e,[h,j]=t.useState(p),{loading:f,run:g}=ue((async()=>{await ps(n,{isStar:!h})}),{manual:!0,onSuccess(){j(!h),L.success("已更新")}}),{loading:v,run:y}=ue((async()=>await async function(e){const s=`/api/question/duplicate/${e}`;return await xs.post(s)}(n)),{manual:!0,onSuccess(e){L.success("复制成功"),s(`/question/edit/${e.id}`)}}),[b,w]=t.useState(!1),{loading:C,run:k}=ue((async()=>await ps(n,{isDeleted:!0})),{manual:!0,onSuccess(){L.success("删除成功"),w(!0)}});return b?null:Ne.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[Ne.jsxs("div",{className:"flex",children:[Ne.jsx("div",{className:"flex-1",children:Ne.jsx(ne,{to:a?`/question/stat/${n}`:`/question/edit/${n}`,children:Ne.jsxs(_,{children:[p&&Ne.jsx(l,{style:{color:"red"}}),r]})})}),Ne.jsx("div",{className:"flex-1 text-center font-size-3",children:Ne.jsxs(_,{children:[a?Ne.jsx(O,{color:"processing",children:"已发布"}):Ne.jsx(O,{children:"未发布"}),Ne.jsxs("span",{children:["答卷: ",i]}),Ne.jsx("span",{children:o})]})})]}),Ne.jsx(R,{className:"m-3"}),Ne.jsxs("div",{className:"flex",children:[Ne.jsx("div",{className:"flex-1",children:Ne.jsxs(_,{children:[Ne.jsx(E,{icon:Ne.jsx(d,{}),type:"text",size:"small",onClick:()=>{s(`/question/edit/${n}`)},children:"编辑问卷"}),Ne.jsx(E,{icon:Ne.jsx(x,{}),type:"text",size:"small",onClick:()=>{s(`/question/stat/${n}`)},children:"数据统计"})]})}),Ne.jsx("div",{className:"flex-1 text-center",children:Ne.jsxs(_,{children:[Ne.jsx(E,{type:"text",icon:Ne.jsx(l,{}),color:"#999",size:"small",onClick:g,disabled:f,children:h?"取消标星":"标星"}),Ne.jsx(D,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:y,children:Ne.jsx(E,{type:"text",icon:Ne.jsx(m,{}),color:"#999",size:"small",disabled:v,children:"复制"})}),Ne.jsx(E,{type:"text",icon:Ne.jsx(c,{}),size:"small",color:"#999",onClick:()=>{Ls({title:"确定删除该问卷?",icon:Ne.jsx(u,{}),onOk:k})},disabled:C,children:"删除"})]})})]})]})},{Search:Fs}=T,qs=()=>{const e=le(),{pathname:s}=ie(),[n,r]=t.useState(""),[a]=ae();return t.useEffect((()=>{const e=a.get(cs)||"";r(e)}),[a]),Ne.jsx(Fs,{placeholder:"请输入关键字",value:n,onChange:function(e){r(e.target.value)},onSearch:function(t){e({pathname:s,search:`${cs}=${t}`})},className:"w-50"})},{Title:Rs}=P,zs=()=>{const[e,s]=t.useState(!1),[n,r]=t.useState(1),[a,i]=t.useState([]),[l,c]=t.useState(0),o=l>a.length,[d]=ae(),x=d.get(cs)||"";t.useEffect((()=>{s(!1),r(1),i([]),c(0)}),[x]);const{run:m,loading:u}=ue((async()=>await us({page:n,pageSize:10,keyword:x})),{manual:!0,onSuccess(e){const{list:s=[],total:t=0}=e;i(a.concat(s)),c(t),r(n+1)}}),p=t.useRef(null),{run:h}=pe((()=>{const e=p.current;if(null==e)return;const t=e.getBoundingClientRect();if(null==t)return;const{bottom:n}=t;n<=document.body.clientHeight&&(m(),s(!0))}),{wait:1e3});t.useEffect((()=>{h()}),[d]),t.useEffect((()=>(o&&window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)})),[d,o]);const j=t.useMemo((()=>!e||u?Ne.jsx(q,{}):0===l?Ne.jsx(A,{description:"暂无数据"}):o?Ne.jsx("span",{children:"开始加载下一页"}):Ne.jsx("span",{children:"没有更多了..."})),[e,u,o]);return Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"flex",children:[Ne.jsx("div",{className:"flex-1",children:Ne.jsx(Rs,{level:3,children:"我的问卷"})}),Ne.jsx("div",{className:"flex-1 text-center",children:Ne.jsx(qs,{})})]}),Ne.jsx("div",{className:"mb-5",children:a.length>0&&a.map((e=>{const{_id:s}=e;return Ne.jsx(Es,{...e},s)}))}),Ne.jsx("div",{className:"text-center color-blue",children:Ne.jsx("div",{ref:p,children:j})})]})},Ts=e=>{const{total:s}=e,[n,r]=t.useState(1),[a,i]=t.useState(10),[l]=ae();t.useEffect((()=>{const e=parseInt(l.get(os)||"")||1;r(e);const s=parseInt(l.get(ds)||"")||10;i(s)}),[l]);const c=le(),{pathname:o}=ie();return Ne.jsx(V,{current:n,pageSize:a,total:s,onChange:(e,s)=>{l.set(os,e.toString()),l.set(ds,s.toString()),c({pathname:o,search:l.toString()})}})},{Title:$s}=P,{confirm:Os}=U,Ds=()=>{he("问卷调查");const{data:e={},loading:s,refresh:n}=fs({isDeleted:!0}),{list:r=[],total:a=0}=e,[i,l]=t.useState([]),c=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?Ne.jsx(O,{color:"processing",children:"已发布"}):Ne.jsx(O,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:o}=ue((async()=>{for await(const e of i)await ps(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){L.success("恢复成功"),n(),l([])}}),{run:d}=ue((async()=>await async function(e){return await xs.delete("/api/question",{data:{ids:e}})}(i)),{manual:!0,onSuccess(){L.success("删除成功"),n(),l([])}});return Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"flex",children:[Ne.jsx("div",{className:"flex-1",children:Ne.jsx($s,{level:3,children:"回收站"})}),Ne.jsx("div",{className:"flex-1 text-center",children:Ne.jsx(qs,{})})]}),Ne.jsxs("div",{className:"mb-5",children:[s&&Ne.jsx("div",{className:"text-center",children:Ne.jsx(q,{})}),!s&&0===r.length&&Ne.jsx(A,{description:"暂无数据"}),r.length>0&&Ne.jsxs("div",{children:[Ne.jsxs(_,{className:"mb",children:[Ne.jsx(E,{type:"primary",disabled:0===i.length,onClick:o,children:"恢复"}),Ne.jsx(E,{danger:!0,disabled:0===i.length,onClick:()=>{Os({title:"确定彻底删除该问卷?",icon:Ne.jsx(u,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),Ne.jsx(H,{rowKey:e=>e._id,dataSource:r,columns:c,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{l(e)}}})]})]}),Ne.jsx("div",{className:"text-center color-blue",children:r.length>0&&Ne.jsx(Ts,{total:a})})]})},{Title:Us}=P,As=()=>{const{data:e={},loading:s}=fs({isStar:!0}),{list:t=[],total:n=0}=e;return Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{className:"flex",children:[Ne.jsx("div",{className:"flex-1",children:Ne.jsx(Us,{level:3,children:"星标问卷"})}),Ne.jsx("div",{className:"flex-1 text-center",children:Ne.jsx(qs,{})})]}),Ne.jsxs("div",{className:"mb-5",children:[s&&Ne.jsx("div",{className:"text-center",children:Ne.jsx(q,{})}),!s&&0===t.length&&Ne.jsx(A,{description:"暂无数据"}),t.length>0&&t.map((e=>{const{_id:s}=e;return Ne.jsx(Es,{...e},s)}))]}),Ne.jsx("div",{className:"text-center color-blue",children:t.length>0&&Ne.jsx(Ts,{total:n})})]})},Vs=()=>{const e=Y(),{selectedId:s,componentList:t,selectedComponent:n,copiedComponent:r}=is(),a=t.findIndex((e=>e.fe_id===s)),i=a<=0,l=a+1>=t.length,o=n?.isLocked?"primary":"default",d=[{title:"删除",shape:"circle",icon:Ne.jsx(c,{}),onClick:()=>{e(Me())}},{title:"隐藏",shape:"circle",icon:Ne.jsx(p,{}),onClick:()=>{e(Be({fe_id:s,isHidden:!0}))}},{title:"锁定",type:o,shape:"circle",icon:Ne.jsx(h,{}),onClick:()=>{e(We({fe_id:s}))}},{title:"复制",shape:"circle",icon:Ne.jsx(m,{}),onClick:()=>{e(Ke())}},{title:"粘贴",shape:"circle",icon:Ne.jsx(j,{}),onClick:()=>{e(Ge())},disabled:null==r},{title:"上移",shape:"circle",icon:Ne.jsx(f,{}),onClick:()=>{i||e(Xe({oldIndex:a,newIndex:a-1}))},disabled:i},{title:"下移",shape:"circle",icon:Ne.jsx(g,{}),onClick:()=>{l||e(Xe({oldIndex:a,newIndex:a+1}))},disabled:l},{title:"撤销",shape:"circle",icon:Ne.jsx(v,{}),onClick:()=>{e(je.undo())}},{title:"重做",shape:"circle",icon:Ne.jsx(y,{}),onClick:()=>{e(je.redo())}}];return Ne.jsx(_,{children:d.map((e=>{const{title:s,type:t,shape:n,icon:r,onClick:a,disabled:i}=e;return Ne.jsx(M,{title:s,children:Ne.jsx(E,{type:t,shape:n,icon:r,onClick:a,disabled:i})},s)}))})},Hs=()=>{const e=le();return Ne.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[Ne.jsx("div",{className:"flex-1",children:Ne.jsxs(_,{children:[Ne.jsx(E,{type:"link",icon:Ne.jsx(b,{}),onClick:()=>e(-1),children:"返回"}),Ne.jsx("div",{className:"mb-0 text-[18px] leading-none",children:"标题"})]})}),Ne.jsx("div",{className:"flex-1 text-center leading-[2]",children:Ne.jsx(Vs,{})}),Ne.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:Ne.jsxs(_,{children:[Ne.jsx(E,{children:"保存"}),Ne.jsx(E,{type:"primary",children:"发布"})]})})]})},Ms={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Bs}=P,Ws={title:"输入框",type:"questionInput",Component:e=>{const{title:s,placeholder:t}={...Ms,...e};return Ne.jsxs("div",{children:[Ne.jsx(Bs,{strong:!0,children:s}),Ne.jsx("div",{children:Ne.jsx(T,{placeholder:t})})]})},PropComponent:e=>{const{title:s,placeholder:n,onChange:r,disabled:a}=e,[i]=z.useForm();return t.useEffect((()=>{i.setFieldsValue({title:s,placeholder:n})}),[s,n]),Ne.jsxs(z,{layout:"vertical",initialValues:{title:s,placeholder:n},form:i,onValuesChange:function(){r&&r(i.getFieldsValue())},disabled:a,children:[Ne.jsx(z.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:Ne.jsx(T,{})}),Ne.jsx(z.Item,{label:"Placeholder",name:"placeholder",children:Ne.jsx(T,{})})]})},defaultProps:Ms},Ks={text:"一级标题",level:1,isCenter:!1},{Title:Gs}=P,Js=[Ws,{title:"标题",type:"questionTitle",Component:e=>{const{text:s="",level:t=1,isCenter:n=!1}={...Ks};return Ne.jsx(Gs,{level:t,style:{textAlign:n?"center":"start",marginBottom:"0",fontSize:(r=t,1===r?"24px":2===r?"20px":"16px")},children:s});var r},PropComponent:e=>{const{text:s,level:n,isCenter:r,onChange:a,disabled:i}=e,[l]=z.useForm();return t.useEffect((()=>{l.setFieldsValue({text:s,level:n,isCenter:r})}),[s,n,r]),Ne.jsxs(z,{form:l,layout:"vertical",onValuesChange:function(){a&&a(l.getFieldsValue())},initialValues:{text:s,level:n,isCenter:r},disabled:i,children:[Ne.jsx(z.Item,{label:"标题内容",name:"text",rules:[{required:!0,message:"请输入标题内容"}],children:Ne.jsx(T,{})}),Ne.jsx(z.Item,{label:"层级",name:"level",children:Ne.jsx(B,{options:[{value:1,text:1},{value:2,text:2},{value:3,text:3}]})}),Ne.jsx(z.Item,{name:"isCenter",valuePropName:"checked",children:Ne.jsx(W,{children:"居中显示"})})]})},defaultProps:Ks}],Ys=[{groupId:"inputGroup",groupName:"用户输入",components:[Ws]}];function Qs(e){return Js.find((s=>s.type===e))}const{Title:Xs}=P,Zs=()=>Ne.jsx(Ne.Fragment,{children:Ys.map(((e,s)=>{const{groupId:n,groupName:r,components:a}=e;return Ne.jsxs("div",{children:[Ne.jsx(Xs,{level:3,style:{fontSize:"16px",marginTop:s>0?"20px":"0"},children:r}),Ne.jsx("div",{children:a.map((e=>(e=>{const{title:s,type:n,Component:r,defaultProps:a}=e,i=Y(),l=t.useCallback((()=>{i(Ve({fe_id:Te(),title:s,type:n,props:a}))}),[]);return Ne.jsx("div",{onClick:l,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:Ne.jsx("div",{className:"pointer-events-none",children:Ne.jsx(r,{})})},n)})(e)))})]},n)}))}),et=()=>Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{children:"layers"})," "]}),st=()=>{const e=[{key:"componentLib",label:Ne.jsxs("span",{children:[Ne.jsx(w,{}),"组件库"]}),children:Ne.jsx(Zs,{})},{key:"layers",label:Ne.jsxs("span",{children:[Ne.jsx(i,{}),"组件库"]}),children:Ne.jsx(et,{})}];return Ne.jsx(Ne.Fragment,{children:Ne.jsx(K,{items:e,defaultActiveKey:"componentLib"})})},tt=({loading:e})=>{const{componentList:s,selectedIs:t}=is(),n=Y();if(function(){const e=Y();me(["backspace","delete"],(()=>{as()&&e(Me())})),me(["ctrl.c","meta.c"],(()=>{as()&&e(Ke())})),me(["ctrl.v","meta.v"],(()=>{as()&&e(Ge())})),me("uparrow",(()=>{as()&&e(Je())})),me("downarrow",(()=>{as()&&e(Ye())})),me(["ctrl.z","meta.z"],(()=>{as()&&e(je.undo())}),{exactMatch:!0}),me(["ctrl.shift.z","meta.shift.z"],(()=>{as()&&e(je.redo())}))}(),e)return Ne.jsx("div",{className:"mt-6 text-center",children:Ne.jsx(q,{})});const r=e=>{const{type:s,props:t}=e,n=Qs(s);if(null==n)return null;const{Component:r}=n;return Ne.jsx(r,{...t})};return Ne.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:s.map((e=>{const{fe_id:s}=e,t=C({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return Ne.jsx("div",{className:t,onClick:e=>{return t=s,e.stopPropagation(),void n(Ae(t));var t},children:Ne.jsx("div",{className:"pointer-events-none",children:r(e)})},s)}))})},nt=()=>Ne.jsx("div",{className:"text-center",children:"未选中组件"}),rt=()=>{const e=Y(),{selectedComponent:s}=is();if(null==s)return Ne.jsx(nt,{});const{type:t,props:n}=s,r=Qs(t);if(null==r)return Ne.jsx(nt,{});const{PropComponent:a}=r;return Ne.jsx(a,{...n,onChange:t=>{const{fe_id:n}=s;e(He({fe_id:n,newProps:t}))}})},at=()=>{const[e,s]=t.useState("prop"),{selectedId:n}=is();t.useEffect((()=>{s(n?"prop":"setting")}),[n]);const r=[{key:"prop",label:Ne.jsxs("span",{children:[Ne.jsx(k,{}),"属性"]}),children:Ne.jsx(rt,{})},{key:"setting",label:Ne.jsxs("span",{children:[Ne.jsx(N,{}),"页面设置"]}),children:Ne.jsx("div",{children:"页面设置"})}];return Ne.jsx(K,{activeKey:e,items:r})},it=()=>{const{loading:e}=js(),{title:s}=Q((e=>e.pageInfo));return he(`问卷编辑 - ${s}`),Ne.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[Ne.jsx(Hs,{}),Ne.jsx("div",{className:"flex-1 py-3",children:Ne.jsxs("div",{className:"mx-6 h-100% flex",children:[Ne.jsx("div",{className:"w-75 bg-white px-3",children:Ne.jsx(st,{})}),Ne.jsx("div",{className:"relative flex-1 overflow-hidden",children:Ne.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:Ne.jsx(tt,{loading:e})})}),Ne.jsx("div",{className:"w-75 bg-white px-3",children:Ne.jsx(at,{})})]})})]})},lt=()=>{const{loading:e,questionData:s}=js();return Ne.jsxs("div",{children:[Ne.jsx("p",{children:"Stat"}),e?Ne.jsx("p",{children:"loading"}):Ne.jsx("p",{children:JSON.stringify(s)})]})},{Title:ct,Paragraph:ot}=P,dt=()=>{const e=le();return Ne.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx(ct,{children:"问卷调查 | 在线投票"}),Ne.jsx(ot,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),Ne.jsx("div",{className:"h-15 font-24",children:Ne.jsx(E,{className:"b-rounded-4",type:"primary",onClick:()=>e(vt),children:"开始使用"})})]})})},{Title:xt}=P,mt="USERNAME",ut="PASSWORD",pt=()=>{const e=le(),s=Y(),[n]=z.useForm();t.useEffect((()=>{const{username:e,password:s}={username:localStorage.getItem(mt),password:localStorage.getItem(ut)};n.setFieldsValue({username:e,password:s})}),[]);const{run:r}=ue((async(e,t)=>{const n=await async function(e,s){const t={username:e,password:s};return await xs.post("/api/user/login",t)}(e,t);return n.token&&s(Ee({username:e,nickname:e})),n}),{manual:!0,onSuccess(s){const{token:t=""}=s;!function(e){localStorage.setItem(rs,e)}(t),L.success("登录成功"),e(vt)}});return Ne.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[Ne.jsx("div",{children:Ne.jsxs(_,{children:[Ne.jsx(xt,{level:2,children:Ne.jsx(o,{})}),Ne.jsx(xt,{level:2,children:"登录"})]})}),Ne.jsx("div",{children:Ne.jsxs(z,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{const{username:s,password:t,remember:n}=e||{};r(s,t),n?function(e,s){localStorage.setItem(mt,e),localStorage.setItem(ut,s)}(s,t):(localStorage.removeItem(mt),localStorage.removeItem(ut))},children:[Ne.jsx(z.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:Ne.jsx(T,{})}),Ne.jsx(z.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:Ne.jsx(T.Password,{})}),Ne.jsx(z.Item,{name:"remember",valuePropName:"checked",wrapperCol:{offset:0,span:10},children:Ne.jsx(W,{children:"记住我"})}),Ne.jsx(z.Item,{wrapperCol:{offset:4,span:18},children:Ne.jsxs(_,{children:[Ne.jsx(E,{type:"primary",htmlType:"submit",children:"登录"}),Ne.jsx(ne,{to:gt,children:"注册新用户"})]})})]})})]})},ht=oe([{path:"/",element:Ne.jsx(ks,{}),children:[{path:"/",element:Ne.jsx(dt,{})},{path:"login",element:Ne.jsx(pt,{})},{path:"register",element:Ne.jsx(_s,{})},{path:"manage",element:Ne.jsx(Ns,{}),children:[{path:"list",element:Ne.jsx(zs,{})},{path:"star",element:Ne.jsx(As,{})},{path:"trash",element:Ne.jsx(Ds,{})}]},{path:"*",element:Ne.jsx(Ps,{})}]},{path:"question",element:Ne.jsx(Ss,{}),children:[{path:"edit/:id",element:Ne.jsx(it,{})},{path:"stat/:id",element:Ne.jsx(lt,{})}]}],{basename:"/survey-sage"}),jt="/",ft="/login",gt="/register",vt="/manage/list",yt=()=>Ne.jsx(G,{theme:{algorithm:J.defaultAlgorithm},children:Ne.jsx(de,{router:ht})});Se.createRoot(document.getElementById("root")).render(Ne.jsx(S.StrictMode,{children:Ne.jsx(X,{store:es,children:Ne.jsx(yt,{})})}))}}}));
