const t="@@redux-undo/UNDO",e="@@redux-undo/REDO",n="@@redux-undo/JUMP_TO_FUTURE",r="@@redux-undo/JUMP_TO_PAST",i="@@redux-undo/JUMP",o="@@redux-undo/CLEAR_HISTORY",u={undo:()=>({type:t}),redo:()=>({type:e}),jumpToFuture:t=>({type:n,index:t}),jumpToPast:t=>({type:r,index:t}),jump:t=>({type:i,index:t}),clearHistory:()=>({type:o})};function s(t,e=[]){return Array.isArray(t)?t:"string"==typeof t?[t]:e}function a(t){const e=s(t);return t=>e.indexOf(t.type)<0}function p(t,e,n,r=null){return{past:t,present:e,future:n,group:r,_latestUnfiltered:e,index:t.length,limit:t.length+n.length+1}}let c,l;const d={prevState:"#9E9E9E",action:"#03A9F4",nextState:"#4CAF50"};function f(t,e,n){return["%c".concat(t),"color: ".concat(e,"; font-weight: bold"),n]}function y(t,e){l={header:[],prev:[],action:[],next:[],msgs:[]},c&&(console.group?(l.header=["%credux-undo","font-style: italic","action",t.type],l.action=f("action",d.action,t),l.prev=f("prev history",d.prevState,e)):(l.header=["redux-undo action",t.type],l.action=["action",t],l.prev=["prev history",e]))}function g(t){c&&(console.group?l.next=f("next history",d.nextState,t):l.next=["next history",t],function(){const{header:t,prev:e,next:n,action:r,msgs:i}=l;console.group}())}function T(...t){c&&(l.msgs=l.msgs.concat([...t,"\n"]))}function x(t,e){const n=p([],t,[]);return e&&(n._latestUnfiltered=null),n}function m(t,e){if(e<0||e>=t.future.length)return t;const{past:n,future:r,_latestUnfiltered:i}=t;return p([...n,i,...r.slice(0,e)],r[e],r.slice(e+1))}function h(t,e){if(e<0||e>=t.past.length)return t;const{past:n,future:r,_latestUnfiltered:i}=t,o=n.slice(0,e),u=[...n.slice(e+1),i,...r];return p(o,n[e],u)}function S(t,e){return e>0?m(t,e-1):e<0?h(t,t.past.length+e):t}function v(u,a={}){!function(t){c=t}(a.debug);const l={limit:void 0,filter:()=>!0,groupBy:()=>null,undoType:t,redoType:e,jumpToPastType:r,jumpToFutureType:n,jumpType:i,neverSkipReducer:!1,ignoreInitialState:!1,syncFilter:!1,...a,initTypes:s(a.initTypes,["@@redux-undo/INIT"]),clearHistoryType:s(a.clearHistoryType,[o])},d=l.neverSkipReducer?(t,e,...n)=>({...t,present:u(t.present,e,...n)}):t=>t;let f;return(t=f,e={},...n)=>{y(e,t);let r,i=t;if(!f){if(T("history is uninitialized"),void 0===t){return i=x(u(t,{type:"@@redux-undo/CREATE_HISTORY"},...n),l.ignoreInitialState),T("do not set initialState on probe actions"),g(i),i}!function(t){return typeof t.present<"u"&&typeof t.future<"u"&&typeof t.past<"u"&&Array.isArray(t.future)&&Array.isArray(t.past)}(t)?(i=f=x(t,l.ignoreInitialState),T("initialHistory initialized: initialState is not a history",f)):(i=f=l.ignoreInitialState?t:p(t.past,t.present,t.future),T("initialHistory initialized: initialState is a history",f))}switch(e.type){case void 0:return i;case l.undoType:return r=S(i,-1),T("perform undo"),g(r),d(r,e,...n);case l.redoType:return r=S(i,1),T("perform redo"),g(r),d(r,e,...n);case l.jumpToPastType:return r=h(i,e.index),T("perform jumpToPast to ".concat(e.index)),g(r),d(r,e,...n);case l.jumpToFutureType:return r=m(i,e.index),T("perform jumpToFuture to ".concat(e.index)),g(r),d(r,e,...n);case l.jumpType:return r=S(i,e.index),T("perform jump to ".concat(e.index)),g(r),d(r,e,...n);case function(t,e){return e.indexOf(t)>-1?t:!t}(e.type,l.clearHistoryType):return r=x(i.present,l.ignoreInitialState),T("perform clearHistory"),g(r),d(r,e,...n);default:if(r=u(i.present,e,...n),l.initTypes.some((t=>t===e.type)))return T("reset history due to init action"),g(f),f;if(i._latestUnfiltered===r)return i;if("function"==typeof l.filter&&!l.filter(e,r,i)){const t=p(i.past,r,i.future,i.group);return l.syncFilter||(t._latestUnfiltered=i._latestUnfiltered),T("filter ignored action, not storing it in past"),g(t),t}const t=l.groupBy(e,r,i);if(null!=t&&t===i.group){const t=p(i.past,r,i.future,i.group);return T("groupBy grouped the action with the previous action"),g(t),t}return i=function(t,e,n,r){const i=t.past.length+1;T("inserting",e),T("new free: ",n-i);const{past:o,_latestUnfiltered:u}=t,s=n&&n<=i,a=o.slice(s?1:0);return p(null!=u?[...a,u]:a,e,[],r)}(i,r,l.limit,t),T("inserted new state into history"),g(i),i}}}export{v as C,a as D,u as M};
