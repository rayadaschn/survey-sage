function e(){import.meta.url,import("_").catch((()=>1))}import{r as s,ad as t,ae as r,M as n,af as a,ag as i,ah as l,ab as c,ai as o,ac as d,aj as x,ak as h,R as j}from"./@ant-design/icons-70aec636.js";import{r as m,S as u,T as p,L as f,m as g,B as y,D as v,F as b,I as w,R as N,a as S,P as k,M as C,b as _,E as I,c as q,d as E,C as P,t as O}from"./antd-636d0b10.js";import{L as R,O as T,u as z,a as F,b as L,c as D,d as A,R as M}from"./react-router-dom-5ed4d8f0.js";import{a as B}from"./axios-83bdef92.js";import{u as W,a as U,b as $}from"./ahooks-35f063da.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var H={exports:{}},K={},J=s,Q=Symbol.for("react.element"),V=Symbol.for("react.fragment"),Y=Object.prototype.hasOwnProperty,G=J.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,X={key:!0,ref:!0,__self:!0,__source:!0};function Z(e,s,t){var r,n={},a=null,i=null;for(r in void 0!==t&&(a=""+t),void 0!==s.key&&(a=""+s.key),void 0!==s.ref&&(i=s.ref),s)Y.call(s,r)&&!X.hasOwnProperty(r)&&(n[r]=s[r]);if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===n[r]&&(n[r]=s[r]);return{$$typeof:Q,type:e,key:a,ref:i,props:n,_owner:G.current}}K.Fragment=V,K.jsx=Z,K.jsxs=Z,H.exports=K;var ee=H.exports;var se={},te=m;se.createRoot=te.createRoot,se.hydrateRoot=te.hydrateRoot;const re="_container_1fxih_1",{Title:ne}=p,ae=()=>ee.jsx("div",{children:ee.jsx(R,{to:"/",children:ee.jsxs(u,{className:re,children:[ee.jsx(ne,{children:ee.jsx(t,{})}),ee.jsx(ne,{children:"问卷调查"})]})})}),ie=()=>ee.jsx(ee.Fragment,{children:ee.jsx(R,{to:He,children:"登录"})}),{Header:le,Content:ce,Footer:oe}=f,de=()=>ee.jsxs(f,{children:[ee.jsxs(le,{className:"px-6",children:[ee.jsx("div",{className:"float-left",children:ee.jsx(ae,{})}),"MainLayout header",ee.jsx("div",{className:"float-right",children:ee.jsx(ie,{})})]}),ee.jsx(ce,{className:"min-h-[calc(100vh-140px)]",children:ee.jsx(T,{})}),ee.jsx(oe,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"文件调查@2023 Created by Huy"})]});const xe="keyword",he="page",je="pageSize",me=B.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});async function ue(){return await me.post("/api/question/")}async function pe(e={}){return await me.get("/api/question",{params:e})}async function fe(e,s){const t="/api/question/".concat(e);return await me.patch(t,s)}me.interceptors.request.use((e=>(e.headers.Authorization="Bearer ".concat(localStorage.getItem("USER_TOKEN")||""),e)),(e=>(g.error(e.message),Promise.reject(e)))),me.interceptors.response.use((e=>{const s=e.data||{},{errno:t,data:r,msg:n}=s;return 203===t||0!==t&&200!==t?(g.error(n||"请求失败"),Promise.reject(r)):r}),(e=>{var s;let t="";switch(null==(s=e.response)?void 0:s.status){case 401:t="token 失效，请重新登录";break;case 403:t="拒绝访问";break;case 404:t="请求地址错误";break;case 500:t="服务器故障";break;default:t="网络连接故障"}return g.error(t),Promise.reject(e)}));const ge=()=>{const e=z(),{pathname:s}=F(),{loading:t,run:l}=W(ue,{manual:!0,onSuccess(s){e("question/edit/".concat(s.id)),g.success("创建成功")}});return ee.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[ee.jsx("div",{className:"w-30",children:ee.jsxs(u,{direction:"vertical",children:[ee.jsx(y,{type:"primary",size:"large",icon:ee.jsx(r,{}),onClick:l,disabled:t,children:"新建问卷"}),ee.jsx(v,{}),ee.jsx(y,{type:s.startsWith("/manage/list")?"default":"text",size:"large",icon:ee.jsx(n,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),ee.jsx(y,{type:s.startsWith("/manage/star")?"default":"text",size:"large",icon:ee.jsx(a,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),ee.jsx(y,{type:s.startsWith("/manage/trash")?"default":"text",size:"large",icon:ee.jsx(i,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),ee.jsx("div",{className:"ml-15 flex-1",children:ee.jsx(T,{})})]})},ye=()=>ee.jsxs(ee.Fragment,{children:[ee.jsx("p",{children:"Question layout"}),ee.jsx("div",{children:ee.jsx(T,{})})]}),{Title:ve}=p,be=()=>ee.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[ee.jsx("div",{children:ee.jsxs(u,{children:[ee.jsx(ve,{level:2,children:ee.jsx(l,{})}),ee.jsx(ve,{level:2,children:"注册新用户"})]})}),ee.jsx("div",{children:ee.jsxs(b,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{},children:[ee.jsx(b.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:ee.jsx(w,{})}),ee.jsx(b.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:ee.jsx(w.Password,{})}),ee.jsx(b.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(s,t)=>t&&e("password")!==t?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:ee.jsx(w.Password,{})}),ee.jsx(b.Item,{label:"昵称",name:"nickname",children:ee.jsx(w,{})}),ee.jsx(b.Item,{wrapperCol:{offset:4,span:18},children:ee.jsxs(u,{children:[ee.jsx(y,{type:"primary",htmlType:"submit",children:"注册"}),ee.jsx(R,{to:He,children:"已有账户，请登录"})]})})]})})]}),we=()=>{const e=z();return ee.jsx(ee.Fragment,{children:ee.jsx(N,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:ee.jsx(y,{type:"primary",onClick:()=>e(Ke),children:"返回首页"})})})},{confirm:Ne}=C,Se=e=>{const{id:s,title:t,isPublished:r,answerContent:n,currentAt:l,isStar:h}=e,j=z();return ee.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[ee.jsxs("div",{className:"flex",children:[ee.jsx("div",{className:"flex-1",children:ee.jsx(R,{to:r?"/question/stat/".concat(s):"/question/edit/".concat(s),children:ee.jsxs(u,{children:[h&&ee.jsx(a,{style:{color:"red"}}),t]})})}),ee.jsx("div",{className:"flex-1 text-center font-size-3",children:ee.jsxs(u,{children:[r?ee.jsx(S,{color:"processing",children:"已发布"}):ee.jsx(S,{children:"未发布"}),ee.jsxs("span",{children:["答卷: ",n]}),ee.jsx("span",{children:l})]})})]}),ee.jsx(v,{className:"m-3"}),ee.jsxs("div",{className:"flex",children:[ee.jsx("div",{className:"flex-1",children:ee.jsxs(u,{children:[ee.jsx(y,{icon:ee.jsx(c,{}),type:"text",size:"small",onClick:()=>{j("/question/edit/".concat(s))},children:"编辑问卷"}),ee.jsx(y,{icon:ee.jsx(o,{}),type:"text",size:"small",onClick:()=>{j("/question/stat/".concat(s))},children:"数据统计"})]})}),ee.jsx("div",{className:"flex-1 text-center",children:ee.jsxs(u,{children:[ee.jsx(y,{type:"text",icon:ee.jsx(a,{}),color:"#999",size:"small",children:"标星"}),ee.jsx(k,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:()=>{},children:ee.jsx(y,{type:"text",icon:ee.jsx(d,{}),color:"#999",size:"small",children:"复制"})}),ee.jsx(y,{type:"text",icon:ee.jsx(i,{}),size:"small",color:"#999",onClick:()=>{Ne({title:"确定删除该问卷?",icon:ee.jsx(x,{}),onOk:()=>g.success("删除")})},children:"删除"})]})})]})]})},{Search:ke}=w,Ce=()=>{const e=z(),{pathname:t}=F(),[r,n]=s.useState("");const[a]=L();return s.useEffect((()=>{const e=a.get(xe)||"";n(e)}),[a]),ee.jsx(ke,{placeholder:"请输入关键字",value:r,onChange:function(e){n(e.target.value)},onSearch:function(s){e({pathname:t,search:"".concat(xe,"=").concat(s)})},className:"w-50"})},{Title:_e}=p,Ie=()=>{const[e,t]=s.useState(!1),[r,n]=s.useState(1),[a,i]=s.useState([]),[l,c]=s.useState(0),o=l>a.length,[d]=L(),x=d.get(xe)||"";s.useEffect((()=>{t(!1),n(1),i([]),c(0)}),[x]);const{run:h,loading:j}=W((async()=>await pe({page:r,pageSize:10,keyword:x})),{manual:!0,onSuccess(e){const{list:s=[],total:t=0}=e;i(a.concat(s)),c(t),n(r+1)}}),m=s.useRef(null),{run:u}=U((()=>{const e=m.current;if(null==e)return;const s=e.getBoundingClientRect();if(null==s)return;const{bottom:r}=s;r<=document.body.clientHeight&&(h(),t(!0))}),{wait:1e3});s.useEffect((()=>{u()}),[d]),s.useEffect((()=>(o&&window.addEventListener("scroll",u),()=>{window.removeEventListener("scroll",u)})),[d,o]);const p=s.useMemo((()=>!e||j?ee.jsx(_,{}):0===l?ee.jsx(I,{description:"暂无数据"}):o?ee.jsx("span",{children:"开始加载下一页"}):ee.jsx("span",{children:"没有更多了..."})),[e,j,o]);return ee.jsxs(ee.Fragment,{children:[ee.jsxs("div",{className:"flex",children:[ee.jsx("div",{className:"flex-1",children:ee.jsx(_e,{level:3,children:"我的问卷"})}),ee.jsx("div",{className:"flex-1 text-center",children:ee.jsx(Ce,{})})]}),ee.jsx("div",{className:"mb-5",children:a.length>0&&a.map((e=>{const{_id:s}=e;return ee.jsx(Se,{...e},s)}))}),ee.jsx("div",{className:"text-center color-blue",children:ee.jsx("div",{ref:m,children:p})})]})},qe=e=>{const{total:t}=e,[r,n]=s.useState(1),[a,i]=s.useState(10),[l]=L();s.useEffect((()=>{const e=parseInt(l.get(he)||"")||1;n(e);const s=parseInt(l.get(je)||"")||10;i(s)}),[l]);const c=z(),{pathname:o}=F();return ee.jsx(q,{current:r,pageSize:a,total:t,onChange:(e,s)=>{l.set(he,e.toString()),l.set(je,s.toString()),c({pathname:o,search:l.toString()})}})};function Ee(){const{id:e=""}=D(),[t,r]=s.useState(!0),[n,a]=s.useState({});return s.useEffect((()=>{!async function(){const s=await async function(e){const s="/api/question/".concat(e);return await me.get(s)}(e);a(s),r(!1)}()}),[e]),{loading:t,questionData:n}}function Pe(e={}){const{isStar:s,isDeleted:t}=e,[r]=L(),{data:n,loading:a,error:i,refresh:l}=W((async()=>{const e=r.get(xe)||"",n=parseInt(r.get(he)||"")||1,a=parseInt(r.get(je)||"")||10;return await pe({keyword:e,isStar:s,isDeleted:t,page:n,pageSize:a})}),{refreshDeps:[r]});return{data:n,loading:a,error:i,refresh:l}}const{Title:Oe}=p,{confirm:Re}=C,Te=()=>{$("问卷调查");const{data:e={},loading:t,refresh:r}=Pe({isDeleted:!0}),{list:n=[],total:a=0}=e,[i,l]=s.useState([]),c=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?ee.jsx(S,{color:"processing",children:"已发布"}):ee.jsx(S,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:o}=W((async()=>{for await(const e of i)await fe(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){g.success("恢复成功"),r(),l([])}}),{run:d}=W((async()=>await async function(e){return await me.delete("/api/question",{data:{ids:e}})}(i)),{manual:!0,onSuccess(){g.success("删除成功"),r(),l([])}});return ee.jsxs(ee.Fragment,{children:[ee.jsxs("div",{className:"flex",children:[ee.jsx("div",{className:"flex-1",children:ee.jsx(Oe,{level:3,children:"回收站"})}),ee.jsx("div",{className:"flex-1 text-center",children:ee.jsx(Ce,{})})]}),ee.jsxs("div",{className:"mb-5",children:[t&&ee.jsx("div",{className:"text-center",children:ee.jsx(_,{})}),!t&&0===n.length&&ee.jsx(I,{description:"暂无数据"}),n.length>0&&ee.jsxs("div",{children:[ee.jsxs(u,{className:"mb",children:[ee.jsx(y,{type:"primary",disabled:0===i.length,onClick:o,children:"恢复"}),ee.jsx(y,{danger:!0,disabled:0===i.length,onClick:()=>{Re({title:"确定彻底删除该问卷?",icon:ee.jsx(h,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),ee.jsx(E,{rowKey:e=>e._id,dataSource:n,columns:c,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{l(e)}}})]})]}),ee.jsx("div",{className:"text-center color-blue",children:n.length>0&&ee.jsx(qe,{total:a})})]})},{Title:ze}=p,Fe=()=>{const{data:e={},loading:s}=Pe({isStar:!0}),{list:t=[],total:r=0}=e;return ee.jsxs(ee.Fragment,{children:[ee.jsxs("div",{className:"flex",children:[ee.jsx("div",{className:"flex-1",children:ee.jsx(ze,{level:3,children:"星标问卷"})}),ee.jsx("div",{className:"flex-1 text-center",children:ee.jsx(Ce,{})})]}),ee.jsxs("div",{className:"mb-5",children:[s&&ee.jsx("div",{className:"text-center",children:ee.jsx(_,{})}),!s&&0===t.length&&ee.jsx(I,{description:"暂无数据"}),t.length>0&&t.map((e=>{const{_id:s}=e;return ee.jsx(Se,{...e},s)}))]}),ee.jsx("div",{className:"text-center color-blue",children:t.length>0&&ee.jsx(qe,{total:r})})]})},Le=()=>{const{loading:e,questionData:s}=Ee();return ee.jsxs("div",{children:[ee.jsx("p",{children:"编辑"}),e?ee.jsx("p",{children:"loading"}):ee.jsx("p",{children:JSON.stringify(s)})]})},De=()=>{const{loading:e,questionData:s}=Ee();return ee.jsxs("div",{children:[ee.jsx("p",{children:"Stat"}),e?ee.jsx("p",{children:"loading"}):ee.jsx("p",{children:JSON.stringify(s)})]})},{Title:Ae,Paragraph:Me}=p,Be=()=>{const e=z();return ee.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:ee.jsxs("div",{className:"text-center",children:[ee.jsx(Ae,{children:"问卷调查 | 在线投票"}),ee.jsx(Me,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),ee.jsx("div",{className:"h-15 font-24",children:ee.jsx(y,{className:"b-rounded-4",type:"primary",onClick:()=>e(Ke),children:"开始使用"})})]})})},{Title:We}=p,Ue=()=>ee.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[ee.jsx("div",{children:ee.jsxs(u,{children:[ee.jsx(We,{level:2,children:ee.jsx(l,{})}),ee.jsx(We,{level:2,children:"登录"})]})}),ee.jsx("div",{children:ee.jsxs(b,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{},children:[ee.jsx(b.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:ee.jsx(w,{})}),ee.jsx(b.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:ee.jsx(w.Password,{})}),ee.jsx(b.Item,{wrapperCol:{offset:4,span:18},children:ee.jsxs(u,{children:[ee.jsx(y,{type:"primary",htmlType:"submit",children:"登录"}),ee.jsx(R,{to:"/",children:"注册新用户"})]})})]})})]}),$e=A([{path:"/",element:ee.jsx(de,{}),children:[{path:"/",element:ee.jsx(Be,{})},{path:"login",element:ee.jsx(Ue,{})},{path:"register",element:ee.jsx(be,{})},{path:"manage",element:ee.jsx(ge,{}),children:[{path:"list",element:ee.jsx(Ie,{})},{path:"star",element:ee.jsx(Fe,{})},{path:"trash",element:ee.jsx(Te,{})}]},{path:"*",element:ee.jsx(we,{})}]},{path:"question",element:ee.jsx(ye,{}),children:[{path:"edit/:id",element:ee.jsx(Le,{})},{path:"stat/:id",element:ee.jsx(De,{})}]}],{basename:"/survey-sage"}),He="/login",Ke="/manage/list",Je=()=>ee.jsx(P,{theme:{algorithm:O.defaultAlgorithm},children:ee.jsx(M,{router:$e})});se.createRoot(document.getElementById("root")).render(ee.jsx(j.StrictMode,{children:ee.jsx(Je,{})}));export{e as __vite_legacy_guard};
