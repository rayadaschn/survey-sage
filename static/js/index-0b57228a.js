function e(){import.meta.url,import("_").catch((()=>1))}import{r as s,ae as t,af as n,U as i,M as r,ag as a,ah as l,ai as o,ac as c,aj as d,ad as x,ak as m,W as u,al as h,am as p,an as j,K as f,ao as g,ap as v,L as y,O as C,aq as b,z as k,ar as I,as as w,at as N,R as S}from"./@ant-design/icons-a547670a.js";import{r as P,d as _,e as F,D as E,f as L,M as V}from"./@dnd-kit/core-bfdf9a21.js";import{u as q,a as T,P as R}from"./react-redux-19c52d99.js";import{c as z,p as D,a as O}from"./@reduxjs/toolkit-4ce24ac1.js";import{a as A,S as H,v as B,u as U}from"./@dnd-kit/sortable-382ff782.js";import{c as M}from"./lodash-es-34fbd7b9.js";import{L as K,u as W,a as G,b as $,c as J,O as Y,d as X,R as Q}from"./react-router-dom-f691f64c.js";import{S as Z,m as ee,B as se,L as te,a as ne,D as ie,F as re,I as ae,T as le,R as oe,b as ce,P as de,M as xe,E as me,c as ue,d as he,e as pe,C as je,f as fe,g as ge,h as ve,i as ye,j as Ce,t as be}from"./antd-3e3f5c7b.js";import{a as ke}from"./axios-83bdef92.js";import{F as Ie,G as we,H as Ne,I as Se,J as Pe}from"./ahooks-c1500c8f.js";import{M as _e}from"./redux-undo-644c5718.js";import{R as Fe,B as Ee,C as Le,X as Ve,Y as qe,T as Te,a as Re,P as ze,b as De,c as Oe}from"./recharts-d19bd1fb.js";import{C as Ae}from"./@dnd-kit/utilities-5fc7a870.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var He={exports:{}},Be={},Ue=s,Me=Symbol.for("react.element"),Ke=Symbol.for("react.fragment"),We=Object.prototype.hasOwnProperty,Ge=Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$e={key:!0,ref:!0,__self:!0,__source:!0};function Je(e,s,t){var n,i={},r=null,a=null;for(n in void 0!==t&&(r=""+t),void 0!==s.key&&(r=""+s.key),void 0!==s.ref&&(a=s.ref),s)We.call(s,n)&&!$e.hasOwnProperty(n)&&(i[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===i[n]&&(i[n]=s[n]);return{$$typeof:Me,type:e,key:r,ref:a,props:i,_owner:Ge.current}}Be.Fragment=Ke,Be.jsx=Je,Be.jsxs=Je,He.exports=Be;var Ye=He.exports;var Xe={},Qe=P;Xe.createRoot=Qe.createRoot,Xe.hydrateRoot=Qe.hydrateRoot;const Ze={username:"",nickname:""},es=z({name:"user",initialState:Ze,reducers:{loginReducer:(e,s)=>s.payload,logoutReducer:()=>Ze}}),ss=es.reducer,{loginReducer:ts,logoutReducer:ns}=es.actions,is=z({name:"pageInfo",initialState:{title:"",desc:"",js:"",css:""},reducers:{resetPageInfo:(e,s)=>s.payload,changePageTitle:D(((e,s)=>{e.title=s.payload}))}}),rs=is.reducer,{resetPageInfo:as,changePageTitle:ls}=is.actions;let os=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,s)=>e+=(s&=63)<36?s.toString(36):s<62?(s-26).toString(36).toUpperCase():s>62?"-":"_"),"");function cs(e,s){const t=s.filter((e=>!e.isHidden)),n=t.findIndex((s=>s.fe_id===e));if(n<0)return"";let i="";const r=t.length;return i=r<=1?"":n+1===r?t[n-1].fe_id:t[n+1].fe_id,i}function ds(e,s){const{selectedId:t,componentList:n}=e,i=n.findIndex((e=>e.fe_id===t));i<0?e.componentList.push(s):e.componentList.splice(i+1,0,s),e.selectedId=s.fe_id}const xs=z({name:"components",initialState:{componentList:[],selectedId:"",copiedComponent:null},reducers:{resetComponents:(e,s)=>s.payload,changeSelectedId:D(((e,s)=>{e.selectedId=s.payload})),addComponent:D(((e,s)=>{ds(e,s.payload)})),changeComponentProps:D(((e,s)=>{const{fe_id:t,newProps:n}=s.payload,i=e.componentList.find((e=>e.fe_id===t));i&&(i.props={...i.props,...n})})),removeSelectedComponent:D((e=>{const{componentList:s=[],selectedId:t}=e,n=cs(t,s);e.selectedId=n;const i=s.findIndex((e=>e.fe_id===t));s.splice(i,1)})),changeComponentHidden:D(((e,s)=>{const{componentList:t=[]}=e,{fe_id:n,isHidden:i}=s.payload;let r="";r=i?cs(n,t):n,e.selectedId=r;const a=t.find((e=>e.fe_id===n));a&&(a.isHidden=i)})),toggleComponentLocked:D(((e,s)=>{const{fe_id:t}=s.payload,n=e.componentList.find((e=>e.fe_id===t));n&&(n.isLocked=!n.isLocked)})),copySelectedComponent:D((e=>{const{selectedId:s,componentList:t=[]}=e,n=t.find((e=>e.fe_id===s));null!=n&&(e.copiedComponent=M(n))})),pasteCopiedComponent:D((e=>{const{copiedComponent:s}=e;null!=s&&(s.fe_id=os(),ds(e,s))})),selectPrevComponent:D((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n<=0||(e.selectedId=t[n-1].fe_id)})),selectNextComponent:D((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n+1!==t.length&&(e.selectedId=t[n+1].fe_id)})),changeComponentTitle:D(((e,s)=>{const{title:t,fe_id:n}=s.payload,i=e.componentList.find((e=>e.fe_id===n));i&&(i.title=t)})),moveComponent:D(((e,s)=>{const{componentList:t}=e,{oldIndex:n,newIndex:i}=s.payload;e.componentList=A(t,n,i)}))}}),{resetComponents:ms,changeSelectedId:us,addComponent:hs,changeComponentProps:ps,removeSelectedComponent:js,changeComponentHidden:fs,toggleComponentLocked:gs,copySelectedComponent:vs,pasteCopiedComponent:ys,selectPrevComponent:Cs,selectNextComponent:bs,changeComponentTitle:ks,moveComponent:Is}=xs.actions,ws=O({reducer:{user:ss,pageInfo:rs,components:xs.reducer}}),Ns=()=>Ye.jsx("div",{children:Ye.jsx(K,{to:"/",children:Ye.jsx(Z,{children:Ye.jsxs("div",{className:"text-7 color-white",children:[Ye.jsx(t,{}),Ye.jsx("span",{children:"问卷调查"})]})})})}),Ss="keyword",Ps="page",_s="pageSize",Fs=["#FF2D2D","#BE77FF","#2894FF","#00EC00","#EAC100","#FF9D6F"],Es=ke.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});Es.interceptors.request.use((e=>(e.headers.Authorization="Bearer ".concat(localStorage.getItem(Ls)||""),e)),(e=>(ee.error(e.message),Promise.reject(e)))),Es.interceptors.response.use((e=>{const s=e.data||{},{errno:t,data:n,msg:i}=s;return 203===t||0!==t&&200!==t?(ee.error(i||"请求失败"),Promise.reject(n)):n}),(e=>{var s;let t="";switch(null==(s=e.response)?void 0:s.status){case 401:t="token 失效，请重新登录";break;case 403:t="拒绝访问";break;case 404:t="请求地址错误";break;case 500:t="服务器故障";break;default:t="网络连接故障"}return ee.error(t),Promise.reject(e)}));const Ls="USER_TOKEN";const Vs=()=>document.activeElement===document.body;function qs(){const e=T((e=>e.components)),{componentList:s=[],selectedId:t,copiedComponent:n}=e,i=s.find((e=>e.fe_id===t));return{componentList:s,selectedId:t,selectedComponent:i,copiedComponent:n}}function Ts(){return T((e=>e.pageInfo))}function Rs(){const{username:e,nickname:s}=T((e=>e.user));return{username:e,nickname:s}}async function zs(){return await Es.post("/api/question/")}async function Ds(e={}){return await Es.get("/api/question",{params:e})}async function Os(e,s){const t="/api/question/".concat(e);return await Es.patch(t,s)}async function As(){return await Es.get("/api/user/info")}function Hs(){const{id:e=""}=W(),t=q(),{data:n,loading:i,error:r,run:a}=we((async e=>{if(!e)throw new Error("缺少问卷 id");const s=await async function(e){const s="/api/question/".concat(e);return await Es.get(s)}(e);return s}),{manual:!0});return s.useEffect((()=>{if(!n)return;const{title:e="",desc:s="",js:i="",css:r="",componentList:a=[]}=n;let l="";a.length>0&&(l=a[0].fe_id),t(ms({componentList:a,selectedId:l,copiedComponent:null})),t(as({title:e,desc:s,js:i,css:r}))}),[n]),s.useEffect((()=>{a(e)}),[e]),{loading:i,error:r}}function Bs(e={}){const{isStar:s,isDeleted:t}=e,[n]=G(),{data:i,loading:r,error:a,refresh:l}=we((async()=>{const e=n.get(Ss)||"",i=parseInt(n.get(Ps)||"")||1,r=parseInt(n.get(_s)||"")||10;return await Ds({keyword:e,isStar:s,isDeleted:t,page:i,pageSize:r})}),{refreshDeps:[n]});return{data:i,loading:r,error:a,refresh:l}}function Us(){const e=q(),[t,n]=s.useState(!0),{run:i}=we(As,{manual:!0,onSuccess(s){const{username:t,nickname:n}=s;e(ts({username:t,nickname:n}))},onFinally(){n(!1)}}),{username:r}=Rs();return s.useEffect((()=>{r?n(!1):i()}),[t]),{waitingUserData:t}}function Ms(e){const{username:t}=Rs(),{pathname:n}=$(),i=J();s.useEffect((()=>{e||(t?function(e){return[jn,fn].includes(e)}(n)&&i(gn):function(e){return[pn,jn,fn].includes(e)}(n)||i(jn))}),[e,t,n])}const Ks=()=>{const e=J(),s=q(),{username:t,nickname:i}=Rs();const r=Ye.jsxs(Ye.Fragment,{children:[Ye.jsxs("span",{className:"color-light",children:[Ye.jsx(n,{}),i]}),Ye.jsx(se,{type:"link",onClick:function(){s(ns()),localStorage.removeItem(Ls),ee.success("退出成功"),e(jn)},children:"退出"})]}),a=Ye.jsx(K,{to:jn,children:"登录"});return Ye.jsx(Ye.Fragment,{children:t?r:a})},{Header:Ws,Content:Gs,Footer:$s}=te,Js=()=>{const{waitingUserData:e}=Us();return Ms(e),Ye.jsxs(te,{children:[Ye.jsxs(Ws,{className:"px-6",children:[Ye.jsx("div",{className:"float-left",children:Ye.jsx(Ns,{})}),"MainLayout header",Ye.jsx("div",{className:"float-right",children:Ye.jsx(Ks,{})})]}),Ye.jsx(Gs,{className:"min-h-[calc(100vh-140px)]",children:e?Ye.jsx("div",{className:"mt-15 text-center",children:Ye.jsx(ne,{})}):Ye.jsx(Y,{})}),Ye.jsx($s,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"问卷调查 ©2023 - present. Created by Huy"})]})},Ys=()=>{const e=J(),{pathname:s}=$(),{loading:t,run:n}=we(zs,{manual:!0,onSuccess(s){e("question/edit/".concat(s.id)),ee.success("创建成功")}});return Ye.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[Ye.jsx("div",{className:"w-30",children:Ye.jsxs(Z,{direction:"vertical",children:[Ye.jsx(se,{type:"primary",size:"large",icon:Ye.jsx(i,{}),onClick:n,disabled:t,children:"新建问卷"}),Ye.jsx(ie,{}),Ye.jsx(se,{type:s.startsWith("/manage/list")?"default":"text",size:"large",icon:Ye.jsx(r,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),Ye.jsx(se,{type:s.startsWith("/manage/star")?"default":"text",size:"large",icon:Ye.jsx(a,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),Ye.jsx(se,{type:s.startsWith("/manage/trash")?"default":"text",size:"large",icon:Ye.jsx(l,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),Ye.jsx("div",{className:"ml-15 flex-1",children:Ye.jsx(Y,{})})]})},Xs=()=>{const{waitingUserData:e}=Us();return Ms(e),Ye.jsx("div",{className:"h-screen",children:e?Ye.jsx("div",{className:"mt-15 text-center",children:Ye.jsx(ne,{})}):Ye.jsx(Y,{})})},{Title:Qs}=le,Zs=()=>{const e=J(),{run:s}=we((async e=>{const{username:s,password:t,nickname:n}=e;await async function(e,s,t){const n={username:e,password:s,nickname:t||e};return await Es.post("/api/user/register",n)}(s,t,n)}),{manual:!0,onSuccess(){ee.success("注册成功"),e(jn)}});return Ye.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[Ye.jsx("div",{children:Ye.jsxs(Z,{children:[Ye.jsx(Qs,{level:2,children:Ye.jsx(o,{})}),Ye.jsx(Qs,{level:2,children:"注册新用户"})]})}),Ye.jsx("div",{children:Ye.jsxs(re,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{s(e)},children:[Ye.jsx(re.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:Ye.jsx(ae.Password,{})}),Ye.jsx(re.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(s,t)=>t&&e("password")!==t?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:Ye.jsx(ae.Password,{})}),Ye.jsx(re.Item,{label:"昵称",name:"nickname",children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{wrapperCol:{offset:4,span:18},children:Ye.jsxs(Z,{children:[Ye.jsx(se,{type:"primary",htmlType:"submit",children:"注册"}),Ye.jsx(K,{to:jn,children:"已有账户，请登录"})]})})]})})]})},et=()=>{const e=J();return Ye.jsx(Ye.Fragment,{children:Ye.jsx(oe,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:Ye.jsx(se,{type:"primary",onClick:()=>e(gn),children:"返回首页"})})})},{confirm:st}=xe,tt=e=>{const t=J(),{_id:n,title:i,isPublished:r,answerContent:o,currentAt:u,isStar:h}=e,[p,j]=s.useState(h),{loading:f,run:g}=we((async()=>{await Os(n,{isStar:!p})}),{manual:!0,onSuccess(){j(!p),ee.success("已更新")}}),{loading:v,run:y}=we((async()=>await async function(e){const s="/api/question/duplicate/".concat(e);return await Es.post(s)}(n)),{manual:!0,onSuccess(e){ee.success("复制成功"),t("/question/edit/".concat(e.id))}}),[C,b]=s.useState(!1),{loading:k,run:I}=we((async()=>await Os(n,{isDeleted:!0})),{manual:!0,onSuccess(){ee.success("删除成功"),b(!0)}});return C?null:Ye.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[Ye.jsxs("div",{className:"flex",children:[Ye.jsx("div",{className:"flex-1",children:Ye.jsx(K,{to:r?"/question/stat/".concat(n):"/question/edit/".concat(n),children:Ye.jsxs(Z,{children:[h&&Ye.jsx(a,{style:{color:"red"}}),i]})})}),Ye.jsx("div",{className:"flex-1 text-center font-size-3",children:Ye.jsxs(Z,{children:[r?Ye.jsx(ce,{color:"processing",children:"已发布"}):Ye.jsx(ce,{children:"未发布"}),Ye.jsxs("span",{children:["答卷: ",o]}),Ye.jsx("span",{children:u})]})})]}),Ye.jsx(ie,{className:"m-3"}),Ye.jsxs("div",{className:"flex",children:[Ye.jsx("div",{className:"flex-1",children:Ye.jsxs(Z,{children:[Ye.jsx(se,{icon:Ye.jsx(c,{}),type:"text",size:"small",onClick:()=>{t("/question/edit/".concat(n))},children:"编辑问卷"}),Ye.jsx(se,{icon:Ye.jsx(d,{}),type:"text",size:"small",onClick:()=>{t("/question/stat/".concat(n))},children:"数据统计"})]})}),Ye.jsx("div",{className:"flex-1 text-center",children:Ye.jsxs(Z,{children:[Ye.jsx(se,{type:"text",icon:Ye.jsx(a,{}),color:"#999",size:"small",onClick:g,disabled:f,children:p?"取消标星":"标星"}),Ye.jsx(de,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:y,children:Ye.jsx(se,{type:"text",icon:Ye.jsx(x,{}),color:"#999",size:"small",disabled:v,children:"复制"})}),Ye.jsx(se,{type:"text",icon:Ye.jsx(l,{}),size:"small",color:"#999",onClick:()=>{st({title:"确定删除该问卷?",icon:Ye.jsx(m,{}),onOk:I})},disabled:k,children:"删除"})]})})]})]})},{Search:nt}=ae,it=()=>{const e=J(),{pathname:t}=$(),[n,i]=s.useState("");const[r]=G();return s.useEffect((()=>{const e=r.get(Ss)||"";i(e)}),[r]),Ye.jsx(nt,{placeholder:"请输入关键字",value:n,onChange:function(e){i(e.target.value)},onSearch:function(s){e({pathname:t,search:"".concat(Ss,"=").concat(s)})},className:"w-50"})},{Title:rt}=le,at=()=>{const[e,t]=s.useState(!1),[n,i]=s.useState(1),[r,a]=s.useState([]),[l,o]=s.useState(0),c=l>r.length,[d]=G(),x=d.get(Ss)||"";s.useEffect((()=>{t(!1),i(1),a([]),o(0)}),[x]);const{run:m,loading:u}=we((async()=>await Ds({page:n,pageSize:10,keyword:x})),{manual:!0,onSuccess(e){const{list:s=[],total:t=0}=e;a(r.concat(s)),o(t),i(n+1)}}),h=s.useRef(null),{run:p}=Ne((()=>{const e=h.current;if(null==e)return;const s=e.getBoundingClientRect();if(null==s)return;const{bottom:n}=s;n<=document.body.clientHeight&&(m(),t(!0))}),{wait:1e3});s.useEffect((()=>{p()}),[d]),s.useEffect((()=>(c&&window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)})),[d,c]);const j=s.useMemo((()=>!e||u?Ye.jsx(ne,{}):0===l?Ye.jsx(me,{description:"暂无数据"}):c?Ye.jsx("span",{children:"开始加载下一页"}):Ye.jsx("span",{children:"没有更多了..."})),[e,u,c]);return Ye.jsxs(Ye.Fragment,{children:[Ye.jsxs("div",{className:"flex",children:[Ye.jsx("div",{className:"flex-1",children:Ye.jsx(rt,{level:3,children:"我的问卷"})}),Ye.jsx("div",{className:"flex-1 text-center",children:Ye.jsx(it,{})})]}),Ye.jsx("div",{className:"mb-5",children:r.length>0&&r.map((e=>{const{_id:s}=e;return Ye.jsx(tt,{...e},s)}))}),Ye.jsx("div",{className:"text-center color-blue",children:Ye.jsx("div",{ref:h,children:j})})]})},lt=e=>{const{total:t}=e,[n,i]=s.useState(1),[r,a]=s.useState(10),[l]=G();s.useEffect((()=>{const e=parseInt(l.get(Ps)||"")||1;i(e);const s=parseInt(l.get(_s)||"")||10;a(s)}),[l]);const o=J(),{pathname:c}=$();return Ye.jsx(ue,{current:n,pageSize:r,total:t,onChange:(e,s)=>{l.set(Ps,e.toString()),l.set(_s,s.toString()),o({pathname:c,search:l.toString()})}})},{Title:ot}=le,{confirm:ct}=xe,dt=()=>{Se("问卷调查");const{data:e={},loading:t,refresh:n}=Bs({isDeleted:!0}),{list:i=[],total:r=0}=e,[a,l]=s.useState([]),o=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?Ye.jsx(ce,{color:"processing",children:"已发布"}):Ye.jsx(ce,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:c}=we((async()=>{for await(const e of a)await Os(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){ee.success("恢复成功"),n(),l([])}}),{run:d}=we((async()=>await async function(e){return await Es.delete("/api/question",{data:{ids:e}})}(a)),{manual:!0,onSuccess(){ee.success("删除成功"),n(),l([])}});return Ye.jsxs(Ye.Fragment,{children:[Ye.jsxs("div",{className:"flex",children:[Ye.jsx("div",{className:"flex-1",children:Ye.jsx(ot,{level:3,children:"回收站"})}),Ye.jsx("div",{className:"flex-1 text-center",children:Ye.jsx(it,{})})]}),Ye.jsxs("div",{className:"mb-5",children:[t&&Ye.jsx("div",{className:"text-center",children:Ye.jsx(ne,{})}),!t&&0===i.length&&Ye.jsx(me,{description:"暂无数据"}),i.length>0&&Ye.jsxs("div",{children:[Ye.jsxs(Z,{className:"mb",children:[Ye.jsx(se,{type:"primary",disabled:0===a.length,onClick:c,children:"恢复"}),Ye.jsx(se,{danger:!0,disabled:0===a.length,onClick:()=>{ct({title:"确定彻底删除该问卷?",icon:Ye.jsx(m,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),Ye.jsx(he,{rowKey:e=>e._id,dataSource:i,columns:o,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{l(e)}}})]})]}),Ye.jsx("div",{className:"text-center color-blue",children:i.length>0&&Ye.jsx(lt,{total:r})})]})},{Title:xt}=le,mt=()=>{const{data:e={},loading:s}=Bs({isStar:!0}),{list:t=[],total:n=0}=e;return Ye.jsxs(Ye.Fragment,{children:[Ye.jsxs("div",{className:"flex",children:[Ye.jsx("div",{className:"flex-1",children:Ye.jsx(xt,{level:3,children:"星标问卷"})}),Ye.jsx("div",{className:"flex-1 text-center",children:Ye.jsx(it,{})})]}),Ye.jsxs("div",{className:"mb-5",children:[s&&Ye.jsx("div",{className:"text-center",children:Ye.jsx(ne,{})}),!s&&0===t.length&&Ye.jsx(me,{description:"暂无数据"}),t.length>0&&t.map((e=>{const{_id:s}=e;return Ye.jsx(tt,{...e},s)}))]}),Ye.jsx("div",{className:"text-center color-blue",children:t.length>0&&Ye.jsx(lt,{total:n})})]})},ut=()=>{const e=q(),{selectedId:s,componentList:t,selectedComponent:n,copiedComponent:i}=qs(),r=t.findIndex((e=>e.fe_id===s)),a=r<=0,o=r+1>=t.length,c=(null==n?void 0:n.isLocked)?"primary":"default",d=[{title:"删除",shape:"circle",icon:Ye.jsx(l,{}),onClick:()=>{e(js())}},{title:"隐藏",shape:"circle",icon:Ye.jsx(u,{}),onClick:()=>{e(fs({fe_id:s,isHidden:!0}))}},{title:"锁定",type:c,shape:"circle",icon:Ye.jsx(h,{}),onClick:()=>{e(gs({fe_id:s}))}},{title:"复制",shape:"circle",icon:Ye.jsx(x,{}),onClick:()=>{e(vs())}},{title:"粘贴",shape:"circle",icon:Ye.jsx(p,{}),onClick:()=>{e(ys())},disabled:null==i},{title:"上移",shape:"circle",icon:Ye.jsx(j,{}),onClick:()=>{a||e(Is({oldIndex:r,newIndex:r-1}))},disabled:a},{title:"下移",shape:"circle",icon:Ye.jsx(f,{}),onClick:()=>{o||e(Is({oldIndex:r,newIndex:r+1}))},disabled:o},{title:"撤销",shape:"circle",icon:Ye.jsx(g,{}),onClick:()=>{e(_e.undo())}},{title:"重做",shape:"circle",icon:Ye.jsx(v,{}),onClick:()=>{e(_e.redo())}}];return Ye.jsx(Z,{children:d.map((e=>{const{title:s,type:t,shape:n,icon:i,onClick:r,disabled:a}=e;return Ye.jsx(pe,{title:s,children:Ye.jsx(se,{type:t,shape:n,icon:i,onClick:r,disabled:a})},s)}))})},ht=()=>{const{title:e}=Ts(),t=q(),[n,i]=s.useState(!1),r=e=>{const s=e.target.value.trim();s&&t(ls(s))};return n?Ye.jsx(ae,{value:e,onChange:r,onPressEnter:()=>i(!1),onBlur:()=>i(!1)}):Ye.jsxs(Z,{children:[Ye.jsx("div",{children:e}),Ye.jsx(se,{icon:Ye.jsx(c,{}),type:"text",onClick:()=>i(!0)})]})},pt=()=>{const{id:e}=W(),{componentList:s=[]}=qs(),t=Ts(),{loading:n,run:i}=we((async()=>{e&&await Os(e,{...t,componentList:s})}),{manual:!0});return Ie(["ctrl.s","meta.s"],(e=>{e.preventDefault(),n||i()})),Pe((()=>{i()}),[s,t],{wait:1e3}),Ye.jsx(se,{onClick:i,disabled:n,icon:n?Ye.jsx(y,{}):null,children:"保存"})},jt=()=>{const e=J(),{id:s}=W(),{componentList:t=[]}=qs(),n=Ts(),{loading:i,run:r}=we((async()=>{s&&await Os(s,{...n,componentList:t,isPublished:!0})}),{manual:!0,onSuccess(){ee.success("发布成功"),e("/question/stat/"+s)}});return Ye.jsx(se,{type:"primary",onClick:r,disabled:i,icon:i?Ye.jsx(y,{}):null,children:"发布"})},ft=()=>Ye.jsxs(Z,{children:[Ye.jsx(pt,{}),Ye.jsx(jt,{})]}),gt=()=>{const e=J();return Ye.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[Ye.jsx("div",{className:"flex-1",children:Ye.jsxs(Z,{children:[Ye.jsx(se,{type:"link",icon:Ye.jsx(C,{}),onClick:()=>e(-1),children:"返回"}),Ye.jsx("div",{className:"mb-0 text-[18px] leading-none",children:Ye.jsx(ht,{})})]})}),Ye.jsx("div",{className:"flex-1 text-center leading-[2]",children:Ye.jsx(ut,{})}),Ye.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:Ye.jsx(ft,{})})]})},vt={title:"多选标题",isVertical:!1,list:[{value:"item1",text:"选项1",checked:!1},{value:"item2",text:"选项2",checked:!1},{value:"item3",text:"选项3",checked:!1}]},{Paragraph:yt}=le,Ct={title:"多选",type:"questionCheckbox",Component:e=>{const{title:s,isVertical:t,list:n=[]}={...vt,...e};return Ye.jsxs("div",{children:[Ye.jsx(yt,{strong:!0,children:s}),Ye.jsx(Z,{direction:t?"vertical":"horizontal",children:n.map((e=>{const{value:s,text:t,checked:n}=e;return Ye.jsx(je,{value:s,checked:n,children:t},s)}))})]})},PropComponent:e=>{const{title:s,isVertical:t,list:n=[],onChange:r,disabled:a}=e,[l]=re.useForm();return Ye.jsxs(re,{layout:"vertical",form:l,initialValues:{title:s,isVertical:t,list:n},disabled:a,onValuesChange:()=>{if(null==r)return;const e=l.getFieldsValue();e.list&&(e.list=e.list.filter((e=>!(null==e.text))));const{list:s=[]}=e;s.forEach((e=>{e.value||(e.value=os(5))})),r(e)},children:[Ye.jsx(re.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{label:"选项",children:Ye.jsx(re.List,{name:"list",children:(e,{add:s,remove:t})=>Ye.jsxs(Ye.Fragment,{children:[e.map((({key:e,name:s},n)=>Ye.jsxs(Z,{align:"baseline",children:[Ye.jsx(re.Item,{name:[s,"checked"],valuePropName:"checked",children:Ye.jsx(je,{})}),Ye.jsx(re.Item,{name:[s,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,s)=>{const{list:t=[]}=l.getFieldsValue();let n=0;return t.forEach((e=>{e.text===s&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:Ye.jsx(ae,{placeholder:"输入选项文字..."})}),n>0&&Ye.jsx(b,{onClick:()=>t(s)})]},e))),Ye.jsx(re.Item,{children:Ye.jsx(se,{type:"link",onClick:()=>s({text:"",value:"",checked:!1}),icon:Ye.jsx(i,{}),block:!0,children:"添加选项"})})]})})}),Ye.jsx(re.Item,{name:"isVertical",valuePropName:"checked",children:Ye.jsx(je,{children:"竖向排列"})})]})},StatComponent:({stat:e})=>Ye.jsx("div",{style:{width:"400px",height:"300px"},children:Ye.jsx(Fe,{width:"100%",height:"100%",children:Ye.jsxs(Ee,{width:400,height:300,data:e,margin:{top:5,right:30,left:0,bottom:5},children:[Ye.jsx(Le,{strokeDasharray:"3 3"}),Ye.jsx(Ve,{dataKey:"name"}),Ye.jsx(qe,{}),Ye.jsx(Te,{}),Ye.jsx(Re,{dataKey:"count",fill:"#8884d8"})]})})}),defaultProps:vt},bt={title:"问卷标题",desc:"问卷描述"},{Title:kt,Paragraph:It}=le,{TextArea:wt}=ae,Nt={title:"问卷信息",type:"questionInfo",Component:e=>{const{title:s,desc:t=""}={...bt,...e},n=t.split("\n");return Ye.jsxs("div",{style:{textAlign:"center"},children:[Ye.jsx(kt,{style:{fontSize:"24px"},children:s}),Ye.jsx(It,{children:n.map(((e,s)=>Ye.jsxs("span",{children:[s>0&&Ye.jsx("br",{}),e]},s)))})]})},PropComponent:e=>{const{title:t,desc:n,onChange:i,disabled:r}=e,[a]=re.useForm();return s.useEffect((()=>{a.setFieldsValue({title:t,desc:n})}),[t,n]),Ye.jsxs(re,{layout:"vertical",initialValues:{title:t,desc:n},onValuesChange:function(){i&&i(a.getFieldsValue())},disabled:r,form:a,children:[Ye.jsx(re.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入问卷标题"}],children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{label:"描述",name:"desc",children:Ye.jsx(wt,{})})]})},defaultProps:bt},St={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Pt}=le,_t={title:"输入框",type:"questionInput",Component:e=>{const{title:s,placeholder:t}={...St,...e};return Ye.jsxs("div",{children:[Ye.jsx(Pt,{strong:!0,children:s}),Ye.jsx("div",{children:Ye.jsx(ae,{placeholder:t})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:i,disabled:r}=e,[a]=re.useForm();return s.useEffect((()=>{a.setFieldsValue({title:t,placeholder:n})}),[t,n]),Ye.jsxs(re,{layout:"vertical",initialValues:{title:t,placeholder:n},form:a,onValuesChange:function(){i&&i(a.getFieldsValue())},disabled:r,children:[Ye.jsx(re.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{label:"Placeholder",name:"placeholder",children:Ye.jsx(ae,{})})]})},defaultProps:St},Ft={text:"一行段落",isCenter:!1},{Paragraph:Et}=le,{TextArea:Lt}=ae,Vt={title:"段落",type:"questionParagraph",Component:e=>{const{text:s="",isCenter:t=!1}={...Ft,...e},n=s.split("\n");return Ye.jsx(Et,{style:{textAlign:t?"center":"start",marginBottom:"0"},children:n.map(((e,s)=>Ye.jsxs("span",{children:[s>0&&Ye.jsx("br",{}),e]},s)))})},PropComponent:e=>{const{text:t,isCenter:n,onChange:i,disabled:r}=e,[a]=re.useForm();return s.useEffect((()=>{a.setFieldsValue({text:t,isCenter:n})}),[t,n]),Ye.jsxs(re,{layout:"vertical",initialValues:{text:t,isCenter:n},onValuesChange:function(){i&&i(a.getFieldsValue())},disabled:r,form:a,children:[Ye.jsx(re.Item,{label:"段落内容",name:"text",rules:[{required:!0,message:"请输入段落内容"}],children:Ye.jsx(Lt,{})}),Ye.jsx(re.Item,{name:"isCenter",valuePropName:"checked",children:Ye.jsx(je,{children:"居中显示"})})]})},defaultProps:Ft},qt={title:"单选标题",isVertical:!1,options:[{value:"item1",text:"选项1"},{value:"item2",text:"选项2"},{value:"item3",text:"选项3"}],value:""},{Paragraph:Tt}=le;const Rt={title:"单选",type:"questionRadio",Component:e=>{const{title:s,options:t=[],value:n,isVertical:i}={...qt,...e};return Ye.jsxs("div",{children:[Ye.jsx(Tt,{strong:!0,children:s}),Ye.jsx(fe.Group,{value:n,children:Ye.jsx(Z,{direction:i?"vertical":"horizontal",children:t.map((e=>{const{value:s,text:t}=e;return Ye.jsx(fe,{value:s,children:t},s)}))})})]})},PropComponent:e=>{const{title:t,isVertical:n,value:r,options:a=[],onChange:l,disabled:o}=e,[c]=re.useForm();return s.useEffect((()=>{c.setFieldsValue({title:t,isVertical:n,value:r,options:a})}),[t,n,r,a]),Ye.jsxs(re,{layout:"vertical",initialValues:{title:t,isVertical:n,value:r,options:a},onValuesChange:function(){if(null==l)return;const e=c.getFieldsValue();e.options&&(e.options=e.options.filter((e=>!(null==e.text))));const{options:s=[]}=e;s.forEach((e=>{e.value||(e.value=os(5))})),l(e)},disabled:o,form:c,children:[Ye.jsx(re.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{label:"选项",children:Ye.jsx(re.List,{name:"options",children:(e,{add:s,remove:t})=>Ye.jsxs(Ye.Fragment,{children:[e.map((({key:e,name:s},n)=>Ye.jsxs(Z,{align:"baseline",children:[Ye.jsx(re.Item,{name:[s,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,s)=>{const{options:t=[]}=c.getFieldsValue();let n=0;return t.forEach((e=>{e.text===s&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:Ye.jsx(ae,{placeholder:"输入选项文字..."})}),n>1&&Ye.jsx(b,{onClick:()=>t(s)})]},e))),Ye.jsx(re.Item,{children:Ye.jsx(se,{type:"link",onClick:()=>s({text:"",value:""}),icon:Ye.jsx(i,{}),block:!0,children:"添加选项"})})]})})}),Ye.jsx(re.Item,{label:"默认选中",name:"value",children:Ye.jsx(ge,{value:r,options:a.map((({text:e,value:s})=>({value:s,label:e||""})))})}),Ye.jsx(re.Item,{name:"isVertical",valuePropName:"checked",children:Ye.jsx(je,{children:"竖向排列"})})]})},defaultProps:qt,StatComponent:({stat:e=[]})=>{const t=s.useMemo((()=>{let s=0;return e.forEach((e=>s+=e.count)),s}),[e]);return Ye.jsx("div",{style:{width:"300px",height:"400px"},children:Ye.jsx(Fe,{width:"100%",height:"100%",children:Ye.jsxs(ze,{children:[Ye.jsx(De,{dataKey:"count",data:e,cx:"50%",cy:"50%",outerRadius:50,fill:"#8884d8",label:e=>"".concat(e.name,": ").concat((100*(e.count/t)).toFixed(2),"%"),children:e.map(((e,s)=>Ye.jsx(Oe,{fill:Fs[s]},s)))}),Ye.jsx(Te,{})]})})})}},zt={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Dt}=le,{TextArea:Ot}=ae,At={title:"多行输入",type:"questionTextarea",Component:e=>{const{title:s,placeholder:t}={...zt,...e};return Ye.jsxs("div",{children:[Ye.jsx(Dt,{strong:!0,children:s}),Ye.jsx("div",{children:Ye.jsx(Ot,{placeholder:t})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:i,disabled:r}=e,[a]=re.useForm();return s.useEffect((()=>{a.setFieldsValue({title:t,placeholder:n})}),[t,n]),Ye.jsxs(re,{layout:"vertical",initialValues:{title:t,placeholder:n},form:a,onValuesChange:function(){i&&i(a.getFieldsValue())},disabled:r,children:[Ye.jsx(re.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{label:"Placeholder",name:"placeholder",children:Ye.jsx(ae,{})})]})},defaultProps:zt},Ht={text:"一级标题",level:1,isCenter:!1},{Title:Bt}=le,Ut={title:"标题",type:"questionTitle",Component:e=>{const{text:s="",level:t=1,isCenter:n=!1}={...Ht,...e};return Ye.jsx(Bt,{level:t,style:{textAlign:n?"center":"start",marginBottom:"0",fontSize:(i=t,1===i?"24px":2===i?"20px":"16px")},children:s});var i},PropComponent:e=>{const{text:t,level:n,isCenter:i,onChange:r,disabled:a}=e,[l]=re.useForm();return s.useEffect((()=>{l.setFieldsValue({text:t,level:n,isCenter:i})}),[t,n,i]),Ye.jsxs(re,{form:l,layout:"vertical",onValuesChange:function(){r&&r(l.getFieldsValue())},initialValues:{text:t,level:n,isCenter:i},disabled:a,children:[Ye.jsx(re.Item,{label:"标题内容",name:"text",rules:[{required:!0,message:"请输入标题内容"}],children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{label:"层级",name:"level",children:Ye.jsx(ge,{options:[{value:1,text:1},{value:2,text:2},{value:3,text:3}]})}),Ye.jsx(re.Item,{name:"isCenter",valuePropName:"checked",children:Ye.jsx(je,{children:"居中显示"})})]})},defaultProps:Ht},Mt=[{groupId:"textGroup",groupName:"文本显示",components:[Nt,Vt,Ut]},{groupId:"inputGroup",groupName:"用户输入",components:[_t,At]},{groupId:"chooseGroup",groupName:"用户选择",components:[Ct,Rt]}],Kt=[Ct,Nt,_t,Vt,Rt,At,Ut];function Wt(e){return Kt.find((s=>s.type===e))}const{Title:Gt}=le,$t=()=>Ye.jsx(Ye.Fragment,{children:Mt.map(((e,t)=>{const{groupId:n,groupName:i,components:r}=e;return Ye.jsxs("div",{children:[Ye.jsx(Gt,{level:3,style:{fontSize:"16px",marginTop:t>0?"20px":"0"},children:i}),Ye.jsx("div",{children:r.map((e=>(e=>{const{title:t,type:n,Component:i,defaultProps:r}=e,a=q(),l=s.useCallback((()=>{a(hs({fe_id:os(),title:t,type:n,props:r}))}),[]);return Ye.jsx("div",{onClick:l,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:Ye.jsx("div",{className:"pointer-events-none",children:Ye.jsx(i,{})})},n)})(e)))})]},n)}))}),Jt=e=>{const{children:s,items:t,onDragEnd:n}=e,i=_(F(V,{activationConstraint:{distance:8}}));return Ye.jsx(E,{sensors:i,collisionDetection:L,onDragEnd:e=>{const{active:s,over:i}=e;if(null!=i&&s.id!==i.id){const e=t.findIndex((e=>e.fe_id===s.id)),r=t.findIndex((e=>e.fe_id===i.id));n(e,r)}},children:Ye.jsx(H,{items:t,strategy:B,children:s})})},Yt=({id:e,children:s})=>{const{attributes:t,listeners:n,setNodeRef:i,transform:r,transition:a}=U({id:e}),l={transform:Ae.Transform.toString(r),transition:a};return Ye.jsx("div",{ref:i,style:l,...t,...n,children:s})},Xt=()=>{const{componentList:e,selectedId:t}=qs(),n=q(),[i,r]=s.useState(""),a=e=>{const s=e.target.value.trim();s&&t&&n(ks({fe_id:t,title:s}))},l=e.map((e=>({...e,id:e.fe_id})));return Ye.jsx(Jt,{items:l,onDragEnd:(e,s)=>{n(Is({oldIndex:e,newIndex:s}))},children:e.map((s=>{const{fe_id:l,title:o,isHidden:c,isLocked:d}=s,x=k({"flex-auto line-height-loose":!0,"color-blue":l===t}),m="opacity-20",p=k({[m]:c}),j=k({[m]:c});return Ye.jsx(Yt,{id:l,children:Ye.jsxs("div",{className:"flex border-b border-b-green-200 border-b-solid py-2",children:[Ye.jsxs("div",{className:x,onClick:()=>(s=>{const i=e.find((e=>e.fe_id===s));return i&&i.isHidden?ee.info("不能选中隐藏的组件!"):s!==t?(n(us(s)),void r("")):void r(s)})(l),children:[l===i&&Ye.jsx(ae,{value:o,onChange:a,onPressEnter:()=>r(""),onBlur:()=>r("")}),l!==i&&o]}),Ye.jsx("div",{className:"w-12 text-end",children:Ye.jsxs(Z,{children:[Ye.jsx(se,{size:"small",shape:"circle",className:p,icon:Ye.jsx(u,{}),type:c?"primary":"text",onClick:()=>((e,s)=>{n(fs({fe_id:e,isHidden:s}))})(l,!c)}),Ye.jsx(se,{size:"small",shape:"circle",className:j,icon:Ye.jsx(h,{}),type:d?"primary":"text",onClick:()=>(e=>{n(gs({fe_id:e}))})(l)})]})})]})},l)}))})},Qt=()=>{const e=[{key:"componentLib",label:Ye.jsxs("span",{children:[Ye.jsx(I,{}),"组件库"]}),children:Ye.jsx($t,{})},{key:"layers",label:Ye.jsxs("span",{children:[Ye.jsx(r,{}),"图层"]}),children:Ye.jsx(Xt,{})}];return Ye.jsx(Ye.Fragment,{children:Ye.jsx(ve,{items:e,defaultActiveKey:"componentLib"})})},Zt=({loading:e})=>{const{componentList:s,selectedIs:t}=qs(),n=q();if(function(){const e=q();Ie(["backspace","delete"],(()=>{Vs()&&e(js())})),Ie(["ctrl.c","meta.c"],(()=>{Vs()&&e(vs())})),Ie(["ctrl.v","meta.v"],(()=>{Vs()&&e(ys())})),Ie("uparrow",(()=>{Vs()&&e(Cs())})),Ie("downarrow",(()=>{Vs()&&e(bs())})),Ie(["ctrl.z","meta.z"],(()=>{Vs()&&e(_e.undo())}),{exactMatch:!0}),Ie(["ctrl.shift.z","meta.shift.z"],(()=>{Vs()&&e(_e.redo())}))}(),e)return Ye.jsx("div",{className:"mt-6 text-center",children:Ye.jsx(ne,{})});const i=e=>{const{type:s,props:t}=e,n=Wt(s);if(null==n)return null;const{Component:i}=n;return Ye.jsx(i,{...t})},r=s.map((e=>({...e,id:e.fe_id})));return Ye.jsx(Jt,{items:r,onDragEnd:(e,s)=>{n(Is({oldIndex:e,newIndex:s}))},children:Ye.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:s.map((e=>{const{fe_id:s}=e,t=k({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return Ye.jsx(Yt,{id:s,children:Ye.jsx("div",{className:t,onClick:e=>{return t=s,e.stopPropagation(),void n(us(t));var t},children:Ye.jsx("div",{className:"pointer-events-none",children:i(e)})})},s)}))})})},en=()=>Ye.jsx("div",{className:"text-center",children:"未选中组件"}),sn=()=>{const e=q(),{selectedComponent:s}=qs();if(null==s)return Ye.jsx(en,{});const{type:t,props:n}=s,i=Wt(t);if(null==i)return Ye.jsx(en,{});const{PropComponent:r}=i;return Ye.jsx(r,{...n,onChange:t=>{const{fe_id:n}=s;e(ps({fe_id:n,newProps:t}))}})},tn=()=>{const e=Ts(),[s]=re.useForm(),t=q();return Ye.jsxs(re,{layout:"vertical",initialValues:e,onValuesChange:()=>{t(as(s.getFieldsValue()))},form:s,children:[Ye.jsx(re.Item,{name:"title",label:"问卷标题",rules:[{required:!0,message:"请输入标题"}],children:Ye.jsx(ae,{placeholder:"请输入标题"})}),Ye.jsx(re.Item,{name:"desc",label:"问卷描述",children:Ye.jsx(ye,{placeholder:"问卷描述信息"})}),Ye.jsx(re.Item,{name:"css",label:"样式代码",children:Ye.jsx(ye,{placeholder:"请输入 CSS 样式代码"})}),Ye.jsx(re.Item,{name:"js",label:"脚本代码",children:Ye.jsx(ye,{placeholder:"请输入 JS 脚本代码"})})]})},nn=()=>{const[e,t]=s.useState("prop"),{selectedId:n}=qs();s.useEffect((()=>{t(n?"prop":"setting")}),[n]);const i=[{key:"prop",label:Ye.jsxs("span",{children:[Ye.jsx(w,{}),"属性"]}),children:Ye.jsx(sn,{})},{key:"setting",label:Ye.jsxs("span",{children:[Ye.jsx(N,{}),"页面设置"]}),children:Ye.jsx(tn,{})}];return Ye.jsx(ve,{activeKey:e,items:i})},rn=()=>{const e=q(),{loading:s}=Hs(),{title:t}=Ts(),n=t?"问卷编辑 - ".concat(t):"问卷调查";Se(n);return Ye.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[Ye.jsx(gt,{}),Ye.jsx("div",{className:"flex-1 py-3",children:Ye.jsxs("div",{className:"mx-6 h-100% flex",children:[Ye.jsx("div",{className:"w-75 bg-white px-3",children:Ye.jsx(Qt,{})}),Ye.jsx("div",{className:"relative flex-1 overflow-hidden",onClick:()=>{e(us(""))},children:Ye.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:Ye.jsx(Zt,{loading:s})})}),Ye.jsx("div",{className:"w-75 bg-white px-3",children:Ye.jsx(nn,{})})]})})]})},an=()=>{const{loading:e,questionData:s}=Hs();return Ye.jsxs("div",{children:[Ye.jsx("p",{children:"Stat"}),e?Ye.jsx("p",{children:"loading"}):Ye.jsx("p",{children:JSON.stringify(s)})]})},{Title:ln,Paragraph:on}=le,cn=()=>{const e=J();return Ye.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:Ye.jsxs("div",{className:"text-center",children:[Ye.jsx(ln,{children:"问卷调查 | 在线投票"}),Ye.jsx(on,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),Ye.jsx("div",{className:"h-15 font-24",children:Ye.jsx(se,{className:"b-rounded-4",type:"primary",onClick:()=>e(gn),children:"开始使用"})})]})})},{Title:dn}=le,xn="USERNAME",mn="PASSWORD";const un=()=>{const e=J(),t=q(),[n]=re.useForm();s.useEffect((()=>{const{username:e,password:s}={username:localStorage.getItem(xn),password:localStorage.getItem(mn)};n.setFieldsValue({username:e,password:s})}),[]);const{run:i}=we((async(e,s)=>{const n=await async function(e,s){const t={username:e,password:s};return await Es.post("/api/user/login",t)}(e,s);return n.token&&t(ts({username:e,nickname:e})),n}),{manual:!0,onSuccess(s){const{token:t=""}=s;!function(e){localStorage.setItem(Ls,e)}(t),ee.success("登录成功"),e(gn)}});return Ye.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[Ye.jsx("div",{children:Ye.jsxs(Z,{children:[Ye.jsx(dn,{level:2,children:Ye.jsx(o,{})}),Ye.jsx(dn,{level:2,children:"登录"})]})}),Ye.jsx("div",{children:Ye.jsxs(re,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{const{username:s,password:t,remember:n}=e||{};i(s,t),n?function(e,s){localStorage.setItem(xn,e),localStorage.setItem(mn,s)}(s,t):(localStorage.removeItem(xn),localStorage.removeItem(mn))},children:[Ye.jsx(re.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:Ye.jsx(ae,{})}),Ye.jsx(re.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:Ye.jsx(ae.Password,{})}),Ye.jsx(re.Item,{name:"remember",valuePropName:"checked",wrapperCol:{offset:0,span:10},children:Ye.jsx(je,{children:"记住我"})}),Ye.jsx(re.Item,{wrapperCol:{offset:4,span:18},children:Ye.jsxs(Z,{children:[Ye.jsx(se,{type:"primary",htmlType:"submit",children:"登录"}),Ye.jsx(K,{to:fn,children:"注册新用户"})]})})]})})]})},hn=X([{path:"/",element:Ye.jsx(Js,{}),children:[{path:"/",element:Ye.jsx(cn,{})},{path:"login",element:Ye.jsx(un,{})},{path:"register",element:Ye.jsx(Zs,{})},{path:"manage",element:Ye.jsx(Ys,{}),children:[{path:"list",element:Ye.jsx(at,{})},{path:"star",element:Ye.jsx(mt,{})},{path:"trash",element:Ye.jsx(dt,{})}]},{path:"*",element:Ye.jsx(et,{})}]},{path:"question",element:Ye.jsx(Xs,{}),children:[{path:"edit/:id",element:Ye.jsx(rn,{})},{path:"stat/:id",element:Ye.jsx(an,{})}]}],{basename:"/survey-sage"}),pn="/",jn="/login",fn="/register",gn="/manage/list";const vn=()=>Ye.jsx(Ce,{theme:{algorithm:be.defaultAlgorithm},children:Ye.jsx(Q,{router:hn})});Xe.createRoot(document.getElementById("root")).render(Ye.jsx(S.StrictMode,{children:Ye.jsx(R,{store:ws,children:Ye.jsx(vn,{})})}));export{e as __vite_legacy_guard};
