function e(){import.meta.url,import("_").catch((()=>1))}import{r as t,af as s,ag as n,U as i,M as r,ah as l,ai as a,aj as o,ad as c,ak as d,ae as x,al as m,W as u,am as h,an as p,ao as j,K as f,ap as g,aq as v,L as y,O as C,ar as b,z as w,as as I,at as k,au as N,av as S,R as P}from"./@ant-design/icons-74a3c655.js";import{r as _,d as F,e as E,D as L,f as V,M as q}from"./@dnd-kit/core-d69b4d30.js";import{u as T,a as z,P as R}from"./react-redux-70fabaf9.js";import{c as D,p as A,a as O}from"./@reduxjs/toolkit-9493dcd7.js";import{a as H,S as B,v as M,u as U}from"./@dnd-kit/sortable-97301ac0.js";import{c as K}from"./lodash-es-34fbd7b9.js";import{C as G,D as W,M as $}from"./redux-undo-58253284.js";import{L as J,u as Y,a as Q,b as X,c as Z,O as ee,d as te,R as se}from"./react-router-dom-a5073cc0.js";import{S as ne,m as ie,B as re,L as le,a as ae,D as oe,F as ce,I as de,T as xe,R as me,b as ue,P as he,M as pe,E as je,c as fe,d as ge,e as ve,C as ye,f as Ce,g as be,h as we,i as Ie,j as ke,Q as Ne,k as Se,t as Pe}from"./antd-4dd5c312.js";import{a as _e}from"./axios-83bdef92.js";import{F as Fe,G as Ee,H as Le,I as Ve,J as qe}from"./ahooks-d1ed29b4.js";import{R as Te,B as ze,C as Re,X as De,Y as Ae,T as Oe,a as He,P as Be,b as Me,c as Ue}from"./recharts-cc46d28e.js";import{C as Ke}from"./@dnd-kit/utilities-456bb9d8.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Ge={exports:{}},We={},$e=t,Je=Symbol.for("react.element"),Ye=Symbol.for("react.fragment"),Qe=Object.prototype.hasOwnProperty,Xe=$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ze={key:!0,ref:!0,__self:!0,__source:!0};function et(e,t,s){var n,i={},r=null,l=null;for(n in void 0!==s&&(r=""+s),void 0!==t.key&&(r=""+t.key),void 0!==t.ref&&(l=t.ref),t)Qe.call(t,n)&&!Ze.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:Je,type:e,key:r,ref:l,props:i,_owner:Xe.current}}We.Fragment=Ye,We.jsx=et,We.jsxs=et,Ge.exports=We;var tt=Ge.exports;var st={},nt=_;st.createRoot=nt.createRoot,st.hydrateRoot=nt.hydrateRoot;const it={username:"",nickname:""},rt=D({name:"user",initialState:it,reducers:{loginReducer:(e,t)=>t.payload,logoutReducer:()=>it}}),lt=rt.reducer,{loginReducer:at,logoutReducer:ot}=rt.actions,ct=D({name:"pageInfo",initialState:{title:"",desc:"",js:"",css:""},reducers:{resetPageInfo:(e,t)=>t.payload,changePageTitle:A(((e,t)=>{e.title=t.payload}))}}),dt=ct.reducer,{resetPageInfo:xt,changePageTitle:mt}=ct.actions;let ut=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"");const ht=D({name:"components",initialState:{componentList:[],selectedId:"",copiedComponent:null},reducers:{resetComponents:(e,t)=>t.payload,changeSelectedId:A(((e,t)=>{e.selectedId=t.payload})),addComponent:A(((e,t)=>{jt(e,t.payload)})),changeComponentProps:A(((e,t)=>{const{fe_id:s,newProps:n}=t.payload,i=e.componentList.find((e=>e.fe_id===s));i&&(i.props={...i.props,...n})})),removeSelectedComponent:A((e=>{const{componentList:t=[],selectedId:s}=e,n=pt(s,t);e.selectedId=n;const i=t.findIndex((e=>e.fe_id===s));t.splice(i,1)})),changeComponentHidden:A(((e,t)=>{const{componentList:s=[]}=e,{fe_id:n,isHidden:i}=t.payload;let r="";r=i?pt(n,s):n,e.selectedId=r;const l=s.find((e=>e.fe_id===n));l&&(l.isHidden=i)})),toggleComponentLocked:A(((e,t)=>{const{fe_id:s}=t.payload,n=e.componentList.find((e=>e.fe_id===s));n&&(n.isLocked=!n.isLocked)})),copySelectedComponent:A((e=>{const{selectedId:t,componentList:s=[]}=e,n=s.find((e=>e.fe_id===t));null!=n&&(e.copiedComponent=K(n))})),pasteCopiedComponent:A((e=>{const{copiedComponent:t}=e;null!=t&&(t.fe_id=ut(),jt(e,t))})),selectPrevComponent:A((e=>{const{selectedId:t,componentList:s}=e,n=s.findIndex((e=>e.fe_id===t));n<0||n<=0||(e.selectedId=s[n-1].fe_id)})),selectNextComponent:A((e=>{const{selectedId:t,componentList:s}=e,n=s.findIndex((e=>e.fe_id===t));n<0||n+1!==s.length&&(e.selectedId=s[n+1].fe_id)})),changeComponentTitle:A(((e,t)=>{const{title:s,fe_id:n}=t.payload,i=e.componentList.find((e=>e.fe_id===n));i&&(i.title=s)})),moveComponent:A(((e,t)=>{const{componentList:s}=e,{oldIndex:n,newIndex:i}=t.payload;e.componentList=H(s,n,i)}))}});function pt(e,t){const s=t.filter((e=>!e.isHidden)),n=s.findIndex((t=>t.fe_id===e));if(n<0)return"";let i="";const r=s.length;return i=r<=1?"":n+1===r?s[n-1].fe_id:s[n+1].fe_id,i}function jt(e,t){const{selectedId:s,componentList:n}=e,i=n.findIndex((e=>e.fe_id===s));i<0?e.componentList.push(t):e.componentList.splice(i+1,0,t),e.selectedId=t.fe_id}const{resetComponents:ft,changeSelectedId:gt,addComponent:vt,changeComponentProps:yt,removeSelectedComponent:Ct,changeComponentHidden:bt,toggleComponentLocked:wt,copySelectedComponent:It,pasteCopiedComponent:kt,selectPrevComponent:Nt,selectNextComponent:St,changeComponentTitle:Pt,moveComponent:_t}=ht.actions,Ft=O({reducer:{user:lt,pageInfo:dt,components:G(ht.reducer,{limit:20,filter:W(["components/resetComponents","components/changeSelectedId","components/selectPrevComponent","components/selectNextComponent"])})}}),Et=()=>tt.jsx("div",{children:tt.jsx(J,{to:"/",children:tt.jsx(ne,{children:tt.jsxs("div",{className:"text-7 color-white",children:[tt.jsx(s,{}),tt.jsx("span",{children:"问卷调查"})]})})})}),Lt="keyword",Vt="page",qt="pageSize",Tt=["#FF2D2D","#BE77FF","#2894FF","#00EC00","#EAC100","#FF9D6F"],zt=_e.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});zt.interceptors.request.use((e=>(e.headers.Authorization="Bearer ".concat(localStorage.getItem(Rt)||""),e)),(e=>(ie.error(e.message),Promise.reject(e)))),zt.interceptors.response.use((e=>{const t=e.data||{},{errno:s,data:n,msg:i}=t;return 203===s||0!==s&&200!==s?(ie.error(i||"请求失败"),Promise.reject(n)):n}),(e=>{var t;let s="";switch(null==(t=e.response)?void 0:t.status){case 401:s="token 失效，请重新登录";break;case 403:s="拒绝访问";break;case 404:s="请求地址错误";break;case 500:s="服务器故障";break;default:s="网络连接故障"}return ie.error(s),Promise.reject(e)}));const Rt="USER_TOKEN";const Dt=()=>document.activeElement===document.body;function At(){const e=z((e=>e.components.present)),{componentList:t=[],selectedId:s,copiedComponent:n}=e,i=t.find((e=>e.fe_id===s));return{componentList:t,selectedId:s,selectedComponent:i,copiedComponent:n}}function Ot(){return z((e=>e.pageInfo))}function Ht(){const{username:e,nickname:t}=z((e=>e.user));return{username:e,nickname:t}}async function Bt(){return await zt.post("/api/question/")}async function Mt(e={}){return await zt.get("/api/question",{params:e})}async function Ut(e,t){const s="/api/question/".concat(e);return await zt.patch(s,t)}async function Kt(){return await zt.get("/api/user/info")}function Gt(){const{id:e=""}=Y(),s=T(),{data:n,loading:i,error:r,run:l}=Ee((async e=>{if(!e)throw new Error("缺少问卷 id");const t=await async function(e){const t="/api/question/".concat(e);return await zt.get(t)}(e);return t}),{manual:!0});return t.useEffect((()=>{if(!n)return;const{title:e="",desc:t="",js:i="",css:r="",componentList:l=[]}=n;let a="";l.length>0&&(a=l[0].fe_id),s(ft({componentList:l,selectedId:a,copiedComponent:null})),s(xt({title:e,desc:t,js:i,css:r}))}),[n]),t.useEffect((()=>{l(e)}),[e]),{loading:i,error:r}}function Wt(e={}){const{isStar:t,isDeleted:s}=e,[n]=Q(),{data:i,loading:r,error:l,refresh:a}=Ee((async()=>{const e=n.get(Lt)||"",i=parseInt(n.get(Vt)||"")||1,r=parseInt(n.get(qt)||"")||10;return await Mt({keyword:e,isStar:t,isDeleted:s,page:i,pageSize:r})}),{refreshDeps:[n]});return{data:i,loading:r,error:l,refresh:a}}function $t(){const e=T(),[s,n]=t.useState(!0),{run:i}=Ee(Kt,{manual:!0,onSuccess(t){const{username:s,nickname:n}=t;e(at({username:s,nickname:n}))},onFinally(){n(!1)}}),{username:r}=Ht();return t.useEffect((()=>{r?n(!1):i()}),[s]),{waitingUserData:s}}function Jt(e){const{username:s}=Ht(),{pathname:n}=X(),i=Z();t.useEffect((()=>{e||(s?function(e){return[Fn,En].includes(e)}(n)&&i(Ln):function(e){return[_n,Fn,En].includes(e)}(n)||i(Fn))}),[e,s,n])}const Yt=()=>{const e=Z(),t=T(),{username:s,nickname:i}=Ht();const r=tt.jsxs(tt.Fragment,{children:[tt.jsxs("span",{className:"color-light",children:[tt.jsx(n,{}),i]}),tt.jsx(re,{type:"link",onClick:function(){t(ot()),localStorage.removeItem(Rt),ie.success("退出成功"),e(Fn)},children:"退出"})]}),l=tt.jsx(J,{to:Fn,children:"登录"});return tt.jsx(tt.Fragment,{children:s?r:l})},{Header:Qt,Content:Xt,Footer:Zt}=le,es=()=>{const{waitingUserData:e}=$t();return Jt(e),tt.jsxs(le,{children:[tt.jsxs(Qt,{className:"px-6",children:[tt.jsx("div",{className:"float-left",children:tt.jsx(Et,{})}),"MainLayout header",tt.jsx("div",{className:"float-right",children:tt.jsx(Yt,{})})]}),tt.jsx(Xt,{className:"min-h-[calc(100vh-140px)]",children:e?tt.jsx("div",{className:"mt-15 text-center",children:tt.jsx(ae,{})}):tt.jsx(ee,{})}),tt.jsx(Zt,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"问卷调查 ©2023 - present. Created by Huy"})]})},ts=()=>{const e=Z(),{pathname:t}=X(),{loading:s,run:n}=Ee(Bt,{manual:!0,onSuccess(t){e("question/edit/".concat(t.id)),ie.success("创建成功")}});return tt.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[tt.jsx("div",{className:"w-30",children:tt.jsxs(ne,{direction:"vertical",children:[tt.jsx(re,{type:"primary",size:"large",icon:tt.jsx(i,{}),onClick:n,disabled:s,children:"新建问卷"}),tt.jsx(oe,{}),tt.jsx(re,{type:t.startsWith("/manage/list")?"default":"text",size:"large",icon:tt.jsx(r,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),tt.jsx(re,{type:t.startsWith("/manage/star")?"default":"text",size:"large",icon:tt.jsx(l,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),tt.jsx(re,{type:t.startsWith("/manage/trash")?"default":"text",size:"large",icon:tt.jsx(a,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),tt.jsx("div",{className:"ml-15 flex-1",children:tt.jsx(ee,{})})]})},ss=()=>{const{waitingUserData:e}=$t();return Jt(e),tt.jsx("div",{className:"h-screen",children:e?tt.jsx("div",{className:"mt-15 text-center",children:tt.jsx(ae,{})}):tt.jsx(ee,{})})},{Title:ns}=xe,is=()=>{const e=Z(),{run:t}=Ee((async e=>{const{username:t,password:s,nickname:n}=e;await async function(e,t,s){const n={username:e,password:t,nickname:s||e};return await zt.post("/api/user/register",n)}(t,s,n)}),{manual:!0,onSuccess(){ie.success("注册成功"),e(Fn)}});return tt.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[tt.jsx("div",{children:tt.jsxs(ne,{children:[tt.jsx(ns,{level:2,children:tt.jsx(o,{})}),tt.jsx(ns,{level:2,children:"注册新用户"})]})}),tt.jsx("div",{children:tt.jsxs(ce,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{t(e)},children:[tt.jsx(ce.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:tt.jsx(de,{})}),tt.jsx(ce.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:tt.jsx(de.Password,{})}),tt.jsx(ce.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(t,s)=>s&&e("password")!==s?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:tt.jsx(de.Password,{})}),tt.jsx(ce.Item,{label:"昵称",name:"nickname",children:tt.jsx(de,{})}),tt.jsx(ce.Item,{wrapperCol:{offset:4,span:18},children:tt.jsxs(ne,{children:[tt.jsx(re,{type:"primary",htmlType:"submit",children:"注册"}),tt.jsx(J,{to:Fn,children:"已有账户，请登录"})]})})]})})]})},rs=()=>{const e=Z();return tt.jsx(tt.Fragment,{children:tt.jsx(me,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:tt.jsx(re,{type:"primary",onClick:()=>e(Ln),children:"返回首页"})})})},{confirm:ls}=pe,as=e=>{const s=Z(),{_id:n,title:i,isPublished:r,answerContent:o,currentAt:u,isStar:h}=e,[p,j]=t.useState(h),{loading:f,run:g}=Ee((async()=>{await Ut(n,{isStar:!p})}),{manual:!0,onSuccess(){j(!p),ie.success("已更新")}}),{loading:v,run:y}=Ee((async()=>await async function(e){const t="/api/question/duplicate/".concat(e);return await zt.post(t)}(n)),{manual:!0,onSuccess(e){ie.success("复制成功"),s("/question/edit/".concat(e.id))}}),[C,b]=t.useState(!1),{loading:w,run:I}=Ee((async()=>await Ut(n,{isDeleted:!0})),{manual:!0,onSuccess(){ie.success("删除成功"),b(!0)}});return C?null:tt.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[tt.jsxs("div",{className:"flex",children:[tt.jsx("div",{className:"flex-1",children:tt.jsx(J,{to:r?"/question/stat/".concat(n):"/question/edit/".concat(n),children:tt.jsxs(ne,{children:[h&&tt.jsx(l,{style:{color:"red"}}),i]})})}),tt.jsx("div",{className:"flex-1 text-center font-size-3",children:tt.jsxs(ne,{children:[r?tt.jsx(ue,{color:"processing",children:"已发布"}):tt.jsx(ue,{children:"未发布"}),tt.jsxs("span",{children:["答卷: ",o]}),tt.jsx("span",{children:u})]})})]}),tt.jsx(oe,{className:"m-3"}),tt.jsxs("div",{className:"flex",children:[tt.jsx("div",{className:"flex-1",children:tt.jsxs(ne,{children:[tt.jsx(re,{icon:tt.jsx(c,{}),type:"text",size:"small",onClick:()=>{s("/question/edit/".concat(n))},children:"编辑问卷"}),tt.jsx(re,{icon:tt.jsx(d,{}),type:"text",size:"small",onClick:()=>{s("/question/stat/".concat(n))},children:"数据统计"})]})}),tt.jsx("div",{className:"flex-1 text-center",children:tt.jsxs(ne,{children:[tt.jsx(re,{type:"text",icon:tt.jsx(l,{}),color:"#999",size:"small",onClick:g,disabled:f,children:p?"取消标星":"标星"}),tt.jsx(he,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:y,children:tt.jsx(re,{type:"text",icon:tt.jsx(x,{}),color:"#999",size:"small",disabled:v,children:"复制"})}),tt.jsx(re,{type:"text",icon:tt.jsx(a,{}),size:"small",color:"#999",onClick:()=>{ls({title:"确定删除该问卷?",icon:tt.jsx(m,{}),onOk:I})},disabled:w,children:"删除"})]})})]})]})},{Search:os}=de,cs=()=>{const e=Z(),{pathname:s}=X(),[n,i]=t.useState("");const[r]=Q();return t.useEffect((()=>{const e=r.get(Lt)||"";i(e)}),[r]),tt.jsx(os,{placeholder:"请输入关键字",value:n,onChange:function(e){i(e.target.value)},onSearch:function(t){e({pathname:s,search:"".concat(Lt,"=").concat(t)})},className:"w-50"})},{Title:ds}=xe,xs=()=>{const[e,s]=t.useState(!1),[n,i]=t.useState(1),[r,l]=t.useState([]),[a,o]=t.useState(0),c=a>r.length,[d]=Q(),x=d.get(Lt)||"";t.useEffect((()=>{s(!1),i(1),l([]),o(0)}),[x]);const{run:m,loading:u}=Ee((async()=>await Mt({page:n,pageSize:10,keyword:x})),{manual:!0,onSuccess(e){const{list:t=[],total:s=0}=e;l(r.concat(t)),o(s),i(n+1)}}),h=t.useRef(null),{run:p}=Le((()=>{const e=h.current;if(null==e)return;const t=e.getBoundingClientRect();if(null==t)return;const{bottom:n}=t;n<=document.body.clientHeight&&(m(),s(!0))}),{wait:1e3});t.useEffect((()=>{p()}),[d]),t.useEffect((()=>(c&&window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)})),[d,c]);const j=t.useMemo((()=>!e||u?tt.jsx(ae,{}):0===a?tt.jsx(je,{description:"暂无数据"}):c?tt.jsx("span",{children:"开始加载下一页"}):tt.jsx("span",{children:"没有更多了..."})),[e,u,c]);return tt.jsxs(tt.Fragment,{children:[tt.jsxs("div",{className:"flex",children:[tt.jsx("div",{className:"flex-1",children:tt.jsx(ds,{level:3,children:"我的问卷"})}),tt.jsx("div",{className:"flex-1 text-center",children:tt.jsx(cs,{})})]}),tt.jsx("div",{className:"mb-5",children:r.length>0&&r.map((e=>{const{_id:t}=e;return tt.jsx(as,{...e},t)}))}),tt.jsx("div",{className:"text-center color-blue",children:tt.jsx("div",{ref:h,children:j})})]})},ms=e=>{const{total:s}=e,[n,i]=t.useState(1),[r,l]=t.useState(10),[a]=Q();t.useEffect((()=>{const e=parseInt(a.get(Vt)||"")||1;i(e);const t=parseInt(a.get(qt)||"")||10;l(t)}),[a]);const o=Z(),{pathname:c}=X();return tt.jsx(fe,{current:n,pageSize:r,total:s,onChange:(e,t)=>{a.set(Vt,e.toString()),a.set(qt,t.toString()),o({pathname:c,search:a.toString()})}})},{Title:us}=xe,{confirm:hs}=pe,ps=()=>{Ve("问卷调查");const{data:e={},loading:s,refresh:n}=Wt({isDeleted:!0}),{list:i=[],total:r=0}=e,[l,a]=t.useState([]),o=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?tt.jsx(ue,{color:"processing",children:"已发布"}):tt.jsx(ue,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:c}=Ee((async()=>{for await(const e of l)await Ut(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){ie.success("恢复成功"),n(),a([])}}),{run:d}=Ee((async()=>await async function(e){return await zt.delete("/api/question",{data:{ids:e}})}(l)),{manual:!0,onSuccess(){ie.success("删除成功"),n(),a([])}});return tt.jsxs(tt.Fragment,{children:[tt.jsxs("div",{className:"flex",children:[tt.jsx("div",{className:"flex-1",children:tt.jsx(us,{level:3,children:"回收站"})}),tt.jsx("div",{className:"flex-1 text-center",children:tt.jsx(cs,{})})]}),tt.jsxs("div",{className:"mb-5",children:[s&&tt.jsx("div",{className:"text-center",children:tt.jsx(ae,{})}),!s&&0===i.length&&tt.jsx(je,{description:"暂无数据"}),i.length>0&&tt.jsxs("div",{children:[tt.jsxs(ne,{className:"mb",children:[tt.jsx(re,{type:"primary",disabled:0===l.length,onClick:c,children:"恢复"}),tt.jsx(re,{danger:!0,disabled:0===l.length,onClick:()=>{hs({title:"确定彻底删除该问卷?",icon:tt.jsx(m,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),tt.jsx(ge,{rowKey:e=>e._id,dataSource:i,columns:o,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{a(e)}}})]})]}),tt.jsx("div",{className:"text-center color-blue",children:i.length>0&&tt.jsx(ms,{total:r})})]})},{Title:js}=xe,fs=()=>{const{data:e={},loading:t}=Wt({isStar:!0}),{list:s=[],total:n=0}=e;return tt.jsxs(tt.Fragment,{children:[tt.jsxs("div",{className:"flex",children:[tt.jsx("div",{className:"flex-1",children:tt.jsx(js,{level:3,children:"星标问卷"})}),tt.jsx("div",{className:"flex-1 text-center",children:tt.jsx(cs,{})})]}),tt.jsxs("div",{className:"mb-5",children:[t&&tt.jsx("div",{className:"text-center",children:tt.jsx(ae,{})}),!t&&0===s.length&&tt.jsx(je,{description:"暂无数据"}),s.length>0&&s.map((e=>{const{_id:t}=e;return tt.jsx(as,{...e},t)}))]}),tt.jsx("div",{className:"text-center color-blue",children:s.length>0&&tt.jsx(ms,{total:n})})]})},gs=()=>{const e=T(),{selectedId:t,componentList:s,selectedComponent:n,copiedComponent:i}=At(),r=s.findIndex((e=>e.fe_id===t)),l=r<=0,o=r+1>=s.length,c=(null==n?void 0:n.isLocked)?"primary":"default",d=[{title:"删除",shape:"circle",icon:tt.jsx(a,{}),onClick:()=>{e(Ct())}},{title:"隐藏",shape:"circle",icon:tt.jsx(u,{}),onClick:()=>{e(bt({fe_id:t,isHidden:!0}))}},{title:"锁定",type:c,shape:"circle",icon:tt.jsx(h,{}),onClick:()=>{e(wt({fe_id:t}))}},{title:"复制",shape:"circle",icon:tt.jsx(x,{}),onClick:()=>{e(It())}},{title:"粘贴",shape:"circle",icon:tt.jsx(p,{}),onClick:()=>{e(kt())},disabled:null==i},{title:"上移",shape:"circle",icon:tt.jsx(j,{}),onClick:()=>{l||e(_t({oldIndex:r,newIndex:r-1}))},disabled:l},{title:"下移",shape:"circle",icon:tt.jsx(f,{}),onClick:()=>{o||e(_t({oldIndex:r,newIndex:r+1}))},disabled:o},{title:"撤销",shape:"circle",icon:tt.jsx(g,{}),onClick:()=>{e($.undo())}},{title:"重做",shape:"circle",icon:tt.jsx(v,{}),onClick:()=>{e($.redo())}}];return tt.jsx(ne,{children:d.map((e=>{const{title:t,type:s,shape:n,icon:i,onClick:r,disabled:l}=e;return tt.jsx(ve,{title:t,children:tt.jsx(re,{type:s,shape:n,icon:i,onClick:r,disabled:l})},t)}))})},vs=()=>{const{title:e}=Ot(),s=T(),[n,i]=t.useState(!1),r=e=>{const t=e.target.value.trim();t&&s(mt(t))};return n?tt.jsx(de,{value:e,onChange:r,onPressEnter:()=>i(!1),onBlur:()=>i(!1)}):tt.jsxs(ne,{children:[tt.jsx("div",{children:e}),tt.jsx(re,{icon:tt.jsx(c,{}),type:"text",onClick:()=>i(!0)})]})},ys=()=>{const{id:e}=Y(),{componentList:t=[]}=At(),s=Ot(),{loading:n,run:i}=Ee((async()=>{e&&await Ut(e,{...s,componentList:t})}),{manual:!0});return Fe(["ctrl.s","meta.s"],(e=>{e.preventDefault(),n||i()})),qe((()=>{i()}),[t,s],{wait:1e3}),tt.jsx(re,{onClick:i,disabled:n,icon:n?tt.jsx(y,{}):null,children:"保存"})},Cs=()=>{const e=Z(),{id:t}=Y(),{componentList:s=[]}=At(),n=Ot(),{loading:i,run:r}=Ee((async()=>{t&&await Ut(t,{...n,componentList:s,isPublished:!0})}),{manual:!0,onSuccess(){ie.success("发布成功"),e("/question/stat/"+t)}});return tt.jsx(re,{type:"primary",onClick:r,disabled:i,icon:i?tt.jsx(y,{}):null,children:"发布"})},bs=()=>tt.jsxs(ne,{children:[tt.jsx(ys,{}),tt.jsx(Cs,{})]}),ws=()=>{const e=Z();return tt.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[tt.jsx("div",{className:"flex-1",children:tt.jsxs(ne,{children:[tt.jsx(re,{type:"link",icon:tt.jsx(C,{}),onClick:()=>e(-1),children:"返回"}),tt.jsx("div",{className:"mb-0 text-[18px] leading-none",children:tt.jsx(vs,{})})]})}),tt.jsx("div",{className:"flex-1 text-center leading-[2]",children:tt.jsx(gs,{})}),tt.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:tt.jsx(bs,{})})]})},Is={title:"多选标题",isVertical:!1,list:[{value:"item1",text:"选项1",checked:!1},{value:"item2",text:"选项2",checked:!1},{value:"item3",text:"选项3",checked:!1}]},{Paragraph:ks}=xe,Ns={title:"多选",type:"questionCheckbox",Component:e=>{const{title:t,isVertical:s,list:n=[]}={...Is,...e};return tt.jsxs("div",{children:[tt.jsx(ks,{strong:!0,children:t}),tt.jsx(ne,{direction:s?"vertical":"horizontal",children:n.map((e=>{const{value:t,text:s,checked:n}=e;return tt.jsx(ye,{value:t,checked:n,children:s},t)}))})]})},PropComponent:e=>{const{title:t,isVertical:s,list:n=[],onChange:r,disabled:l}=e,[a]=ce.useForm();return tt.jsxs(ce,{layout:"vertical",form:a,initialValues:{title:t,isVertical:s,list:n},disabled:l,onValuesChange:()=>{if(null==r)return;const e=a.getFieldsValue();e.list&&(e.list=e.list.filter((e=>!(null==e.text))));const{list:t=[]}=e;t.forEach((e=>{e.value||(e.value=ut(5))})),r(e)},children:[tt.jsx(ce.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:tt.jsx(de,{})}),tt.jsx(ce.Item,{label:"选项",children:tt.jsx(ce.List,{name:"list",children:(e,{add:t,remove:s})=>tt.jsxs(tt.Fragment,{children:[e.map((({key:e,name:t},n)=>tt.jsxs(ne,{align:"baseline",children:[tt.jsx(ce.Item,{name:[t,"checked"],valuePropName:"checked",children:tt.jsx(ye,{})}),tt.jsx(ce.Item,{name:[t,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,t)=>{const{list:s=[]}=a.getFieldsValue();let n=0;return s.forEach((e=>{e.text===t&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:tt.jsx(de,{placeholder:"输入选项文字..."})}),n>0&&tt.jsx(b,{onClick:()=>s(t)})]},e))),tt.jsx(ce.Item,{children:tt.jsx(re,{type:"link",onClick:()=>t({text:"",value:"",checked:!1}),icon:tt.jsx(i,{}),block:!0,children:"添加选项"})})]})})}),tt.jsx(ce.Item,{name:"isVertical",valuePropName:"checked",children:tt.jsx(ye,{children:"竖向排列"})})]})},StatComponent:({stat:e})=>tt.jsx("div",{style:{width:"300px",height:"300px"},children:tt.jsx(Te,{width:"100%",height:"100%",children:tt.jsxs(ze,{width:400,height:300,data:e,margin:{top:5,right:30,left:0,bottom:5},children:[tt.jsx(Re,{strokeDasharray:"3 3"}),tt.jsx(De,{dataKey:"name"}),tt.jsx(Ae,{}),tt.jsx(Oe,{}),tt.jsx(He,{dataKey:"count",fill:"#8884d8"})]})})}),defaultProps:Is},Ss={title:"问卷标题",desc:"问卷描述"},{Title:Ps,Paragraph:_s}=xe,{TextArea:Fs}=de,Es={title:"问卷信息",type:"questionInfo",Component:e=>{const{title:t,desc:s=""}={...Ss,...e},n=s.split("\n");return tt.jsxs("div",{style:{textAlign:"center"},children:[tt.jsx(Ps,{style:{fontSize:"24px"},children:t}),tt.jsx(_s,{children:n.map(((e,t)=>tt.jsxs("span",{children:[t>0&&tt.jsx("br",{}),e]},t)))})]})},PropComponent:e=>{const{title:s,desc:n,onChange:i,disabled:r}=e,[l]=ce.useForm();return t.useEffect((()=>{l.setFieldsValue({title:s,desc:n})}),[s,n]),tt.jsxs(ce,{layout:"vertical",initialValues:{title:s,desc:n},onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,form:l,children:[tt.jsx(ce.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入问卷标题"}],children:tt.jsx(de,{})}),tt.jsx(ce.Item,{label:"描述",name:"desc",children:tt.jsx(Fs,{})})]})},defaultProps:Ss},Ls={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Vs}=xe,qs={title:"输入框",type:"questionInput",Component:e=>{const{title:t,placeholder:s}={...Ls,...e};return tt.jsxs("div",{children:[tt.jsx(Vs,{strong:!0,children:t}),tt.jsx("div",{children:tt.jsx(de,{placeholder:s})})]})},PropComponent:e=>{const{title:s,placeholder:n,onChange:i,disabled:r}=e,[l]=ce.useForm();return t.useEffect((()=>{l.setFieldsValue({title:s,placeholder:n})}),[s,n]),tt.jsxs(ce,{layout:"vertical",initialValues:{title:s,placeholder:n},form:l,onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,children:[tt.jsx(ce.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:tt.jsx(de,{})}),tt.jsx(ce.Item,{label:"Placeholder",name:"placeholder",children:tt.jsx(de,{})})]})},defaultProps:Ls},Ts={text:"一行段落",isCenter:!1},{Paragraph:zs}=xe,{TextArea:Rs}=de,Ds={title:"段落",type:"questionParagraph",Component:e=>{const{text:t="",isCenter:s=!1}={...Ts,...e},n=t.split("\n");return tt.jsx(zs,{style:{textAlign:s?"center":"start",marginBottom:"0"},children:n.map(((e,t)=>tt.jsxs("span",{children:[t>0&&tt.jsx("br",{}),e]},t)))})},PropComponent:e=>{const{text:s,isCenter:n,onChange:i,disabled:r}=e,[l]=ce.useForm();return t.useEffect((()=>{l.setFieldsValue({text:s,isCenter:n})}),[s,n]),tt.jsxs(ce,{layout:"vertical",initialValues:{text:s,isCenter:n},onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,form:l,children:[tt.jsx(ce.Item,{label:"段落内容",name:"text",rules:[{required:!0,message:"请输入段落内容"}],children:tt.jsx(Rs,{})}),tt.jsx(ce.Item,{name:"isCenter",valuePropName:"checked",children:tt.jsx(ye,{children:"居中显示"})})]})},defaultProps:Ts},As={title:"单选标题",isVertical:!1,options:[{value:"item1",text:"选项1"},{value:"item2",text:"选项2"},{value:"item3",text:"选项3"}],value:""},{Paragraph:Os}=xe;const Hs={title:"单选",type:"questionRadio",Component:e=>{const{title:t,options:s=[],value:n,isVertical:i}={...As,...e};return tt.jsxs("div",{children:[tt.jsx(Os,{strong:!0,children:t}),tt.jsx(Ce.Group,{value:n,children:tt.jsx(ne,{direction:i?"vertical":"horizontal",children:s.map((e=>{const{value:t,text:s}=e;return tt.jsx(Ce,{value:t,children:s},t)}))})})]})},PropComponent:e=>{const{title:s,isVertical:n,value:r,options:l=[],onChange:a,disabled:o}=e,[c]=ce.useForm();return t.useEffect((()=>{c.setFieldsValue({title:s,isVertical:n,value:r,options:l})}),[s,n,r,l]),tt.jsxs(ce,{layout:"vertical",initialValues:{title:s,isVertical:n,value:r,options:l},onValuesChange:function(){if(null==a)return;const e=c.getFieldsValue();e.options&&(e.options=e.options.filter((e=>!(null==e.text))));const{options:t=[]}=e;t.forEach((e=>{e.value||(e.value=ut(5))})),a(e)},disabled:o,form:c,children:[tt.jsx(ce.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:tt.jsx(de,{})}),tt.jsx(ce.Item,{label:"选项",children:tt.jsx(ce.List,{name:"options",children:(e,{add:t,remove:s})=>tt.jsxs(tt.Fragment,{children:[e.map((({key:e,name:t},n)=>tt.jsxs(ne,{align:"baseline",children:[tt.jsx(ce.Item,{name:[t,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,t)=>{const{options:s=[]}=c.getFieldsValue();let n=0;return s.forEach((e=>{e.text===t&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:tt.jsx(de,{placeholder:"输入选项文字..."})}),n>1&&tt.jsx(b,{onClick:()=>s(t)})]},e))),tt.jsx(ce.Item,{children:tt.jsx(re,{type:"link",onClick:()=>t({text:"",value:""}),icon:tt.jsx(i,{}),block:!0,children:"添加选项"})})]})})}),tt.jsx(ce.Item,{label:"默认选中",name:"value",children:tt.jsx(be,{value:r,options:l.map((({text:e,value:t})=>({value:t,label:e||""})))})}),tt.jsx(ce.Item,{name:"isVertical",valuePropName:"checked",children:tt.jsx(ye,{children:"竖向排列"})})]})},defaultProps:As,StatComponent:({stat:e=[]})=>{const s=t.useMemo((()=>{let t=0;return e.forEach((e=>t+=e.count)),t}),[e]);return tt.jsx("div",{style:{width:"300px",height:"400px"},children:tt.jsx(Te,{width:"100%",height:"100%",children:tt.jsxs(Be,{children:[tt.jsx(Me,{dataKey:"count",data:e,cx:"40%",cy:"40%",outerRadius:50,fill:"#8884d8",label:e=>"".concat(e.name,": ").concat((100*(e.count/s)).toFixed(2),"%"),children:e.map(((e,t)=>tt.jsx(Ue,{fill:Tt[t]},t)))}),tt.jsx(Oe,{})]})})})}},Bs={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Ms}=xe,{TextArea:Us}=de,Ks={title:"多行输入",type:"questionTextarea",Component:e=>{const{title:t,placeholder:s}={...Bs,...e};return tt.jsxs("div",{children:[tt.jsx(Ms,{strong:!0,children:t}),tt.jsx("div",{children:tt.jsx(Us,{placeholder:s})})]})},PropComponent:e=>{const{title:s,placeholder:n,onChange:i,disabled:r}=e,[l]=ce.useForm();return t.useEffect((()=>{l.setFieldsValue({title:s,placeholder:n})}),[s,n]),tt.jsxs(ce,{layout:"vertical",initialValues:{title:s,placeholder:n},form:l,onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,children:[tt.jsx(ce.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:tt.jsx(de,{})}),tt.jsx(ce.Item,{label:"Placeholder",name:"placeholder",children:tt.jsx(de,{})})]})},defaultProps:Bs},Gs={text:"一级标题",level:1,isCenter:!1},{Title:Ws}=xe,$s={title:"标题",type:"questionTitle",Component:e=>{const{text:t="",level:s=1,isCenter:n=!1}={...Gs,...e};return tt.jsx(Ws,{level:s,style:{textAlign:n?"center":"start",marginBottom:"0",fontSize:(i=s,1===i?"24px":2===i?"20px":"16px")},children:t});var i},PropComponent:e=>{const{text:s,level:n,isCenter:i,onChange:r,disabled:l}=e,[a]=ce.useForm();return t.useEffect((()=>{a.setFieldsValue({text:s,level:n,isCenter:i})}),[s,n,i]),tt.jsxs(ce,{form:a,layout:"vertical",onValuesChange:function(){r&&r(a.getFieldsValue())},initialValues:{text:s,level:n,isCenter:i},disabled:l,children:[tt.jsx(ce.Item,{label:"标题内容",name:"text",rules:[{required:!0,message:"请输入标题内容"}],children:tt.jsx(de,{})}),tt.jsx(ce.Item,{label:"层级",name:"level",children:tt.jsx(be,{options:[{value:1,text:1},{value:2,text:2},{value:3,text:3}]})}),tt.jsx(ce.Item,{name:"isCenter",valuePropName:"checked",children:tt.jsx(ye,{children:"居中显示"})})]})},defaultProps:Gs},Js=[{groupId:"textGroup",groupName:"文本显示",components:[Es,Ds,$s]},{groupId:"inputGroup",groupName:"用户输入",components:[qs,Ks]},{groupId:"chooseGroup",groupName:"用户选择",components:[Ns,Hs]}],Ys=[Ns,Es,qs,Ds,Hs,Ks,$s];function Qs(e){return Ys.find((t=>t.type===e))}const{Title:Xs}=xe,Zs=()=>tt.jsx(tt.Fragment,{children:Js.map(((e,s)=>{const{groupId:n,groupName:i,components:r}=e;return tt.jsxs("div",{children:[tt.jsx(Xs,{level:3,style:{fontSize:"16px",marginTop:s>0?"20px":"0"},children:i}),tt.jsx("div",{children:r.map((e=>(e=>{const{title:s,type:n,Component:i,defaultProps:r}=e,l=T(),a=t.useCallback((()=>{l(vt({fe_id:ut(),title:s,type:n,props:r}))}),[]);return tt.jsx("div",{onClick:a,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:tt.jsx("div",{className:"pointer-events-none",children:tt.jsx(i,{})})},n)})(e)))})]},n)}))}),en=e=>{const{children:t,items:s,onDragEnd:n}=e,i=F(E(q,{activationConstraint:{distance:8}}));return tt.jsx(L,{sensors:i,collisionDetection:V,onDragEnd:e=>{const{active:t,over:i}=e;if(null!=i&&t.id!==i.id){const e=s.findIndex((e=>e.fe_id===t.id)),r=s.findIndex((e=>e.fe_id===i.id));n(e,r)}},children:tt.jsx(B,{items:s,strategy:M,children:t})})},tn=({id:e,children:t})=>{const{attributes:s,listeners:n,setNodeRef:i,transform:r,transition:l}=U({id:e}),a={transform:Ke.Transform.toString(r),transition:l};return tt.jsx("div",{ref:i,style:a,...s,...n,children:t})},sn=()=>{const{componentList:e,selectedId:s}=At(),n=T(),[i,r]=t.useState(""),l=e=>{const t=e.target.value.trim();t&&s&&n(Pt({fe_id:s,title:t}))},a=e.map((e=>({...e,id:e.fe_id})));return tt.jsx(en,{items:a,onDragEnd:(e,t)=>{n(_t({oldIndex:e,newIndex:t}))},children:e.map((t=>{const{fe_id:a,title:o,isHidden:c,isLocked:d}=t,x=w({"flex-auto line-height-loose":!0,"color-blue":a===s}),m="opacity-20",p=w({[m]:c}),j=w({[m]:c});return tt.jsx(tn,{id:a,children:tt.jsxs("div",{className:"flex border-b border-b-green-200 border-b-solid py-2",children:[tt.jsxs("div",{className:x,onClick:()=>(t=>{const i=e.find((e=>e.fe_id===t));return i&&i.isHidden?ie.info("不能选中隐藏的组件!"):t!==s?(n(gt(t)),void r("")):void r(t)})(a),children:[a===i&&tt.jsx(de,{value:o,onChange:l,onPressEnter:()=>r(""),onBlur:()=>r("")}),a!==i&&o]}),tt.jsx("div",{className:"w-12 text-end",children:tt.jsxs(ne,{children:[tt.jsx(re,{size:"small",shape:"circle",className:p,icon:tt.jsx(u,{}),type:c?"primary":"text",onClick:()=>((e,t)=>{n(bt({fe_id:e,isHidden:t}))})(a,!c)}),tt.jsx(re,{size:"small",shape:"circle",className:j,icon:tt.jsx(h,{}),type:d?"primary":"text",onClick:()=>(e=>{n(wt({fe_id:e}))})(a)})]})})]})},a)}))})},nn=()=>{const e=[{key:"componentLib",label:tt.jsxs("span",{children:[tt.jsx(I,{}),"组件库"]}),children:tt.jsx(Zs,{})},{key:"layers",label:tt.jsxs("span",{children:[tt.jsx(r,{}),"图层"]}),children:tt.jsx(sn,{})}];return tt.jsx(tt.Fragment,{children:tt.jsx(we,{items:e,defaultActiveKey:"componentLib"})})},rn=({loading:e})=>{const{componentList:t,selectedIs:s}=At(),n=T();if(function(){const e=T();Fe(["backspace","delete"],(()=>{Dt()&&e(Ct())})),Fe(["ctrl.c","meta.c"],(()=>{Dt()&&e(It())})),Fe(["ctrl.v","meta.v"],(()=>{Dt()&&e(kt())})),Fe("uparrow",(()=>{Dt()&&e(Nt())})),Fe("downarrow",(()=>{Dt()&&e(St())})),Fe(["ctrl.z","meta.z"],(()=>{Dt()&&e($.undo())}),{exactMatch:!0}),Fe(["ctrl.shift.z","meta.shift.z"],(()=>{Dt()&&e($.redo())}))}(),e)return tt.jsx("div",{className:"mt-6 text-center",children:tt.jsx(ae,{})});const i=e=>{const{type:t,props:s}=e,n=Qs(t);if(null==n)return null;const{Component:i}=n;return tt.jsx(i,{...s})},r=t.map((e=>({...e,id:e.fe_id})));return tt.jsx(en,{items:r,onDragEnd:(e,t)=>{n(_t({oldIndex:e,newIndex:t}))},children:tt.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:t.map((e=>{const{fe_id:t}=e,s=w({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return tt.jsx(tn,{id:t,children:tt.jsx("div",{className:s,onClick:e=>{return s=t,e.stopPropagation(),void n(gt(s));var s},children:tt.jsx("div",{className:"pointer-events-none",children:i(e)})})},t)}))})})},ln=()=>tt.jsx("div",{className:"text-center",children:"未选中组件"}),an=()=>{const e=T(),{selectedComponent:t}=At();if(null==t)return tt.jsx(ln,{});const{type:s,props:n}=t,i=Qs(s);if(null==i)return tt.jsx(ln,{});const{PropComponent:r}=i;return tt.jsx(r,{...n,onChange:s=>{const{fe_id:n}=t;e(yt({fe_id:n,newProps:s}))}})},on=()=>{const e=Ot(),[t]=ce.useForm(),s=T();return tt.jsxs(ce,{layout:"vertical",initialValues:e,onValuesChange:()=>{s(xt(t.getFieldsValue()))},form:t,children:[tt.jsx(ce.Item,{name:"title",label:"问卷标题",rules:[{required:!0,message:"请输入标题"}],children:tt.jsx(de,{placeholder:"请输入标题"})}),tt.jsx(ce.Item,{name:"desc",label:"问卷描述",children:tt.jsx(Ie,{placeholder:"问卷描述信息"})}),tt.jsx(ce.Item,{name:"css",label:"样式代码",children:tt.jsx(Ie,{placeholder:"请输入 CSS 样式代码"})}),tt.jsx(ce.Item,{name:"js",label:"脚本代码",children:tt.jsx(Ie,{placeholder:"请输入 JS 脚本代码"})})]})},cn=()=>{const[e,s]=t.useState("prop"),{selectedId:n}=At();t.useEffect((()=>{s(n?"prop":"setting")}),[n]);const i=[{key:"prop",label:tt.jsxs("span",{children:[tt.jsx(k,{}),"属性"]}),children:tt.jsx(an,{})},{key:"setting",label:tt.jsxs("span",{children:[tt.jsx(N,{}),"页面设置"]}),children:tt.jsx(on,{})}];return tt.jsx(we,{activeKey:e,items:i})},dn=()=>{const e=T(),{loading:t}=Gt(),{title:s}=Ot(),n=s?"问卷编辑 - ".concat(s):"问卷调查";Ve(n);return tt.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[tt.jsx(ws,{}),tt.jsx("div",{className:"flex-1 py-3",children:tt.jsxs("div",{className:"mx-6 h-100% flex",children:[tt.jsx("div",{className:"w-75 bg-white px-3",children:tt.jsx(nn,{})}),tt.jsx("div",{className:"relative flex-1 overflow-hidden",onClick:()=>{e(gt(""))},children:tt.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:tt.jsx(rn,{loading:t})})}),tt.jsx("div",{className:"w-75 bg-white px-3",children:tt.jsx(cn,{})})]})})]})},xn=()=>tt.jsx("div",{className:"mt-15 text-center",children:tt.jsx(ae,{})}),mn=()=>{const e=Z();return tt.jsx("div",{className:"flex-1",children:tt.jsx(me,{status:"warning",title:"该页面尚未发布",extra:tt.jsx(re,{type:"primary",onClick:()=>e(-1),children:"返回"})})})},un=()=>{const e=Z(),{title:s}=Ot(),{id:n}=Y(),i=t.useRef(null),r=t.useMemo((()=>{const e="http://localhost:5173/survey-sage/question/".concat(n),t=tt.jsx("div",{className:"text-center",children:tt.jsx(Ne,{value:e||"-"})});return tt.jsxs(ne,{children:[tt.jsx(de,{value:e,style:{width:"300px"},ref:i}),tt.jsx(ve,{title:"拷贝链接",children:tt.jsx(re,{icon:tt.jsx(x,{}),onClick:()=>{const t=i.current;if(null!=t){t.select();try{navigator.clipboard.writeText(e)}catch(s){}}}})}),tt.jsx(ke,{content:t,children:tt.jsx(re,{icon:tt.jsx(S,{})})})]})}),[n]);return tt.jsx("div",{className:"border-coolGray border-b-solid bg-white py-3",children:tt.jsxs("div",{className:"mx-6 flex",children:[tt.jsx("div",{className:"flex-1",children:tt.jsxs(ne,{children:[tt.jsx(re,{type:"link",icon:tt.jsx(C,{}),onClick:()=>{e(-1)},children:"返回"}),tt.jsx("span",{className:"text-5 line-height-none",children:s})]})}),tt.jsx("div",{className:"flex-1 text-center",children:r}),tt.jsx("div",{className:"flex-1 text-right",children:tt.jsx(re,{type:"primary",onClick:()=>{e("/question/edit/".concat(n))},children:"编辑问卷"})})]})})},hn=e=>{const{selectedComponentId:t,setSelectedComponentId:s,setSelectedComponentType:n}=e,{componentList:i}=At();return tt.jsx("div",{className:"min-h-full overflow-y-auto bg-white",children:i.filter((e=>!e.isHidden)).map((e=>{const{fe_id:i,props:r,type:l}=e,a=Qs(l);if(null==a)return null;const{Component:o}=a,c=w({"m-3 border-solid border-white px-2 py-3 b-rounded hover:border-blueGray":!0,"border-gray":i===t});return tt.jsx("div",{className:c,onClick:()=>{s(i),n(l)},children:tt.jsx("div",{className:"pointer-events-none opacity-[0.8]",children:tt.jsx(o,{...r})})},i)}))})},{Title:pn}=xe,jn=e=>{const{selectedComponentId:s,setSelectedComponentId:n,setSelectedComponentType:i}=e,{id:r=""}=Y(),[l,a]=t.useState(1),[o,c]=t.useState(10),[d,x]=t.useState(0),[m,u]=t.useState([]),{loading:h}=Ee((async()=>await async function(e,t){const s="/api/stat/".concat(e);return await zt.get(s,{params:t})}(r,{page:l,pageSize:o})),{refreshDeps:[r,l,o],onSuccess(e){const{total:t,list:s=[]}=e;x(t),u(s)}}),{componentList:p}=At(),j=p.map((e=>{const{fe_id:t,title:r,props:l={},type:a}=e,o=l.title||r;return{title:tt.jsx("div",{style:{cursor:"pointer"},onClick:()=>{n(t),i(a)},children:tt.jsx("span",{style:{color:t===s?"#1890ff":"inherit"},children:o})}),dataIndex:t}})),f=m.map((e=>({...e,key:e._id}))),g=tt.jsxs(tt.Fragment,{children:[tt.jsx(ge,{columns:j,dataSource:f,pagination:!1}),tt.jsx("div",{style:{textAlign:"center",marginTop:"18px"},children:tt.jsx(fe,{total:d,pageSize:o,current:l,onChange:e=>a(e),onShowSizeChange:(e,t)=>{a(e),c(t)}})})]});return tt.jsxs("div",{children:[tt.jsxs(pn,{level:3,children:["答卷数量: ",!h&&d]}),h&&tt.jsx("div",{style:{textAlign:"center"},children:tt.jsx(ae,{})}),!h&&g]})},{Title:fn}=xe,gn=e=>{const{selectedComponentId:s,selectedComponentType:n}=e,{id:i=""}=Y(),[r,l]=t.useState([]),{run:a}=Ee((async(e,t)=>await async function(e,t){const s="/api/stat/".concat(e,"/").concat(t);return await zt.get(s)}(e,t)),{manual:!0,onSuccess(e){l(e.stat)}});t.useEffect((()=>{s&&a(i,s)}),[i,s]);return tt.jsxs(tt.Fragment,{children:[tt.jsx(fn,{level:3,children:"图表统计"}),tt.jsx("div",{children:(()=>{if(!s)return tt.jsx("div",{children:"暂未选中组件"});const{StatComponent:e}=Qs(n)||{};return null==e?tt.jsx("div",{children:"该组件暂无统计图表"}):tt.jsx(e,{stat:r})})()})]})},vn=()=>{const[e,s]=t.useState(""),[n,i]=t.useState("");return tt.jsxs("div",{className:"mx-6 h-full flex",children:[tt.jsx("div",{className:"w-73 bg-white px-3",children:tt.jsx(hn,{selectedComponentId:e,setSelectedComponentId:s,setSelectedComponentType:i})}),tt.jsx("div",{className:"relative mx-3 flex-1 overflow-hidden",children:tt.jsx(jn,{selectedComponentId:e,setSelectedComponentId:s,setSelectedComponentType:i})}),tt.jsx("div",{className:"w-75 bg-white px-3",children:tt.jsx(gn,{selectedComponentId:e,selectedComponentType:n})})]})},yn=()=>{const{loading:e,questionData:t}=Gt(),{title:s,isPubulished:n}=Ot();return Ve("问卷调查 - ".concat(s)),n?tt.jsx(mn,{}):tt.jsxs("div",{className:"min-h-screen flex flex-col bg-cyan",children:[tt.jsx(un,{}),tt.jsxs("div",{className:"flex-1 py-3",children:[e&&tt.jsx(xn,{}),!e&&tt.jsx(vn,{})]})]})},{Title:Cn,Paragraph:bn}=xe,wn=()=>{const e=Z();return tt.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:tt.jsxs("div",{className:"text-center",children:[tt.jsx(Cn,{children:"问卷调查 | 在线投票"}),tt.jsx(bn,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),tt.jsx("div",{className:"h-15 font-24",children:tt.jsx(re,{className:"b-rounded-4",type:"primary",onClick:()=>e(Ln),children:"开始使用"})})]})})},{Title:In}=xe,kn="USERNAME",Nn="PASSWORD";const Sn=()=>{const e=Z(),s=T(),[n]=ce.useForm();t.useEffect((()=>{const{username:e,password:t}={username:localStorage.getItem(kn),password:localStorage.getItem(Nn)};n.setFieldsValue({username:e,password:t})}),[]);const{run:i}=Ee((async(e,t)=>{const n=await async function(e,t){const s={username:e,password:t};return await zt.post("/api/user/login",s)}(e,t);return n.token&&s(at({username:e,nickname:e})),n}),{manual:!0,onSuccess(t){const{token:s=""}=t;!function(e){localStorage.setItem(Rt,e)}(s),ie.success("登录成功"),e(Ln)}});return tt.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[tt.jsx("div",{children:tt.jsxs(ne,{children:[tt.jsx(In,{level:2,children:tt.jsx(o,{})}),tt.jsx(In,{level:2,children:"登录"})]})}),tt.jsx("div",{children:tt.jsxs(ce,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{const{username:t,password:s,remember:n}=e||{};i(t,s),n?function(e,t){localStorage.setItem(kn,e),localStorage.setItem(Nn,t)}(t,s):(localStorage.removeItem(kn),localStorage.removeItem(Nn))},children:[tt.jsx(ce.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:tt.jsx(de,{})}),tt.jsx(ce.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:tt.jsx(de.Password,{})}),tt.jsx(ce.Item,{name:"remember",valuePropName:"checked",wrapperCol:{offset:0,span:10},children:tt.jsx(ye,{children:"记住我"})}),tt.jsx(ce.Item,{wrapperCol:{offset:4,span:18},children:tt.jsxs(ne,{children:[tt.jsx(re,{type:"primary",htmlType:"submit",children:"登录"}),tt.jsx(J,{to:En,children:"注册新用户"})]})})]})})]})},Pn=te([{path:"/",element:tt.jsx(es,{}),children:[{path:"/",element:tt.jsx(wn,{})},{path:"login",element:tt.jsx(Sn,{})},{path:"register",element:tt.jsx(is,{})},{path:"manage",element:tt.jsx(ts,{}),children:[{path:"list",element:tt.jsx(xs,{})},{path:"star",element:tt.jsx(fs,{})},{path:"trash",element:tt.jsx(ps,{})}]},{path:"*",element:tt.jsx(rs,{})}]},{path:"question",element:tt.jsx(ss,{}),children:[{path:"edit/:id",element:tt.jsx(dn,{})},{path:"stat/:id",element:tt.jsx(yn,{})}]}],{basename:"/survey-sage"}),_n="/",Fn="/login",En="/register",Ln="/manage/list";const Vn=()=>tt.jsx(Se,{theme:{algorithm:Pe.defaultAlgorithm},children:tt.jsx(se,{router:Pn})});st.createRoot(document.getElementById("root")).render(tt.jsx(P.StrictMode,{children:tt.jsx(R,{store:Ft,children:tt.jsx(Vn,{})})}));export{e as __vite_legacy_guard};
