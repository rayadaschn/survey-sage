function e(){import.meta.url,import("_").catch((()=>1))}import{r as s,ae as t,af as n,U as r,M as a,ag as i,ah as l,ai as c,ac as o,aj as d,ad as m,ak as x,W as u,al as h,am as p,an as j,K as f,ao as g,ap as v,O as y,aq as C,ar as b,z as w,as as k,at as I,R as N}from"./@ant-design/icons-a547670a.js";import{r as S,S as _,T as P,m as L,B as E,L as F,a as q,D as R,F as T,I as z,R as V,b as O,P as D,M as A,E as U,c as H,d as K,e as M,f as B,C as W,g as G,h as $,t as Y}from"./antd-db66d6cb.js";import{u as J,a as X,P as Q}from"./react-redux-16ca8fe2.js";import{c as Z,p as ee,a as se}from"./@reduxjs/toolkit-4ce24ac1.js";import{c as te}from"./lodash-es-34fbd7b9.js";import{L as ne,u as re,a as ae,b as ie,c as le,O as ce,d as oe,R as de}from"./react-router-dom-f691f64c.js";import{a as me}from"./axios-83bdef92.js";import{F as xe,G as ue,H as he,I as pe}from"./ahooks-166c01ca.js";import{M as je}from"./redux-undo-644c5718.js";import{R as fe,B as ge,C as ve,X as ye,Y as Ce,T as be,a as we}from"./recharts-96fa64ed.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var ke={exports:{}},Ie={},Ne=s,Se=Symbol.for("react.element"),_e=Symbol.for("react.fragment"),Pe=Object.prototype.hasOwnProperty,Le=Ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ee={key:!0,ref:!0,__self:!0,__source:!0};function Fe(e,s,t){var n,r={},a=null,i=null;for(n in void 0!==t&&(a=""+t),void 0!==s.key&&(a=""+s.key),void 0!==s.ref&&(i=s.ref),s)Pe.call(s,n)&&!Ee.hasOwnProperty(n)&&(r[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===r[n]&&(r[n]=s[n]);return{$$typeof:Se,type:e,key:a,ref:i,props:r,_owner:Le.current}}Ie.Fragment=_e,Ie.jsx=Fe,Ie.jsxs=Fe,ke.exports=Ie;var qe=ke.exports;var Re={},Te=S;Re.createRoot=Te.createRoot,Re.hydrateRoot=Te.hydrateRoot;const ze={username:"",nickname:""},Ve=Z({name:"user",initialState:ze,reducers:{loginReducer:(e,s)=>s.payload,logoutReducer:()=>ze}}),Oe=Ve.reducer,{loginReducer:De,logoutReducer:Ae}=Ve.actions,Ue=Z({name:"pageInfo",initialState:{title:"",desc:"",js:"",css:""},reducers:{resetPageInfo:(e,s)=>s.payload}}),He=Ue.reducer,{resetPageInfo:Ke}=Ue.actions;let Me=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,s)=>e+=(s&=63)<36?s.toString(36):s<62?(s-26).toString(36).toUpperCase():s>62?"-":"_"),"");function Be(e,s){const t=s.filter((e=>!e.isHidden)),n=t.findIndex((s=>s.fe_id===e));if(n<0)return"";let r="";const a=t.length;return r=a<=1?"":n+1===a?t[n-1].fe_id:t[n+1].fe_id,r}function We(e,s){const{selectedId:t,componentList:n}=e,r=n.findIndex((e=>e.fe_id===t));r<0?e.componentList.push(s):e.componentList.splice(r+1,0,s),e.selectedId=s.fe_id}const Ge=Z({name:"components",initialState:{componentList:[],selectedId:"",copiedComponent:null},reducers:{resetComponents:(e,s)=>s.payload,changeSelectedId:ee(((e,s)=>{e.selectedId=s.payload})),addComponent:ee(((e,s)=>{We(e,s.payload)})),changeComponentProps:ee(((e,s)=>{const{fe_id:t,newProps:n}=s.payload,r=e.componentList.find((e=>e.fe_id===t));r&&(r.props={...r.props,...n})})),removeSelectedComponent:ee((e=>{const{componentList:s=[],selectedId:t}=e,n=Be(t,s);e.selectedId=n;const r=s.findIndex((e=>e.fe_id===t));s.splice(r,1)})),changeComponentHidden:ee(((e,s)=>{const{componentList:t=[]}=e,{fe_id:n,isHidden:r}=s.payload;let a="";a=r?Be(n,t):n,e.selectedId=a;const i=t.find((e=>e.fe_id===n));i&&(i.isHidden=r)})),toggleComponentLocked:ee(((e,s)=>{const{fe_id:t}=s.payload,n=e.componentList.find((e=>e.fe_id===t));n&&(n.isLocked=!n.isLocked)})),copySelectedComponent:ee((e=>{const{selectedId:s,componentList:t=[]}=e,n=t.find((e=>e.fe_id===s));null!=n&&(e.copiedComponent=te(n))})),pasteCopiedComponent:ee((e=>{const{copiedComponent:s}=e;null!=s&&(s.fe_id=Me(),We(e,s))})),selectPrevComponent:ee((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n<=0||(e.selectedId=t[n-1].fe_id)})),selectNextComponent:ee((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n+1!==t.length&&(e.selectedId=t[n+1].fe_id)})),changeComponentTitle:ee(((e,s)=>{const{title:t,fe_id:n}=s.payload,r=e.componentList.find((e=>e.fe_id===n));r&&(r.title=t)})),moveComponent:ee(((e,s)=>{s.payload}))}}),{resetComponents:$e,changeSelectedId:Ye,addComponent:Je,changeComponentProps:Xe,removeSelectedComponent:Qe,changeComponentHidden:Ze,toggleComponentLocked:es,copySelectedComponent:ss,pasteCopiedComponent:ts,selectPrevComponent:ns,selectNextComponent:rs,changeComponentTitle:as,moveComponent:is}=Ge.actions,ls=se({reducer:{user:Oe,pageInfo:He,components:Ge.reducer}}),cs="_container_1fxih_1",{Title:os}=P,ds=()=>qe.jsx("div",{children:qe.jsx(ne,{to:"/",children:qe.jsxs(_,{className:cs,children:[qe.jsx(os,{children:qe.jsx(t,{})}),qe.jsx(os,{children:"问卷调查"})]})})}),ms="USER_TOKEN";const xs=()=>document.activeElement===document.body;function us(){const e=X((e=>e.components)),{componentList:s=[],selectedId:t,copiedComponent:n}=e,r=s.find((e=>e.fe_id===t));return{componentList:s,selectedId:t,selectedComponent:r,copiedComponent:n}}function hs(){const{username:e,nickname:s}=X((e=>e.user));return{username:e,nickname:s}}const ps="keyword",js="page",fs="pageSize",gs=me.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});async function vs(){return await gs.post("/api/question/")}async function ys(e={}){return await gs.get("/api/question",{params:e})}async function Cs(e,s){const t="/api/question/".concat(e);return await gs.patch(t,s)}async function bs(){return await gs.get("/api/user/info")}function ws(){const{id:e=""}=re(),t=J(),{data:n,loading:r,error:a,run:i}=ue((async e=>{if(!e)throw new Error("缺少问卷 id");const s=await async function(e){const s="/api/question/".concat(e);return await gs.get(s)}(e);return s}),{manual:!0});return s.useEffect((()=>{if(!n)return;const{title:e="",desc:s="",js:r="",css:a="",componentList:i=[]}=n;let l="";i.length>0&&(l=i[0].fe_id),t($e({componentList:i,selectedId:l,copiedComponent:null})),t(Ke({title:e,desc:s,js:r,css:a}))}),[n]),s.useEffect((()=>{i(e)}),[e]),{loading:r,error:a}}function ks(e={}){const{isStar:s,isDeleted:t}=e,[n]=ae(),{data:r,loading:a,error:i,refresh:l}=ue((async()=>{const e=n.get(ps)||"",r=parseInt(n.get(js)||"")||1,a=parseInt(n.get(fs)||"")||10;return await ys({keyword:e,isStar:s,isDeleted:t,page:r,pageSize:a})}),{refreshDeps:[n]});return{data:r,loading:a,error:i,refresh:l}}function Is(){const e=J(),[t,n]=s.useState(!0),{run:r}=ue(bs,{manual:!0,onSuccess(s){const{username:t,nickname:n}=s;e(De({username:t,nickname:n}))},onFinally(){n(!1)}}),{username:a}=hs();return s.useEffect((()=>{a?n(!1):r()}),[t]),{waitingUserData:t}}function Ns(e){const{username:t}=hs(),{pathname:n}=ie(),r=le();s.useEffect((()=>{e||(t?function(e){return[_t,Pt].includes(e)}(n)&&r(Lt):function(e){return[St,_t,Pt].includes(e)}(n)||r(_t))}),[e,t,n])}gs.interceptors.request.use((e=>(e.headers.Authorization="Bearer ".concat(localStorage.getItem(ms)||""),e)),(e=>(L.error(e.message),Promise.reject(e)))),gs.interceptors.response.use((e=>{const s=e.data||{},{errno:t,data:n,msg:r}=s;return 203===t||0!==t&&200!==t?(L.error(r||"请求失败"),Promise.reject(n)):n}),(e=>{var s;let t="";switch(null==(s=e.response)?void 0:s.status){case 401:t="token 失效，请重新登录";break;case 403:t="拒绝访问";break;case 404:t="请求地址错误";break;case 500:t="服务器故障";break;default:t="网络连接故障"}return L.error(t),Promise.reject(e)}));const Ss=()=>{const e=le(),s=J(),{username:t,nickname:r}=hs();const a=qe.jsxs(qe.Fragment,{children:[qe.jsxs("span",{className:"color-light",children:[qe.jsx(n,{}),r]}),qe.jsx(E,{type:"link",onClick:function(){s(Ae()),localStorage.removeItem(ms),L.success("退出成功"),e(_t)},children:"退出"})]}),i=qe.jsx(ne,{to:_t,children:"登录"});return qe.jsx(qe.Fragment,{children:t?a:i})},{Header:_s,Content:Ps,Footer:Ls}=F,Es=()=>{const{waitingUserData:e}=Is();return Ns(e),qe.jsxs(F,{children:[qe.jsxs(_s,{className:"px-6",children:[qe.jsx("div",{className:"float-left",children:qe.jsx(ds,{})}),"MainLayout header",qe.jsx("div",{className:"float-right",children:qe.jsx(Ss,{})})]}),qe.jsx(Ps,{className:"min-h-[calc(100vh-140px)]",children:e?qe.jsx("div",{className:"mt-15 text-center",children:qe.jsx(q,{})}):qe.jsx(ce,{})}),qe.jsx(Ls,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"问卷调查@2023 Created by Huy"})]})},Fs=()=>{const e=le(),{pathname:s}=ie(),{loading:t,run:n}=ue(vs,{manual:!0,onSuccess(s){e("question/edit/".concat(s.id)),L.success("创建成功")}});return qe.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[qe.jsx("div",{className:"w-30",children:qe.jsxs(_,{direction:"vertical",children:[qe.jsx(E,{type:"primary",size:"large",icon:qe.jsx(r,{}),onClick:n,disabled:t,children:"新建问卷"}),qe.jsx(R,{}),qe.jsx(E,{type:s.startsWith("/manage/list")?"default":"text",size:"large",icon:qe.jsx(a,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),qe.jsx(E,{type:s.startsWith("/manage/star")?"default":"text",size:"large",icon:qe.jsx(i,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),qe.jsx(E,{type:s.startsWith("/manage/trash")?"default":"text",size:"large",icon:qe.jsx(l,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),qe.jsx("div",{className:"ml-15 flex-1",children:qe.jsx(ce,{})})]})},qs=()=>{const{waitingUserData:e}=Is();return Ns(e),qe.jsx("div",{className:"h-screen",children:e?qe.jsx("div",{className:"mt-15 text-center",children:qe.jsx(q,{})}):qe.jsx(ce,{})})},{Title:Rs}=P,Ts=()=>{const e=le(),{run:s}=ue((async e=>{const{username:s,password:t,nickname:n}=e;await async function(e,s,t){const n={username:e,password:s,nickname:t||e};return await gs.post("/api/user/register",n)}(s,t,n)}),{manual:!0,onSuccess(){L.success("注册成功"),e(_t)}});return qe.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[qe.jsx("div",{children:qe.jsxs(_,{children:[qe.jsx(Rs,{level:2,children:qe.jsx(c,{})}),qe.jsx(Rs,{level:2,children:"注册新用户"})]})}),qe.jsx("div",{children:qe.jsxs(T,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{s(e)},children:[qe.jsx(T.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:qe.jsx(z,{})}),qe.jsx(T.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:qe.jsx(z.Password,{})}),qe.jsx(T.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(s,t)=>t&&e("password")!==t?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:qe.jsx(z.Password,{})}),qe.jsx(T.Item,{label:"昵称",name:"nickname",children:qe.jsx(z,{})}),qe.jsx(T.Item,{wrapperCol:{offset:4,span:18},children:qe.jsxs(_,{children:[qe.jsx(E,{type:"primary",htmlType:"submit",children:"注册"}),qe.jsx(ne,{to:_t,children:"已有账户，请登录"})]})})]})})]})},zs=()=>{const e=le();return qe.jsx(qe.Fragment,{children:qe.jsx(V,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:qe.jsx(E,{type:"primary",onClick:()=>e(Lt),children:"返回首页"})})})},{confirm:Vs}=A,Os=e=>{const t=le(),{_id:n,title:r,isPublished:a,answerContent:c,currentAt:u,isStar:h}=e,[p,j]=s.useState(h),{loading:f,run:g}=ue((async()=>{await Cs(n,{isStar:!p})}),{manual:!0,onSuccess(){j(!p),L.success("已更新")}}),{loading:v,run:y}=ue((async()=>await async function(e){const s="/api/question/duplicate/".concat(e);return await gs.post(s)}(n)),{manual:!0,onSuccess(e){L.success("复制成功"),t("/question/edit/".concat(e.id))}}),[C,b]=s.useState(!1),{loading:w,run:k}=ue((async()=>await Cs(n,{isDeleted:!0})),{manual:!0,onSuccess(){L.success("删除成功"),b(!0)}});return C?null:qe.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[qe.jsxs("div",{className:"flex",children:[qe.jsx("div",{className:"flex-1",children:qe.jsx(ne,{to:a?"/question/stat/".concat(n):"/question/edit/".concat(n),children:qe.jsxs(_,{children:[h&&qe.jsx(i,{style:{color:"red"}}),r]})})}),qe.jsx("div",{className:"flex-1 text-center font-size-3",children:qe.jsxs(_,{children:[a?qe.jsx(O,{color:"processing",children:"已发布"}):qe.jsx(O,{children:"未发布"}),qe.jsxs("span",{children:["答卷: ",c]}),qe.jsx("span",{children:u})]})})]}),qe.jsx(R,{className:"m-3"}),qe.jsxs("div",{className:"flex",children:[qe.jsx("div",{className:"flex-1",children:qe.jsxs(_,{children:[qe.jsx(E,{icon:qe.jsx(o,{}),type:"text",size:"small",onClick:()=>{t("/question/edit/".concat(n))},children:"编辑问卷"}),qe.jsx(E,{icon:qe.jsx(d,{}),type:"text",size:"small",onClick:()=>{t("/question/stat/".concat(n))},children:"数据统计"})]})}),qe.jsx("div",{className:"flex-1 text-center",children:qe.jsxs(_,{children:[qe.jsx(E,{type:"text",icon:qe.jsx(i,{}),color:"#999",size:"small",onClick:g,disabled:f,children:p?"取消标星":"标星"}),qe.jsx(D,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:y,children:qe.jsx(E,{type:"text",icon:qe.jsx(m,{}),color:"#999",size:"small",disabled:v,children:"复制"})}),qe.jsx(E,{type:"text",icon:qe.jsx(l,{}),size:"small",color:"#999",onClick:()=>{Vs({title:"确定删除该问卷?",icon:qe.jsx(x,{}),onOk:k})},disabled:w,children:"删除"})]})})]})]})},{Search:Ds}=z,As=()=>{const e=le(),{pathname:t}=ie(),[n,r]=s.useState("");const[a]=ae();return s.useEffect((()=>{const e=a.get(ps)||"";r(e)}),[a]),qe.jsx(Ds,{placeholder:"请输入关键字",value:n,onChange:function(e){r(e.target.value)},onSearch:function(s){e({pathname:t,search:"".concat(ps,"=").concat(s)})},className:"w-50"})},{Title:Us}=P,Hs=()=>{const[e,t]=s.useState(!1),[n,r]=s.useState(1),[a,i]=s.useState([]),[l,c]=s.useState(0),o=l>a.length,[d]=ae(),m=d.get(ps)||"";s.useEffect((()=>{t(!1),r(1),i([]),c(0)}),[m]);const{run:x,loading:u}=ue((async()=>await ys({page:n,pageSize:10,keyword:m})),{manual:!0,onSuccess(e){const{list:s=[],total:t=0}=e;i(a.concat(s)),c(t),r(n+1)}}),h=s.useRef(null),{run:p}=he((()=>{const e=h.current;if(null==e)return;const s=e.getBoundingClientRect();if(null==s)return;const{bottom:n}=s;n<=document.body.clientHeight&&(x(),t(!0))}),{wait:1e3});s.useEffect((()=>{p()}),[d]),s.useEffect((()=>(o&&window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)})),[d,o]);const j=s.useMemo((()=>!e||u?qe.jsx(q,{}):0===l?qe.jsx(U,{description:"暂无数据"}):o?qe.jsx("span",{children:"开始加载下一页"}):qe.jsx("span",{children:"没有更多了..."})),[e,u,o]);return qe.jsxs(qe.Fragment,{children:[qe.jsxs("div",{className:"flex",children:[qe.jsx("div",{className:"flex-1",children:qe.jsx(Us,{level:3,children:"我的问卷"})}),qe.jsx("div",{className:"flex-1 text-center",children:qe.jsx(As,{})})]}),qe.jsx("div",{className:"mb-5",children:a.length>0&&a.map((e=>{const{_id:s}=e;return qe.jsx(Os,{...e},s)}))}),qe.jsx("div",{className:"text-center color-blue",children:qe.jsx("div",{ref:h,children:j})})]})},Ks=e=>{const{total:t}=e,[n,r]=s.useState(1),[a,i]=s.useState(10),[l]=ae();s.useEffect((()=>{const e=parseInt(l.get(js)||"")||1;r(e);const s=parseInt(l.get(fs)||"")||10;i(s)}),[l]);const c=le(),{pathname:o}=ie();return qe.jsx(H,{current:n,pageSize:a,total:t,onChange:(e,s)=>{l.set(js,e.toString()),l.set(fs,s.toString()),c({pathname:o,search:l.toString()})}})},{Title:Ms}=P,{confirm:Bs}=A,Ws=()=>{pe("问卷调查");const{data:e={},loading:t,refresh:n}=ks({isDeleted:!0}),{list:r=[],total:a=0}=e,[i,l]=s.useState([]),c=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?qe.jsx(O,{color:"processing",children:"已发布"}):qe.jsx(O,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:o}=ue((async()=>{for await(const e of i)await Cs(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){L.success("恢复成功"),n(),l([])}}),{run:d}=ue((async()=>await async function(e){return await gs.delete("/api/question",{data:{ids:e}})}(i)),{manual:!0,onSuccess(){L.success("删除成功"),n(),l([])}});return qe.jsxs(qe.Fragment,{children:[qe.jsxs("div",{className:"flex",children:[qe.jsx("div",{className:"flex-1",children:qe.jsx(Ms,{level:3,children:"回收站"})}),qe.jsx("div",{className:"flex-1 text-center",children:qe.jsx(As,{})})]}),qe.jsxs("div",{className:"mb-5",children:[t&&qe.jsx("div",{className:"text-center",children:qe.jsx(q,{})}),!t&&0===r.length&&qe.jsx(U,{description:"暂无数据"}),r.length>0&&qe.jsxs("div",{children:[qe.jsxs(_,{className:"mb",children:[qe.jsx(E,{type:"primary",disabled:0===i.length,onClick:o,children:"恢复"}),qe.jsx(E,{danger:!0,disabled:0===i.length,onClick:()=>{Bs({title:"确定彻底删除该问卷?",icon:qe.jsx(x,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),qe.jsx(K,{rowKey:e=>e._id,dataSource:r,columns:c,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{l(e)}}})]})]}),qe.jsx("div",{className:"text-center color-blue",children:r.length>0&&qe.jsx(Ks,{total:a})})]})},{Title:Gs}=P,$s=()=>{const{data:e={},loading:s}=ks({isStar:!0}),{list:t=[],total:n=0}=e;return qe.jsxs(qe.Fragment,{children:[qe.jsxs("div",{className:"flex",children:[qe.jsx("div",{className:"flex-1",children:qe.jsx(Gs,{level:3,children:"星标问卷"})}),qe.jsx("div",{className:"flex-1 text-center",children:qe.jsx(As,{})})]}),qe.jsxs("div",{className:"mb-5",children:[s&&qe.jsx("div",{className:"text-center",children:qe.jsx(q,{})}),!s&&0===t.length&&qe.jsx(U,{description:"暂无数据"}),t.length>0&&t.map((e=>{const{_id:s}=e;return qe.jsx(Os,{...e},s)}))]}),qe.jsx("div",{className:"text-center color-blue",children:t.length>0&&qe.jsx(Ks,{total:n})})]})},Ys=()=>{const e=J(),{selectedId:s,componentList:t,selectedComponent:n,copiedComponent:r}=us(),a=t.findIndex((e=>e.fe_id===s)),i=a<=0,c=a+1>=t.length,o=(null==n?void 0:n.isLocked)?"primary":"default",d=[{title:"删除",shape:"circle",icon:qe.jsx(l,{}),onClick:()=>{e(Qe())}},{title:"隐藏",shape:"circle",icon:qe.jsx(u,{}),onClick:()=>{e(Ze({fe_id:s,isHidden:!0}))}},{title:"锁定",type:o,shape:"circle",icon:qe.jsx(h,{}),onClick:()=>{e(es({fe_id:s}))}},{title:"复制",shape:"circle",icon:qe.jsx(m,{}),onClick:()=>{e(ss())}},{title:"粘贴",shape:"circle",icon:qe.jsx(p,{}),onClick:()=>{e(ts())},disabled:null==r},{title:"上移",shape:"circle",icon:qe.jsx(j,{}),onClick:()=>{i||e(is({oldIndex:a,newIndex:a-1}))},disabled:i},{title:"下移",shape:"circle",icon:qe.jsx(f,{}),onClick:()=>{c||e(is({oldIndex:a,newIndex:a+1}))},disabled:c},{title:"撤销",shape:"circle",icon:qe.jsx(g,{}),onClick:()=>{e(je.undo())}},{title:"重做",shape:"circle",icon:qe.jsx(v,{}),onClick:()=>{e(je.redo())}}];return qe.jsx(_,{children:d.map((e=>{const{title:s,type:t,shape:n,icon:r,onClick:a,disabled:i}=e;return qe.jsx(M,{title:s,children:qe.jsx(E,{type:t,shape:n,icon:r,onClick:a,disabled:i})},s)}))})},Js=()=>{const e=le();return qe.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[qe.jsx("div",{className:"flex-1",children:qe.jsxs(_,{children:[qe.jsx(E,{type:"link",icon:qe.jsx(y,{}),onClick:()=>e(-1),children:"返回"}),qe.jsx("div",{className:"mb-0 text-[18px] leading-none",children:"标题"})]})}),qe.jsx("div",{className:"flex-1 text-center leading-[2]",children:qe.jsx(Ys,{})}),qe.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:qe.jsxs(_,{children:[qe.jsx(E,{children:"保存"}),qe.jsx(E,{type:"primary",children:"发布"})]})})]})},Xs={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Qs}=P,Zs={title:"输入框",type:"questionInput",Component:e=>{const{title:s,placeholder:t}={...Xs,...e};return qe.jsxs("div",{children:[qe.jsx(Qs,{strong:!0,children:s}),qe.jsx("div",{children:qe.jsx(z,{placeholder:t})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:r,disabled:a}=e,[i]=T.useForm();return s.useEffect((()=>{i.setFieldsValue({title:t,placeholder:n})}),[t,n]),qe.jsxs(T,{layout:"vertical",initialValues:{title:t,placeholder:n},form:i,onValuesChange:function(){r&&r(i.getFieldsValue())},disabled:a,children:[qe.jsx(T.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:qe.jsx(z,{})}),qe.jsx(T.Item,{label:"Placeholder",name:"placeholder",children:qe.jsx(z,{})})]})},defaultProps:Xs},et={text:"一级标题",level:1,isCenter:!1},{Title:st}=P,tt={title:"标题",type:"questionTitle",Component:e=>{const{text:s="",level:t=1,isCenter:n=!1}={...et};return qe.jsx(st,{level:t,style:{textAlign:n?"center":"start",marginBottom:"0",fontSize:(r=t,1===r?"24px":2===r?"20px":"16px")},children:s});var r},PropComponent:e=>{const{text:t,level:n,isCenter:r,onChange:a,disabled:i}=e,[l]=T.useForm();return s.useEffect((()=>{l.setFieldsValue({text:t,level:n,isCenter:r})}),[t,n,r]),qe.jsxs(T,{form:l,layout:"vertical",onValuesChange:function(){a&&a(l.getFieldsValue())},initialValues:{text:t,level:n,isCenter:r},disabled:i,children:[qe.jsx(T.Item,{label:"标题内容",name:"text",rules:[{required:!0,message:"请输入标题内容"}],children:qe.jsx(z,{})}),qe.jsx(T.Item,{label:"层级",name:"level",children:qe.jsx(B,{options:[{value:1,text:1},{value:2,text:2},{value:3,text:3}]})}),qe.jsx(T.Item,{name:"isCenter",valuePropName:"checked",children:qe.jsx(W,{children:"居中显示"})})]})},defaultProps:et},nt={title:"多选标题",isVertical:!1,list:[{value:"item1",text:"选项1",checked:!1},{value:"item2",text:"选项2",checked:!1},{value:"item3",text:"选项3",checked:!1}]},{Paragraph:rt}=P,at={title:"多选",type:"questionCheckbox",Component:e=>{const{title:s,isVertical:t,list:n=[]}={...nt,...e};return qe.jsxs("div",{children:[qe.jsx(rt,{strong:!0,children:s}),qe.jsx(_,{children:n.map((e=>{const{value:s,text:t,checked:n}=e;return qe.jsx(W,{value:s,checked:n,children:t},s)}))})]})},PropComponent:e=>{const{title:s,isVertical:t,list:n=[],onChange:a,disabled:i}=e,[l]=T.useForm();return qe.jsxs(T,{layout:"vertical",form:l,initialValues:{title:s,isVertical:t,list:n},disabled:i,onValuesChange:()=>{if(null==a)return;const e=l.getFieldsValue();e.list&&(e.list=e.list.filter((e=>!(null==e.text))));const{list:s=[]}=e;s.forEach((e=>{e.value||(e.value=Me(5))})),a(e)},children:[qe.jsx(T.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:qe.jsx(z,{})}),qe.jsx(T.Item,{label:"选项",children:qe.jsx(T.List,{name:"list",children:(e,{add:s,remove:t})=>qe.jsxs(qe.Fragment,{children:[e.map((({key:e,name:s},n)=>qe.jsxs(_,{align:"baseline",children:[qe.jsx(T.Item,{name:[s,"checked"],valuePropName:"checked",children:qe.jsx(W,{})}),qe.jsx(T.Item,{name:[s,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,s)=>{const{list:t=[]}=l.getFieldsValue();let n=0;return t.forEach((e=>{e.text===s&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:qe.jsx(z,{placeholder:"输入选项文字..."})}),n>0&&qe.jsx(C,{onClick:()=>t(s)})]},e))),qe.jsx(T.Item,{children:qe.jsx(E,{type:"link",onClick:()=>s({text:"",value:"",checked:!1}),icon:qe.jsx(r,{}),block:!0,children:"添加选项"})})]})})}),qe.jsx(T.Item,{name:"isVertical",valuePropName:"checked",children:qe.jsx(W,{children:"竖向排列"})})]})},StatComponent:({stat:e})=>qe.jsx("div",{style:{width:"400px",height:"300px"},children:qe.jsx(fe,{width:"100%",height:"100%",children:qe.jsxs(ge,{width:400,height:300,data:e,margin:{top:5,right:30,left:0,bottom:5},children:[qe.jsx(ve,{strokeDasharray:"3 3"}),qe.jsx(ye,{dataKey:"name"}),qe.jsx(Ce,{}),qe.jsx(be,{}),qe.jsx(we,{dataKey:"count",fill:"#8884d8"})]})})}),defaultProps:nt},it=[Zs,tt,at],lt=[{groupId:"textGroup",groupName:"文本显示",components:[tt]},{groupId:"inputGroup",groupName:"用户输入",components:[Zs]},{groupId:"chooseGroup",groupName:"用户选择",components:[at]}];function ct(e){return it.find((s=>s.type===e))}const{Title:ot}=P,dt=()=>qe.jsx(qe.Fragment,{children:lt.map(((e,t)=>{const{groupId:n,groupName:r,components:a}=e;return qe.jsxs("div",{children:[qe.jsx(ot,{level:3,style:{fontSize:"16px",marginTop:t>0?"20px":"0"},children:r}),qe.jsx("div",{children:a.map((e=>(e=>{const{title:t,type:n,Component:r,defaultProps:a}=e,i=J(),l=s.useCallback((()=>{i(Je({fe_id:Me(),title:t,type:n,props:a}))}),[]);return qe.jsx("div",{onClick:l,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:qe.jsx("div",{className:"pointer-events-none",children:qe.jsx(r,{})})},n)})(e)))})]},n)}))}),mt=()=>qe.jsxs(qe.Fragment,{children:[qe.jsx("div",{children:"layers"})," "]}),xt=()=>{const e=[{key:"componentLib",label:qe.jsxs("span",{children:[qe.jsx(b,{}),"组件库"]}),children:qe.jsx(dt,{})},{key:"layers",label:qe.jsxs("span",{children:[qe.jsx(a,{}),"组件库"]}),children:qe.jsx(mt,{})}];return qe.jsx(qe.Fragment,{children:qe.jsx(G,{items:e,defaultActiveKey:"componentLib"})})},ut=({loading:e})=>{const{componentList:s,selectedIs:t}=us(),n=J();if(function(){const e=J();xe(["backspace","delete"],(()=>{xs()&&e(Qe())})),xe(["ctrl.c","meta.c"],(()=>{xs()&&e(ss())})),xe(["ctrl.v","meta.v"],(()=>{xs()&&e(ts())})),xe("uparrow",(()=>{xs()&&e(ns())})),xe("downarrow",(()=>{xs()&&e(rs())})),xe(["ctrl.z","meta.z"],(()=>{xs()&&e(je.undo())}),{exactMatch:!0}),xe(["ctrl.shift.z","meta.shift.z"],(()=>{xs()&&e(je.redo())}))}(),e)return qe.jsx("div",{className:"mt-6 text-center",children:qe.jsx(q,{})});const r=e=>{const{type:s,props:t}=e,n=ct(s);if(null==n)return null;const{Component:r}=n;return qe.jsx(r,{...t})};return qe.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:s.map((e=>{const{fe_id:s}=e,t=w({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return qe.jsx("div",{className:t,onClick:e=>{return t=s,e.stopPropagation(),void n(Ye(t));var t},children:qe.jsx("div",{className:"pointer-events-none",children:r(e)})},s)}))})},ht=()=>qe.jsx("div",{className:"text-center",children:"未选中组件"}),pt=()=>{const e=J(),{selectedComponent:s}=us();if(null==s)return qe.jsx(ht,{});const{type:t,props:n}=s,r=ct(t);if(null==r)return qe.jsx(ht,{});const{PropComponent:a}=r;return qe.jsx(a,{...n,onChange:t=>{const{fe_id:n}=s;e(Xe({fe_id:n,newProps:t}))}})},jt=()=>{const[e,t]=s.useState("prop"),{selectedId:n}=us();s.useEffect((()=>{t(n?"prop":"setting")}),[n]);const r=[{key:"prop",label:qe.jsxs("span",{children:[qe.jsx(k,{}),"属性"]}),children:qe.jsx(pt,{})},{key:"setting",label:qe.jsxs("span",{children:[qe.jsx(I,{}),"页面设置"]}),children:qe.jsx("div",{children:"页面设置"})}];return qe.jsx(G,{activeKey:e,items:r})},ft=()=>{const{loading:e}=ws(),{title:s}=X((e=>e.pageInfo));return pe("问卷编辑 - ".concat(s)),qe.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[qe.jsx(Js,{}),qe.jsx("div",{className:"flex-1 py-3",children:qe.jsxs("div",{className:"mx-6 h-100% flex",children:[qe.jsx("div",{className:"w-75 bg-white px-3",children:qe.jsx(xt,{})}),qe.jsx("div",{className:"relative flex-1 overflow-hidden",children:qe.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:qe.jsx(ut,{loading:e})})}),qe.jsx("div",{className:"w-75 bg-white px-3",children:qe.jsx(jt,{})})]})})]})},gt=()=>{const{loading:e,questionData:s}=ws();return qe.jsxs("div",{children:[qe.jsx("p",{children:"Stat"}),e?qe.jsx("p",{children:"loading"}):qe.jsx("p",{children:JSON.stringify(s)})]})},{Title:vt,Paragraph:yt}=P,Ct=()=>{const e=le();return qe.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:qe.jsxs("div",{className:"text-center",children:[qe.jsx(vt,{children:"问卷调查 | 在线投票"}),qe.jsx(yt,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),qe.jsx("div",{className:"h-15 font-24",children:qe.jsx(E,{className:"b-rounded-4",type:"primary",onClick:()=>e(Lt),children:"开始使用"})})]})})},{Title:bt}=P,wt="USERNAME",kt="PASSWORD";const It=()=>{const e=le(),t=J(),[n]=T.useForm();s.useEffect((()=>{const{username:e,password:s}={username:localStorage.getItem(wt),password:localStorage.getItem(kt)};n.setFieldsValue({username:e,password:s})}),[]);const{run:r}=ue((async(e,s)=>{const n=await async function(e,s){const t={username:e,password:s};return await gs.post("/api/user/login",t)}(e,s);return n.token&&t(De({username:e,nickname:e})),n}),{manual:!0,onSuccess(s){const{token:t=""}=s;!function(e){localStorage.setItem(ms,e)}(t),L.success("登录成功"),e(Lt)}});return qe.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[qe.jsx("div",{children:qe.jsxs(_,{children:[qe.jsx(bt,{level:2,children:qe.jsx(c,{})}),qe.jsx(bt,{level:2,children:"登录"})]})}),qe.jsx("div",{children:qe.jsxs(T,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{const{username:s,password:t,remember:n}=e||{};r(s,t),n?function(e,s){localStorage.setItem(wt,e),localStorage.setItem(kt,s)}(s,t):(localStorage.removeItem(wt),localStorage.removeItem(kt))},children:[qe.jsx(T.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:qe.jsx(z,{})}),qe.jsx(T.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:qe.jsx(z.Password,{})}),qe.jsx(T.Item,{name:"remember",valuePropName:"checked",wrapperCol:{offset:0,span:10},children:qe.jsx(W,{children:"记住我"})}),qe.jsx(T.Item,{wrapperCol:{offset:4,span:18},children:qe.jsxs(_,{children:[qe.jsx(E,{type:"primary",htmlType:"submit",children:"登录"}),qe.jsx(ne,{to:Pt,children:"注册新用户"})]})})]})})]})},Nt=oe([{path:"/",element:qe.jsx(Es,{}),children:[{path:"/",element:qe.jsx(Ct,{})},{path:"login",element:qe.jsx(It,{})},{path:"register",element:qe.jsx(Ts,{})},{path:"manage",element:qe.jsx(Fs,{}),children:[{path:"list",element:qe.jsx(Hs,{})},{path:"star",element:qe.jsx($s,{})},{path:"trash",element:qe.jsx(Ws,{})}]},{path:"*",element:qe.jsx(zs,{})}]},{path:"question",element:qe.jsx(qs,{}),children:[{path:"edit/:id",element:qe.jsx(ft,{})},{path:"stat/:id",element:qe.jsx(gt,{})}]}],{basename:"/survey-sage"}),St="/",_t="/login",Pt="/register",Lt="/manage/list";const Et=()=>qe.jsx($,{theme:{algorithm:Y.defaultAlgorithm},children:qe.jsx(de,{router:Nt})});Re.createRoot(document.getElementById("root")).render(qe.jsx(N.StrictMode,{children:qe.jsx(Q,{store:ls,children:qe.jsx(Et,{})})}));export{e as __vite_legacy_guard};
