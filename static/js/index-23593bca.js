import{r as e,c as s,p as n,s as i,a as t,j as r,b as a,t as l,m as o,d,u as c,e as x,n as m,f as j,g as p,h,i as u}from"./index-93471900.js";import{a as f}from"./react-redux-f2c040a7.js";import{I as v,F as b,J as g,H as y}from"./ahooks-4a9cec88.js";import{u as k,a as C,c as N,g as w,b as I}from"./index-5641f658.js";import{ai as _,W as L,am as S,ae as z,an as E,ao as D,K as P,ap as F,aq as H,r as T,ad as q,L as B,O as K,z as M,ar as V,M as J,as as A,at as O}from"./@ant-design/icons-8d84517b.js";import{M as R}from"./redux-undo-58253284.js";import{S as W,f as G,B as Q,I as U,m as X,T as Y,g as Z,a as $,F as ee,h as se}from"./antd-41055c6a.js";import{d as ne,b as ie}from"./react-router-dom-68488153.js";import{d as te,e as re,D as ae,f as le,M as oe}from"./@dnd-kit/core-0365c8c8.js";import{S as de,v as ce,u as xe}from"./@dnd-kit/sortable-bbe48c8b.js";import{C as me}from"./@dnd-kit/utilities-cf8ac1fd.js";import"./@reduxjs/toolkit-ecf8b8f6.js";import"./lodash-es-34fbd7b9.js";import"./axios-83bdef92.js";import"./recharts-62b39eab.js";const je=()=>document.activeElement===document.body;const pe=()=>{const i=f(),{selectedId:t,componentList:d,selectedComponent:c,copiedComponent:x}=k(),m=d.findIndex((e=>e.fe_id===t)),j=m<=0,p=m+1>=d.length,h=(null==c?void 0:c.isLocked)?"primary":"default",u=[{title:"删除",shape:"circle",icon:r.jsx(_,{}),onClick:()=>{i(e())}},{title:"隐藏",shape:"circle",icon:r.jsx(L,{}),onClick:()=>{i(a({fe_id:t,isHidden:!0}))}},{title:"锁定",type:h,shape:"circle",icon:r.jsx(S,{}),onClick:()=>{i(l({fe_id:t}))}},{title:"复制",shape:"circle",icon:r.jsx(z,{}),onClick:()=>{i(s())}},{title:"粘贴",shape:"circle",icon:r.jsx(E,{}),onClick:()=>{i(n())},disabled:null==x},{title:"上移",shape:"circle",icon:r.jsx(D,{}),onClick:()=>{j||i(o({oldIndex:m,newIndex:m-1}))},disabled:j},{title:"下移",shape:"circle",icon:r.jsx(P,{}),onClick:()=>{p||i(o({oldIndex:m,newIndex:m+1}))},disabled:p},{title:"撤销",shape:"circle",icon:r.jsx(F,{}),onClick:()=>{i(R.undo())}},{title:"重做",shape:"circle",icon:r.jsx(H,{}),onClick:()=>{i(R.redo())}}];return r.jsx(W,{children:u.map((e=>{const{title:s,type:n,shape:i,icon:t,onClick:a,disabled:l}=e;return r.jsx(G,{title:s,children:r.jsx(Q,{type:n,shape:i,icon:t,onClick:a,disabled:l})},s)}))})},he=()=>{const{title:e}=C(),s=f(),[n,i]=T.useState(!1),t=e=>{const n=e.target.value.trim();n&&s(d(n))};return n?r.jsx(U,{value:e,onChange:t,onPressEnter:()=>i(!1),onBlur:()=>i(!1)}):r.jsxs(W,{children:[r.jsx("div",{children:e}),r.jsx(Q,{icon:r.jsx(q,{}),type:"text",onClick:()=>i(!0)})]})},ue=()=>{const{id:e}=ne(),{componentList:s=[]}=k(),n=C(),{loading:i,run:t}=b((async()=>{e&&await c(e,{...n,componentList:s})}),{manual:!0});return v(["ctrl.s","meta.s"],(e=>{e.preventDefault(),i||t()})),g((()=>{t()}),[s,n],{wait:1e3}),r.jsx(Q,{onClick:t,disabled:i,icon:i?r.jsx(B,{}):null,children:"保存"})},fe=()=>{const e=ie(),{id:s}=ne(),{componentList:n=[]}=k(),i=C(),{loading:t,run:a}=b((async()=>{s&&await c(s,{...i,componentList:n,isPublished:!0})}),{manual:!0,onSuccess(){X.success("发布成功"),e("/question/stat/"+s)}});return r.jsx(Q,{type:"primary",onClick:a,disabled:t,icon:t?r.jsx(B,{}):null,children:"发布"})},ve=()=>r.jsxs(W,{children:[r.jsx(ue,{}),r.jsx(fe,{})]}),be=()=>{const e=ie();return r.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[r.jsx("div",{className:"flex-1",children:r.jsxs(W,{children:[r.jsx(Q,{type:"link",icon:r.jsx(K,{}),onClick:()=>e(-1),children:"返回"}),r.jsx("div",{className:"mb-0 text-[18px] leading-none",children:r.jsx(he,{})})]})}),r.jsx("div",{className:"flex-1 text-center leading-[2]",children:r.jsx(pe,{})}),r.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:r.jsx(ve,{})})]})},{Title:ge}=Y,ye=()=>r.jsx(r.Fragment,{children:N.map(((e,s)=>{const{groupId:n,groupName:i,components:t}=e;return r.jsxs("div",{children:[r.jsx(ge,{level:3,style:{fontSize:"16px",marginTop:s>0?"20px":"0"},children:i}),r.jsx("div",{children:t.map((e=>(e=>{const{title:s,type:n,Component:i,defaultProps:t}=e,a=f(),l=T.useCallback((()=>{a(x({fe_id:m(),title:s,type:n,props:t}))}),[]);return r.jsx("div",{onClick:l,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:r.jsx("div",{className:"pointer-events-none",children:r.jsx(i,{})})},n)})(e)))})]},n)}))}),ke=e=>{const{children:s,items:n,onDragEnd:i}=e,t=te(re(oe,{activationConstraint:{distance:8}}));return r.jsx(ae,{sensors:t,collisionDetection:le,onDragEnd:e=>{const{active:s,over:t}=e;if(null!=t&&s.id!==t.id){const e=n.findIndex((e=>e.fe_id===s.id)),r=n.findIndex((e=>e.fe_id===t.id));i(e,r)}},children:r.jsx(de,{items:n,strategy:ce,children:s})})},Ce=({id:e,children:s})=>{const{attributes:n,listeners:i,setNodeRef:t,transform:a,transition:l}=xe({id:e}),o={transform:me.Transform.toString(a),transition:l};return r.jsx("div",{ref:t,style:o,...n,...i,children:s})},Ne=()=>{const{componentList:e,selectedId:s}=k(),n=f(),[i,t]=T.useState(""),d=e=>{const i=e.target.value.trim();i&&s&&n(p({fe_id:s,title:i}))},c=e.map((e=>({...e,id:e.fe_id})));return r.jsx(ke,{items:c,onDragEnd:(e,s)=>{n(o({oldIndex:e,newIndex:s}))},children:e.map((o=>{const{fe_id:c,title:x,isHidden:m,isLocked:p}=o,h=M({"flex-auto line-height-loose":!0,"color-blue":c===s}),u="opacity-20",f=M({[u]:m}),v=M({[u]:m});return r.jsx(Ce,{id:c,children:r.jsxs("div",{className:"flex border-b border-b-green-200 border-b-solid py-2",children:[r.jsxs("div",{className:h,onClick:()=>(i=>{const r=e.find((e=>e.fe_id===i));return r&&r.isHidden?X.info("不能选中隐藏的组件!"):i!==s?(n(j(i)),void t("")):void t(i)})(c),children:[c===i&&r.jsx(U,{value:x,onChange:d,onPressEnter:()=>t(""),onBlur:()=>t("")}),c!==i&&x]}),r.jsx("div",{className:"w-12 text-end",children:r.jsxs(W,{children:[r.jsx(Q,{size:"small",shape:"circle",className:f,icon:r.jsx(L,{}),type:m?"primary":"text",onClick:()=>((e,s)=>{n(a({fe_id:e,isHidden:s}))})(c,!m)}),r.jsx(Q,{size:"small",shape:"circle",className:v,icon:r.jsx(S,{}),type:p?"primary":"text",onClick:()=>(e=>{n(l({fe_id:e}))})(c)})]})})]})},c)}))})},we=()=>{const e=[{key:"componentLib",label:r.jsxs("span",{children:[r.jsx(V,{}),"组件库"]}),children:r.jsx(ye,{})},{key:"layers",label:r.jsxs("span",{children:[r.jsx(J,{}),"图层"]}),children:r.jsx(Ne,{})}];return r.jsx(r.Fragment,{children:r.jsx(Z,{items:e,defaultActiveKey:"componentLib"})})},Ie=({loading:a})=>{const{componentList:l,selectedIs:d}=k(),c=f();if(function(){const r=f();v(["backspace","delete"],(()=>{je()&&r(e())})),v(["ctrl.c","meta.c"],(()=>{je()&&r(s())})),v(["ctrl.v","meta.v"],(()=>{je()&&r(n())})),v("uparrow",(()=>{je()&&r(i())})),v("downarrow",(()=>{je()&&r(t())})),v(["ctrl.z","meta.z"],(()=>{je()&&r(R.undo())}),{exactMatch:!0}),v(["ctrl.shift.z","meta.shift.z"],(()=>{je()&&r(R.redo())}))}(),a)return r.jsx("div",{className:"mt-6 text-center",children:r.jsx($,{})});const x=e=>{const{type:s,props:n}=e,i=w(s);if(null==i)return null;const{Component:t}=i;return r.jsx(t,{...n})},m=l.map((e=>({...e,id:e.fe_id})));return r.jsx(ke,{items:m,onDragEnd:(e,s)=>{c(o({oldIndex:e,newIndex:s}))},children:r.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:l.map((e=>{const{fe_id:s}=e,n=M({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return r.jsx(Ce,{id:s,children:r.jsx("div",{className:n,onClick:e=>{return n=s,e.stopPropagation(),void c(j(n));var n},children:r.jsx("div",{className:"pointer-events-none",children:x(e)})})},s)}))})})},_e=()=>r.jsx("div",{className:"text-center",children:"未选中组件"}),Le=()=>{const e=f(),{selectedComponent:s}=k();if(null==s)return r.jsx(_e,{});const{type:n,props:i}=s,t=w(n);if(null==t)return r.jsx(_e,{});const{PropComponent:a}=t;return r.jsx(a,{...i,onChange:n=>{const{fe_id:i}=s;e(h({fe_id:i,newProps:n}))}})},Se=()=>{const e=C(),[s]=ee.useForm(),n=f();return r.jsxs(ee,{layout:"vertical",initialValues:e,onValuesChange:()=>{n(u(s.getFieldsValue()))},form:s,children:[r.jsx(ee.Item,{name:"title",label:"问卷标题",rules:[{required:!0,message:"请输入标题"}],children:r.jsx(U,{placeholder:"请输入标题"})}),r.jsx(ee.Item,{name:"desc",label:"问卷描述",children:r.jsx(se,{placeholder:"问卷描述信息"})}),r.jsx(ee.Item,{name:"css",label:"样式代码",children:r.jsx(se,{placeholder:"请输入 CSS 样式代码"})}),r.jsx(ee.Item,{name:"js",label:"脚本代码",children:r.jsx(se,{placeholder:"请输入 JS 脚本代码"})})]})},ze=()=>{const[e,s]=T.useState("prop"),{selectedId:n}=k();T.useEffect((()=>{s(n?"prop":"setting")}),[n]);const i=[{key:"prop",label:r.jsxs("span",{children:[r.jsx(A,{}),"属性"]}),children:r.jsx(Le,{})},{key:"setting",label:r.jsxs("span",{children:[r.jsx(O,{}),"页面设置"]}),children:r.jsx(Se,{})}];return r.jsx(Z,{activeKey:e,items:i})},Ee=()=>{const e=f(),{loading:s}=I(),{title:n}=C(),i=n?"问卷编辑 - ".concat(n):"问卷调查";y(i);return r.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[r.jsx(be,{}),r.jsx("div",{className:"flex-1 py-3",children:r.jsxs("div",{className:"mx-6 h-100% flex",children:[r.jsx("div",{className:"w-75 bg-white px-3",children:r.jsx(we,{})}),r.jsx("div",{className:"relative flex-1 overflow-hidden",onClick:()=>{e(j(""))},children:r.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:r.jsx(Ie,{loading:s})})}),r.jsx("div",{className:"w-75 bg-white px-3",children:r.jsx(ze,{})})]})})]})};export{Ee as default};
