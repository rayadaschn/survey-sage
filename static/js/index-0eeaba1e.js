function e(){import.meta.url,import("_").catch((()=>1))}import{r as s,af as t,ag as n,U as i,M as r,ah as l,ai as a,aj as c,ad as o,ak as d,ae as x,al as m,W as u,am as h,an as p,ao as j,K as f,ap as g,aq as v,L as y,O as b,ar as C,z as k,as as w,at as I,au as N,av as S,R as P}from"./@ant-design/icons-74a3c655.js";import{r as _,d as F,e as E,D as L,f as V,M as q}from"./@dnd-kit/core-d69b4d30.js";import{u as T,a as R,P as z}from"./react-redux-70fabaf9.js";import{c as D,p as A,a as O,n as H}from"./@reduxjs/toolkit-2a918d97.js";import{a as B,S as K,v as M,u as U}from"./@dnd-kit/sortable-97301ac0.js";import{c as W}from"./lodash-es-34fbd7b9.js";import{C as G,D as $,M as J}from"./redux-undo-58253284.js";import{L as Y,u as Q,a as X,b as Z,c as ee,O as se,d as te,R as ne}from"./react-router-dom-a5073cc0.js";import{S as ie,m as re,B as le,L as ae,a as ce,D as oe,F as de,I as xe,T as me,R as ue,b as he,P as pe,M as je,E as fe,c as ge,d as ve,e as ye,C as be,f as Ce,g as ke,h as we,i as Ie,j as Ne,Q as Se,k as Pe,t as _e}from"./antd-4dd5c312.js";import{a as Fe}from"./axios-83bdef92.js";import{F as Ee,G as Le,H as Ve,I as qe,J as Te}from"./ahooks-d1ed29b4.js";import{R as Re,B as ze,C as De,X as Ae,Y as Oe,T as He,a as Be,P as Ke,b as Me,c as Ue}from"./recharts-cc46d28e.js";import{C as We}from"./@dnd-kit/utilities-456bb9d8.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var Ge={exports:{}},$e={},Je=s,Ye=Symbol.for("react.element"),Qe=Symbol.for("react.fragment"),Xe=Object.prototype.hasOwnProperty,Ze=Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,es={key:!0,ref:!0,__self:!0,__source:!0};function ss(e,s,t){var n,i={},r=null,l=null;for(n in void 0!==t&&(r=""+t),void 0!==s.key&&(r=""+s.key),void 0!==s.ref&&(l=s.ref),s)Xe.call(s,n)&&!es.hasOwnProperty(n)&&(i[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===i[n]&&(i[n]=s[n]);return{$$typeof:Ye,type:e,key:r,ref:l,props:i,_owner:Ze.current}}$e.Fragment=Qe,$e.jsx=ss,$e.jsxs=ss,Ge.exports=$e;var ts=Ge.exports;var ns={},is=_;ns.createRoot=is.createRoot,ns.hydrateRoot=is.hydrateRoot;const rs={username:"",nickname:""},ls=D({name:"user",initialState:rs,reducers:{loginReducer:(e,s)=>s.payload,logoutReducer:()=>rs}}),as=ls.reducer,{loginReducer:cs,logoutReducer:os}=ls.actions,ds=D({name:"pageInfo",initialState:{title:"",desc:"",js:"",css:""},reducers:{resetPageInfo:(e,s)=>s.payload,changePageTitle:A(((e,s)=>{e.title=s.payload}))}}),xs=ds.reducer,{resetPageInfo:ms,changePageTitle:us}=ds.actions;let hs=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,s)=>e+=(s&=63)<36?s.toString(36):s<62?(s-26).toString(36).toUpperCase():s>62?"-":"_"),"");function ps(e,s){const t=s.filter((e=>!e.isHidden)),n=t.findIndex((s=>s.fe_id===e));if(n<0)return"";let i="";const r=t.length;return i=r<=1?"":n+1===r?t[n-1].fe_id:t[n+1].fe_id,i}function js(e,s){const{selectedId:t,componentList:n}=e,i=n.findIndex((e=>e.fe_id===t));i<0?e.componentList.push(s):e.componentList.splice(i+1,0,s),e.selectedId=s.fe_id}const fs=D({name:"components",initialState:{componentList:[],selectedId:"",copiedComponent:null},reducers:{resetComponents:(e,s)=>s.payload,changeSelectedId:A(((e,s)=>{e.selectedId=s.payload})),addComponent:A(((e,s)=>{js(e,s.payload)})),changeComponentProps:A(((e,s)=>{const{fe_id:t,newProps:n}=s.payload,i=e.componentList.find((e=>e.fe_id===t));i&&(i.props={...i.props,...n})})),removeSelectedComponent:A((e=>{const{componentList:s=[],selectedId:t}=e,n=ps(t,s);e.selectedId=n;const i=s.findIndex((e=>e.fe_id===t));s.splice(i,1)})),changeComponentHidden:A(((e,s)=>{const{componentList:t=[]}=e,{fe_id:n,isHidden:i}=s.payload;let r="";r=i?ps(n,t):n,e.selectedId=r;const l=t.find((e=>e.fe_id===n));l&&(l.isHidden=i)})),toggleComponentLocked:A(((e,s)=>{const{fe_id:t}=s.payload,n=e.componentList.find((e=>e.fe_id===t));n&&(n.isLocked=!n.isLocked)})),copySelectedComponent:A((e=>{const{selectedId:s,componentList:t=[]}=e,n=t.find((e=>e.fe_id===s));null!=n&&(e.copiedComponent=W(n))})),pasteCopiedComponent:A((e=>{const{copiedComponent:s}=e;null!=s&&(s.fe_id=hs(),js(e,s))})),selectPrevComponent:A((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n<=0||(e.selectedId=t[n-1].fe_id)})),selectNextComponent:A((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n+1!==t.length&&(e.selectedId=t[n+1].fe_id)})),changeComponentTitle:A(((e,s)=>{const{title:t,fe_id:n}=s.payload,i=e.componentList.find((e=>e.fe_id===n));i&&(i.title=t)})),moveComponent:A(((e,s)=>{const{componentList:t}=e,{oldIndex:n,newIndex:i}=s.payload;e.componentList=B(t,n,i)}))}}),{resetComponents:gs,changeSelectedId:vs,addComponent:ys,changeComponentProps:bs,removeSelectedComponent:Cs,changeComponentHidden:ks,toggleComponentLocked:ws,copySelectedComponent:Is,pasteCopiedComponent:Ns,selectPrevComponent:Ss,selectNextComponent:Ps,changeComponentTitle:_s,moveComponent:Fs}=fs.actions,Es=O({reducer:{user:as,pageInfo:xs,components:G(fs.reducer,{limit:20,filter:$(["components/resetComponents","components/changeSelectedId","components/selectPrevComponent","components/selectNextComponent"])})}}),Ls=()=>ts.jsx("div",{children:ts.jsx(Y,{to:"/",children:ts.jsx(ie,{children:ts.jsxs("div",{className:"text-7 color-white",children:[ts.jsx(t,{}),ts.jsx("span",{children:"问卷调查"})]})})})}),Vs="keyword",qs="page",Ts="pageSize",Rs=["#FF2D2D","#BE77FF","#2894FF","#00EC00","#EAC100","#FF9D6F"],zs=Fe.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});zs.interceptors.request.use((e=>(e.headers.Authorization="Bearer ".concat(localStorage.getItem(Ds)||""),e)),(e=>(re.error(e.message),Promise.reject(e)))),zs.interceptors.response.use((e=>{const s=e.data||{},{errno:t,data:n,msg:i}=s;return 203===t||0!==t&&200!==t?(re.error(i||"请求失败"),Promise.reject(n)):n}),(e=>{var s;let t="";switch(null==(s=e.response)?void 0:s.status){case 401:t="token 失效，请重新登录";break;case 403:t="拒绝访问";break;case 404:t="请求地址错误";break;case 500:t="服务器故障";break;default:t="网络连接故障"}return re.error(t),Promise.reject(e)}));const Ds="USER_TOKEN";const As=()=>document.activeElement===document.body;function Os(){const e=R((e=>e.components.present)),{componentList:s=[],selectedId:t,copiedComponent:n}=e,i=s.find((e=>e.fe_id===t));return{componentList:s,selectedId:t,selectedComponent:i,copiedComponent:n}}function Hs(){return R((e=>e.pageInfo))}function Bs(){const{username:e,nickname:s}=R((e=>e.user));return{username:e,nickname:s}}async function Ks(){return await zs.post("/api/question/")}async function Ms(e={}){return await zs.get("/api/question",{params:e})}async function Us(e,s){const t="/api/question/".concat(e);return await zs.patch(t,s)}async function Ws(){return await zs.get("/api/user/info")}function Gs(){const{id:e=""}=Q(),t=T(),{data:n,loading:i,error:r,run:l}=Le((async e=>{if(!e)throw new Error("缺少问卷 id");const s=await async function(e){const s="/api/question/".concat(e);return await zs.get(s)}(e);return s}),{manual:!0});return s.useEffect((()=>{if(!n)return;const{title:e="",desc:s="",js:i="",css:r="",componentList:l=[]}=n;let a="";l.length>0&&(a=l[0].fe_id),t(gs({componentList:l,selectedId:a,copiedComponent:null})),t(ms({title:e,desc:s,js:i,css:r}))}),[n]),s.useEffect((()=>{l(e)}),[e]),{loading:i,error:r}}function $s(e={}){const{isStar:s,isDeleted:t}=e,[n]=X(),{data:i,loading:r,error:l,refresh:a}=Le((async()=>{const e=n.get(Vs)||"",i=parseInt(n.get(qs)||"")||1,r=parseInt(n.get(Ts)||"")||10;return await Ms({keyword:e,isStar:s,isDeleted:t,page:i,pageSize:r})}),{refreshDeps:[n]});return{data:i,loading:r,error:l,refresh:a}}function Js(){const e=T(),[t,n]=s.useState(!0),{run:i}=Le(Ws,{manual:!0,onSuccess(s){const{username:t,nickname:n}=s;e(cs({username:t,nickname:n}))},onFinally(){n(!1)}}),{username:r}=Bs();return s.useEffect((()=>{r?n(!1):i()}),[t]),{waitingUserData:t}}function Ys(e){const{username:t}=Bs(),{pathname:n}=Z(),i=ee();s.useEffect((()=>{e||(t?function(e){return[Ln,Vn].includes(e)}(n)&&i(qn):function(e){return[En,Ln,Vn].includes(e)}(n)||i(Ln))}),[e,t,n])}const Qs=()=>{const e=ee(),s=T(),{username:t,nickname:i}=Bs();const r=ts.jsxs(ts.Fragment,{children:[ts.jsxs("span",{className:"color-light",children:[ts.jsx(n,{}),i]}),ts.jsx(le,{type:"link",onClick:function(){s(os()),localStorage.removeItem(Ds),re.success("退出成功"),e(Ln)},children:"退出"})]}),l=ts.jsx(Y,{to:Ln,children:"登录"});return ts.jsx(ts.Fragment,{children:t?r:l})},{Header:Xs,Content:Zs,Footer:et}=ae,st=()=>{const{waitingUserData:e}=Js();return Ys(e),ts.jsxs(ae,{children:[ts.jsxs(Xs,{className:"px-6",children:[ts.jsx("div",{className:"float-left",children:ts.jsx(Ls,{})}),"MainLayout header",ts.jsx("div",{className:"float-right",children:ts.jsx(Qs,{})})]}),ts.jsx(Zs,{className:"min-h-[calc(100vh-140px)]",children:e?ts.jsx("div",{className:"mt-15 text-center",children:ts.jsx(ce,{})}):ts.jsx(se,{})}),ts.jsx(et,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"问卷调查 ©2023 - present. Created by Huy"})]})},tt=()=>{const e=ee(),{pathname:s}=Z(),{loading:t,run:n}=Le(Ks,{manual:!0,onSuccess(s){e("question/edit/".concat(s.id)),re.success("创建成功")}});return ts.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[ts.jsx("div",{className:"w-30",children:ts.jsxs(ie,{direction:"vertical",children:[ts.jsx(le,{type:"primary",size:"large",icon:ts.jsx(i,{}),onClick:n,disabled:t,children:"新建问卷"}),ts.jsx(oe,{}),ts.jsx(le,{type:s.startsWith("/manage/list")?"default":"text",size:"large",icon:ts.jsx(r,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),ts.jsx(le,{type:s.startsWith("/manage/star")?"default":"text",size:"large",icon:ts.jsx(l,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),ts.jsx(le,{type:s.startsWith("/manage/trash")?"default":"text",size:"large",icon:ts.jsx(a,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),ts.jsx("div",{className:"ml-15 flex-1",children:ts.jsx(se,{})})]})},nt=()=>{const{waitingUserData:e}=Js();return Ys(e),ts.jsx("div",{className:"h-screen",children:e?ts.jsx("div",{className:"mt-15 text-center",children:ts.jsx(ce,{})}):ts.jsx(se,{})})},{Title:it}=me,rt=()=>{const e=ee(),{run:s}=Le((async e=>{const{username:s,password:t,nickname:n}=e;await async function(e,s,t){const n={username:e,password:s,nickname:t||e};return await zs.post("/api/user/register",n)}(s,t,n)}),{manual:!0,onSuccess(){re.success("注册成功"),e(Ln)}});return ts.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[ts.jsx("div",{children:ts.jsxs(ie,{children:[ts.jsx(it,{level:2,children:ts.jsx(c,{})}),ts.jsx(it,{level:2,children:"注册新用户"})]})}),ts.jsx("div",{children:ts.jsxs(de,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{s(e)},children:[ts.jsx(de.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:ts.jsx(xe,{})}),ts.jsx(de.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:ts.jsx(xe.Password,{})}),ts.jsx(de.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(s,t)=>t&&e("password")!==t?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:ts.jsx(xe.Password,{})}),ts.jsx(de.Item,{label:"昵称",name:"nickname",children:ts.jsx(xe,{})}),ts.jsx(de.Item,{wrapperCol:{offset:4,span:18},children:ts.jsxs(ie,{children:[ts.jsx(le,{type:"primary",htmlType:"submit",children:"注册"}),ts.jsx(Y,{to:Ln,children:"已有账户，请登录"})]})})]})})]})},lt=()=>{const e=ee();return ts.jsx(ts.Fragment,{children:ts.jsx(ue,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:ts.jsx(le,{type:"primary",onClick:()=>e(qn),children:"返回首页"})})})},{confirm:at}=je,ct=e=>{const t=ee(),{_id:n,title:i,isPublished:r,answerContent:c,currentAt:u,isStar:h}=e,[p,j]=s.useState(h),{loading:f,run:g}=Le((async()=>{await Us(n,{isStar:!p})}),{manual:!0,onSuccess(){j(!p),re.success("已更新")}}),{loading:v,run:y}=Le((async()=>await async function(e){const s="/api/question/duplicate/".concat(e);return await zs.post(s)}(n)),{manual:!0,onSuccess(e){re.success("复制成功"),t("/question/edit/".concat(e.id))}}),[b,C]=s.useState(!1),{loading:k,run:w}=Le((async()=>await Us(n,{isDeleted:!0})),{manual:!0,onSuccess(){re.success("删除成功"),C(!0)}});return b?null:ts.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[ts.jsxs("div",{className:"flex",children:[ts.jsx("div",{className:"flex-1",children:ts.jsx(Y,{to:r?"/question/stat/".concat(n):"/question/edit/".concat(n),children:ts.jsxs(ie,{children:[h&&ts.jsx(l,{style:{color:"red"}}),i]})})}),ts.jsx("div",{className:"flex-1 text-center font-size-3",children:ts.jsxs(ie,{children:[r?ts.jsx(he,{color:"processing",children:"已发布"}):ts.jsx(he,{children:"未发布"}),ts.jsxs("span",{children:["答卷: ",c]}),ts.jsx("span",{children:u})]})})]}),ts.jsx(oe,{className:"m-3"}),ts.jsxs("div",{className:"flex",children:[ts.jsx("div",{className:"flex-1",children:ts.jsxs(ie,{children:[ts.jsx(le,{icon:ts.jsx(o,{}),type:"text",size:"small",onClick:()=>{t("/question/edit/".concat(n))},children:"编辑问卷"}),ts.jsx(le,{icon:ts.jsx(d,{}),type:"text",size:"small",onClick:()=>{t("/question/stat/".concat(n))},children:"数据统计"})]})}),ts.jsx("div",{className:"flex-1 text-center",children:ts.jsxs(ie,{children:[ts.jsx(le,{type:"text",icon:ts.jsx(l,{}),color:"#999",size:"small",onClick:g,disabled:f,children:p?"取消标星":"标星"}),ts.jsx(pe,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:y,children:ts.jsx(le,{type:"text",icon:ts.jsx(x,{}),color:"#999",size:"small",disabled:v,children:"复制"})}),ts.jsx(le,{type:"text",icon:ts.jsx(a,{}),size:"small",color:"#999",onClick:()=>{at({title:"确定删除该问卷?",icon:ts.jsx(m,{}),onOk:w})},disabled:k,children:"删除"})]})})]})]})},{Search:ot}=xe,dt=()=>{const e=ee(),{pathname:t}=Z(),[n,i]=s.useState("");const[r]=X();return s.useEffect((()=>{const e=r.get(Vs)||"";i(e)}),[r]),ts.jsx(ot,{placeholder:"请输入关键字",value:n,onChange:function(e){i(e.target.value)},onSearch:function(s){e({pathname:t,search:"".concat(Vs,"=").concat(s)})},className:"w-50"})},{Title:xt}=me,mt=()=>{const[e,t]=s.useState(!1),[n,i]=s.useState(1),[r,l]=s.useState([]),[a,c]=s.useState(0),o=a>r.length,[d]=X(),x=d.get(Vs)||"";s.useEffect((()=>{t(!1),i(1),l([]),c(0)}),[x]);const{run:m,loading:u}=Le((async()=>await Ms({page:n,pageSize:10,keyword:x})),{manual:!0,onSuccess(e){const{list:s=[],total:t=0}=e;l(r.concat(s)),c(t),i(n+1)}}),h=s.useRef(null),{run:p}=Ve((()=>{const e=h.current;if(null==e)return;const s=e.getBoundingClientRect();if(null==s)return;const{bottom:n}=s;n<=document.body.clientHeight&&(m(),t(!0))}),{wait:1e3});s.useEffect((()=>{p()}),[d]),s.useEffect((()=>(o&&window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)})),[d,o]);const j=s.useMemo((()=>!e||u?ts.jsx(ce,{}):0===a?ts.jsx(fe,{description:"暂无数据"}):o?ts.jsx("span",{children:"开始加载下一页"}):ts.jsx("span",{children:"没有更多了..."})),[e,u,o]);return ts.jsxs(ts.Fragment,{children:[ts.jsxs("div",{className:"flex",children:[ts.jsx("div",{className:"flex-1",children:ts.jsx(xt,{level:3,children:"我的问卷"})}),ts.jsx("div",{className:"flex-1 text-center",children:ts.jsx(dt,{})})]}),ts.jsx("div",{className:"mb-5",children:r.length>0&&r.map((e=>{const{_id:s}=e;return ts.jsx(ct,{...e},s)}))}),ts.jsx("div",{className:"text-center color-blue",children:ts.jsx("div",{ref:h,children:j})})]})},ut=e=>{const{total:t}=e,[n,i]=s.useState(1),[r,l]=s.useState(10),[a]=X();s.useEffect((()=>{const e=parseInt(a.get(qs)||"")||1;i(e);const s=parseInt(a.get(Ts)||"")||10;l(s)}),[a]);const c=ee(),{pathname:o}=Z();return ts.jsx(ge,{current:n,pageSize:r,total:t,onChange:(e,s)=>{a.set(qs,e.toString()),a.set(Ts,s.toString()),c({pathname:o,search:a.toString()})}})},{Title:ht}=me,{confirm:pt}=je,jt=()=>{qe("问卷调查");const{data:e={},loading:t,refresh:n}=$s({isDeleted:!0}),{list:i=[],total:r=0}=e,[l,a]=s.useState([]),c=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?ts.jsx(he,{color:"processing",children:"已发布"}):ts.jsx(he,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:o}=Le((async()=>{for await(const e of l)await Us(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){re.success("恢复成功"),n(),a([])}}),{run:d}=Le((async()=>await async function(e){return await zs.delete("/api/question",{data:{ids:e}})}(l)),{manual:!0,onSuccess(){re.success("删除成功"),n(),a([])}});return ts.jsxs(ts.Fragment,{children:[ts.jsxs("div",{className:"flex",children:[ts.jsx("div",{className:"flex-1",children:ts.jsx(ht,{level:3,children:"回收站"})}),ts.jsx("div",{className:"flex-1 text-center",children:ts.jsx(dt,{})})]}),ts.jsxs("div",{className:"mb-5",children:[t&&ts.jsx("div",{className:"text-center",children:ts.jsx(ce,{})}),!t&&0===i.length&&ts.jsx(fe,{description:"暂无数据"}),i.length>0&&ts.jsxs("div",{children:[ts.jsxs(ie,{className:"mb",children:[ts.jsx(le,{type:"primary",disabled:0===l.length,onClick:o,children:"恢复"}),ts.jsx(le,{danger:!0,disabled:0===l.length,onClick:()=>{pt({title:"确定彻底删除该问卷?",icon:ts.jsx(m,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),ts.jsx(ve,{rowKey:e=>e._id,dataSource:i,columns:c,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{a(e)}}})]})]}),ts.jsx("div",{className:"text-center color-blue",children:i.length>0&&ts.jsx(ut,{total:r})})]})},{Title:ft}=me,gt=()=>{const{data:e={},loading:s}=$s({isStar:!0}),{list:t=[],total:n=0}=e;return ts.jsxs(ts.Fragment,{children:[ts.jsxs("div",{className:"flex",children:[ts.jsx("div",{className:"flex-1",children:ts.jsx(ft,{level:3,children:"星标问卷"})}),ts.jsx("div",{className:"flex-1 text-center",children:ts.jsx(dt,{})})]}),ts.jsxs("div",{className:"mb-5",children:[s&&ts.jsx("div",{className:"text-center",children:ts.jsx(ce,{})}),!s&&0===t.length&&ts.jsx(fe,{description:"暂无数据"}),t.length>0&&t.map((e=>{const{_id:s}=e;return ts.jsx(ct,{...e},s)}))]}),ts.jsx("div",{className:"text-center color-blue",children:t.length>0&&ts.jsx(ut,{total:n})})]})},vt=()=>{const e=T(),{selectedId:s,componentList:t,selectedComponent:n,copiedComponent:i}=Os(),r=t.findIndex((e=>e.fe_id===s)),l=r<=0,c=r+1>=t.length,o=(null==n?void 0:n.isLocked)?"primary":"default",d=[{title:"删除",shape:"circle",icon:ts.jsx(a,{}),onClick:()=>{e(Cs())}},{title:"隐藏",shape:"circle",icon:ts.jsx(u,{}),onClick:()=>{e(ks({fe_id:s,isHidden:!0}))}},{title:"锁定",type:o,shape:"circle",icon:ts.jsx(h,{}),onClick:()=>{e(ws({fe_id:s}))}},{title:"复制",shape:"circle",icon:ts.jsx(x,{}),onClick:()=>{e(Is())}},{title:"粘贴",shape:"circle",icon:ts.jsx(p,{}),onClick:()=>{e(Ns())},disabled:null==i},{title:"上移",shape:"circle",icon:ts.jsx(j,{}),onClick:()=>{l||e(Fs({oldIndex:r,newIndex:r-1}))},disabled:l},{title:"下移",shape:"circle",icon:ts.jsx(f,{}),onClick:()=>{c||e(Fs({oldIndex:r,newIndex:r+1}))},disabled:c},{title:"撤销",shape:"circle",icon:ts.jsx(g,{}),onClick:()=>{e(J.undo())}},{title:"重做",shape:"circle",icon:ts.jsx(v,{}),onClick:()=>{e(J.redo())}}];return ts.jsx(ie,{children:d.map((e=>{const{title:s,type:t,shape:n,icon:i,onClick:r,disabled:l}=e;return ts.jsx(ye,{title:s,children:ts.jsx(le,{type:t,shape:n,icon:i,onClick:r,disabled:l})},s)}))})},yt=()=>{const{title:e}=Hs(),t=T(),[n,i]=s.useState(!1),r=e=>{const s=e.target.value.trim();s&&t(us(s))};return n?ts.jsx(xe,{value:e,onChange:r,onPressEnter:()=>i(!1),onBlur:()=>i(!1)}):ts.jsxs(ie,{children:[ts.jsx("div",{children:e}),ts.jsx(le,{icon:ts.jsx(o,{}),type:"text",onClick:()=>i(!0)})]})},bt=()=>{const{id:e}=Q(),{componentList:s=[]}=Os(),t=Hs(),{loading:n,run:i}=Le((async()=>{e&&await Us(e,{...t,componentList:s})}),{manual:!0});return Ee(["ctrl.s","meta.s"],(e=>{e.preventDefault(),n||i()})),Te((()=>{i()}),[s,t],{wait:1e3}),ts.jsx(le,{onClick:i,disabled:n,icon:n?ts.jsx(y,{}):null,children:"保存"})},Ct=()=>{const e=ee(),{id:s}=Q(),{componentList:t=[]}=Os(),n=Hs(),{loading:i,run:r}=Le((async()=>{s&&await Us(s,{...n,componentList:t,isPublished:!0})}),{manual:!0,onSuccess(){re.success("发布成功"),e("/question/stat/"+s)}});return ts.jsx(le,{type:"primary",onClick:r,disabled:i,icon:i?ts.jsx(y,{}):null,children:"发布"})},kt=()=>ts.jsxs(ie,{children:[ts.jsx(bt,{}),ts.jsx(Ct,{})]}),wt=()=>{const e=ee();return ts.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[ts.jsx("div",{className:"flex-1",children:ts.jsxs(ie,{children:[ts.jsx(le,{type:"link",icon:ts.jsx(b,{}),onClick:()=>e(-1),children:"返回"}),ts.jsx("div",{className:"mb-0 text-[18px] leading-none",children:ts.jsx(yt,{})})]})}),ts.jsx("div",{className:"flex-1 text-center leading-[2]",children:ts.jsx(vt,{})}),ts.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:ts.jsx(kt,{})})]})},It={title:"多选标题",isVertical:!1,list:[{value:"item1",text:"选项1",checked:!1},{value:"item2",text:"选项2",checked:!1},{value:"item3",text:"选项3",checked:!1}]},{Paragraph:Nt}=me,St={title:"多选",type:"questionCheckbox",Component:e=>{const{title:s,isVertical:t,list:n=[]}={...It,...e};return ts.jsxs("div",{children:[ts.jsx(Nt,{strong:!0,children:s}),ts.jsx(ie,{direction:t?"vertical":"horizontal",children:n.map((e=>{const{value:s,text:t,checked:n}=e;return ts.jsx(be,{value:s,checked:n,children:t},s)}))})]})},PropComponent:e=>{const{title:s,isVertical:t,list:n=[],onChange:r,disabled:l}=e,[a]=de.useForm();return ts.jsxs(de,{layout:"vertical",form:a,initialValues:{title:s,isVertical:t,list:n},disabled:l,onValuesChange:()=>{if(null==r)return;const e=a.getFieldsValue();e.list&&(e.list=e.list.filter((e=>!(null==e.text))));const{list:s=[]}=e;s.forEach((e=>{e.value||(e.value=hs(5))})),r(e)},children:[ts.jsx(de.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:ts.jsx(xe,{})}),ts.jsx(de.Item,{label:"选项",children:ts.jsx(de.List,{name:"list",children:(e,{add:s,remove:t})=>ts.jsxs(ts.Fragment,{children:[e.map((({key:e,name:s},n)=>ts.jsxs(ie,{align:"baseline",children:[ts.jsx(de.Item,{name:[s,"checked"],valuePropName:"checked",children:ts.jsx(be,{})}),ts.jsx(de.Item,{name:[s,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,s)=>{const{list:t=[]}=a.getFieldsValue();let n=0;return t.forEach((e=>{e.text===s&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:ts.jsx(xe,{placeholder:"输入选项文字..."})}),n>0&&ts.jsx(C,{onClick:()=>t(s)})]},e))),ts.jsx(de.Item,{children:ts.jsx(le,{type:"link",onClick:()=>s({text:"",value:"",checked:!1}),icon:ts.jsx(i,{}),block:!0,children:"添加选项"})})]})})}),ts.jsx(de.Item,{name:"isVertical",valuePropName:"checked",children:ts.jsx(be,{children:"竖向排列"})})]})},StatComponent:({stat:e})=>ts.jsx("div",{style:{width:"400px",height:"300px"},children:ts.jsx(Re,{width:"100%",height:"100%",children:ts.jsxs(ze,{width:400,height:300,data:e,margin:{top:5,right:30,left:0,bottom:5},children:[ts.jsx(De,{strokeDasharray:"3 3"}),ts.jsx(Ae,{dataKey:"name"}),ts.jsx(Oe,{}),ts.jsx(He,{}),ts.jsx(Be,{dataKey:"count",fill:"#8884d8"})]})})}),defaultProps:It},Pt={title:"问卷标题",desc:"问卷描述"},{Title:_t,Paragraph:Ft}=me,{TextArea:Et}=xe,Lt={title:"问卷信息",type:"questionInfo",Component:e=>{const{title:s,desc:t=""}={...Pt,...e},n=t.split("\n");return ts.jsxs("div",{style:{textAlign:"center"},children:[ts.jsx(_t,{style:{fontSize:"24px"},children:s}),ts.jsx(Ft,{children:n.map(((e,s)=>ts.jsxs("span",{children:[s>0&&ts.jsx("br",{}),e]},s)))})]})},PropComponent:e=>{const{title:t,desc:n,onChange:i,disabled:r}=e,[l]=de.useForm();return s.useEffect((()=>{l.setFieldsValue({title:t,desc:n})}),[t,n]),ts.jsxs(de,{layout:"vertical",initialValues:{title:t,desc:n},onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,form:l,children:[ts.jsx(de.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入问卷标题"}],children:ts.jsx(xe,{})}),ts.jsx(de.Item,{label:"描述",name:"desc",children:ts.jsx(Et,{})})]})},defaultProps:Pt},Vt={title:"输入框标题",placeholder:"请输入..."},{Paragraph:qt}=me,Tt={title:"输入框",type:"questionInput",Component:e=>{const{title:s,placeholder:t}={...Vt,...e};return ts.jsxs("div",{children:[ts.jsx(qt,{strong:!0,children:s}),ts.jsx("div",{children:ts.jsx(xe,{placeholder:t})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:i,disabled:r}=e,[l]=de.useForm();return s.useEffect((()=>{l.setFieldsValue({title:t,placeholder:n})}),[t,n]),ts.jsxs(de,{layout:"vertical",initialValues:{title:t,placeholder:n},form:l,onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,children:[ts.jsx(de.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:ts.jsx(xe,{})}),ts.jsx(de.Item,{label:"Placeholder",name:"placeholder",children:ts.jsx(xe,{})})]})},defaultProps:Vt},Rt={text:"一行段落",isCenter:!1},{Paragraph:zt}=me,{TextArea:Dt}=xe,At={title:"段落",type:"questionParagraph",Component:e=>{const{text:s="",isCenter:t=!1}={...Rt,...e},n=s.split("\n");return ts.jsx(zt,{style:{textAlign:t?"center":"start",marginBottom:"0"},children:n.map(((e,s)=>ts.jsxs("span",{children:[s>0&&ts.jsx("br",{}),e]},s)))})},PropComponent:e=>{const{text:t,isCenter:n,onChange:i,disabled:r}=e,[l]=de.useForm();return s.useEffect((()=>{l.setFieldsValue({text:t,isCenter:n})}),[t,n]),ts.jsxs(de,{layout:"vertical",initialValues:{text:t,isCenter:n},onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,form:l,children:[ts.jsx(de.Item,{label:"段落内容",name:"text",rules:[{required:!0,message:"请输入段落内容"}],children:ts.jsx(Dt,{})}),ts.jsx(de.Item,{name:"isCenter",valuePropName:"checked",children:ts.jsx(be,{children:"居中显示"})})]})},defaultProps:Rt},Ot={title:"单选标题",isVertical:!1,options:[{value:"item1",text:"选项1"},{value:"item2",text:"选项2"},{value:"item3",text:"选项3"}],value:""},{Paragraph:Ht}=me;const Bt={title:"单选",type:"questionRadio",Component:e=>{const{title:s,options:t=[],value:n,isVertical:i}={...Ot,...e};return ts.jsxs("div",{children:[ts.jsx(Ht,{strong:!0,children:s}),ts.jsx(Ce.Group,{value:n,children:ts.jsx(ie,{direction:i?"vertical":"horizontal",children:t.map((e=>{const{value:s,text:t}=e;return ts.jsx(Ce,{value:s,children:t},s)}))})})]})},PropComponent:e=>{const{title:t,isVertical:n,value:r,options:l=[],onChange:a,disabled:c}=e,[o]=de.useForm();return s.useEffect((()=>{o.setFieldsValue({title:t,isVertical:n,value:r,options:l})}),[t,n,r,l]),ts.jsxs(de,{layout:"vertical",initialValues:{title:t,isVertical:n,value:r,options:l},onValuesChange:function(){if(null==a)return;const e=o.getFieldsValue();e.options&&(e.options=e.options.filter((e=>!(null==e.text))));const{options:s=[]}=e;s.forEach((e=>{e.value||(e.value=hs(5))})),a(e)},disabled:c,form:o,children:[ts.jsx(de.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:ts.jsx(xe,{})}),ts.jsx(de.Item,{label:"选项",children:ts.jsx(de.List,{name:"options",children:(e,{add:s,remove:t})=>ts.jsxs(ts.Fragment,{children:[e.map((({key:e,name:s},n)=>ts.jsxs(ie,{align:"baseline",children:[ts.jsx(de.Item,{name:[s,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,s)=>{const{options:t=[]}=o.getFieldsValue();let n=0;return t.forEach((e=>{e.text===s&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:ts.jsx(xe,{placeholder:"输入选项文字..."})}),n>1&&ts.jsx(C,{onClick:()=>t(s)})]},e))),ts.jsx(de.Item,{children:ts.jsx(le,{type:"link",onClick:()=>s({text:"",value:""}),icon:ts.jsx(i,{}),block:!0,children:"添加选项"})})]})})}),ts.jsx(de.Item,{label:"默认选中",name:"value",children:ts.jsx(ke,{value:r,options:l.map((({text:e,value:s})=>({value:s,label:e||""})))})}),ts.jsx(de.Item,{name:"isVertical",valuePropName:"checked",children:ts.jsx(be,{children:"竖向排列"})})]})},defaultProps:Ot,StatComponent:({stat:e=[]})=>{const t=s.useMemo((()=>{let s=0;return e.forEach((e=>s+=e.count)),s}),[e]);return ts.jsx("div",{style:{width:"300px",height:"400px"},children:ts.jsx(Re,{width:"100%",height:"100%",children:ts.jsxs(Ke,{children:[ts.jsx(Me,{dataKey:"count",data:e,cx:"50%",cy:"50%",outerRadius:50,fill:"#8884d8",label:e=>"".concat(e.name,": ").concat((100*(e.count/t)).toFixed(2),"%"),children:e.map(((e,s)=>ts.jsx(Ue,{fill:Rs[s]},s)))}),ts.jsx(He,{})]})})})}},Kt={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Mt}=me,{TextArea:Ut}=xe,Wt={title:"多行输入",type:"questionTextarea",Component:e=>{const{title:s,placeholder:t}={...Kt,...e};return ts.jsxs("div",{children:[ts.jsx(Mt,{strong:!0,children:s}),ts.jsx("div",{children:ts.jsx(Ut,{placeholder:t})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:i,disabled:r}=e,[l]=de.useForm();return s.useEffect((()=>{l.setFieldsValue({title:t,placeholder:n})}),[t,n]),ts.jsxs(de,{layout:"vertical",initialValues:{title:t,placeholder:n},form:l,onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,children:[ts.jsx(de.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:ts.jsx(xe,{})}),ts.jsx(de.Item,{label:"Placeholder",name:"placeholder",children:ts.jsx(xe,{})})]})},defaultProps:Kt},Gt={text:"一级标题",level:1,isCenter:!1},{Title:$t}=me,Jt={title:"标题",type:"questionTitle",Component:e=>{const{text:s="",level:t=1,isCenter:n=!1}={...Gt,...e};return ts.jsx($t,{level:t,style:{textAlign:n?"center":"start",marginBottom:"0",fontSize:(i=t,1===i?"24px":2===i?"20px":"16px")},children:s});var i},PropComponent:e=>{const{text:t,level:n,isCenter:i,onChange:r,disabled:l}=e,[a]=de.useForm();return s.useEffect((()=>{a.setFieldsValue({text:t,level:n,isCenter:i})}),[t,n,i]),ts.jsxs(de,{form:a,layout:"vertical",onValuesChange:function(){r&&r(a.getFieldsValue())},initialValues:{text:t,level:n,isCenter:i},disabled:l,children:[ts.jsx(de.Item,{label:"标题内容",name:"text",rules:[{required:!0,message:"请输入标题内容"}],children:ts.jsx(xe,{})}),ts.jsx(de.Item,{label:"层级",name:"level",children:ts.jsx(ke,{options:[{value:1,text:1},{value:2,text:2},{value:3,text:3}]})}),ts.jsx(de.Item,{name:"isCenter",valuePropName:"checked",children:ts.jsx(be,{children:"居中显示"})})]})},defaultProps:Gt},Yt=[{groupId:"textGroup",groupName:"文本显示",components:[Lt,At,Jt]},{groupId:"inputGroup",groupName:"用户输入",components:[Tt,Wt]},{groupId:"chooseGroup",groupName:"用户选择",components:[St,Bt]}],Qt=[St,Lt,Tt,At,Bt,Wt,Jt];function Xt(e){return Qt.find((s=>s.type===e))}const{Title:Zt}=me,en=()=>ts.jsx(ts.Fragment,{children:Yt.map(((e,t)=>{const{groupId:n,groupName:i,components:r}=e;return ts.jsxs("div",{children:[ts.jsx(Zt,{level:3,style:{fontSize:"16px",marginTop:t>0?"20px":"0"},children:i}),ts.jsx("div",{children:r.map((e=>(e=>{const{title:t,type:n,Component:i,defaultProps:r}=e,l=T(),a=s.useCallback((()=>{l(ys({fe_id:hs(),title:t,type:n,props:r}))}),[]);return ts.jsx("div",{onClick:a,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:ts.jsx("div",{className:"pointer-events-none",children:ts.jsx(i,{})})},n)})(e)))})]},n)}))}),sn=e=>{const{children:s,items:t,onDragEnd:n}=e,i=F(E(q,{activationConstraint:{distance:8}}));return ts.jsx(L,{sensors:i,collisionDetection:V,onDragEnd:e=>{const{active:s,over:i}=e;if(null!=i&&s.id!==i.id){const e=t.findIndex((e=>e.fe_id===s.id)),r=t.findIndex((e=>e.fe_id===i.id));n(e,r)}},children:ts.jsx(K,{items:t,strategy:M,children:s})})},tn=({id:e,children:s})=>{const{attributes:t,listeners:n,setNodeRef:i,transform:r,transition:l}=U({id:e}),a={transform:We.Transform.toString(r),transition:l};return ts.jsx("div",{ref:i,style:a,...t,...n,children:s})},nn=()=>{const{componentList:e,selectedId:t}=Os(),n=T(),[i,r]=s.useState(""),l=e=>{const s=e.target.value.trim();s&&t&&n(_s({fe_id:t,title:s}))},a=e.map((e=>({...e,id:e.fe_id})));return ts.jsx(sn,{items:a,onDragEnd:(e,s)=>{n(Fs({oldIndex:e,newIndex:s}))},children:e.map((s=>{const{fe_id:a,title:c,isHidden:o,isLocked:d}=s,x=k({"flex-auto line-height-loose":!0,"color-blue":a===t}),m="opacity-20",p=k({[m]:o}),j=k({[m]:o});return ts.jsx(tn,{id:a,children:ts.jsxs("div",{className:"flex border-b border-b-green-200 border-b-solid py-2",children:[ts.jsxs("div",{className:x,onClick:()=>(s=>{const i=e.find((e=>e.fe_id===s));return i&&i.isHidden?re.info("不能选中隐藏的组件!"):s!==t?(n(vs(s)),void r("")):void r(s)})(a),children:[a===i&&ts.jsx(xe,{value:c,onChange:l,onPressEnter:()=>r(""),onBlur:()=>r("")}),a!==i&&c]}),ts.jsx("div",{className:"w-12 text-end",children:ts.jsxs(ie,{children:[ts.jsx(le,{size:"small",shape:"circle",className:p,icon:ts.jsx(u,{}),type:o?"primary":"text",onClick:()=>((e,s)=>{n(ks({fe_id:e,isHidden:s}))})(a,!o)}),ts.jsx(le,{size:"small",shape:"circle",className:j,icon:ts.jsx(h,{}),type:d?"primary":"text",onClick:()=>(e=>{n(ws({fe_id:e}))})(a)})]})})]})},a)}))})},rn=()=>{const e=[{key:"componentLib",label:ts.jsxs("span",{children:[ts.jsx(w,{}),"组件库"]}),children:ts.jsx(en,{})},{key:"layers",label:ts.jsxs("span",{children:[ts.jsx(r,{}),"图层"]}),children:ts.jsx(nn,{})}];return ts.jsx(ts.Fragment,{children:ts.jsx(we,{items:e,defaultActiveKey:"componentLib"})})},ln=({loading:e})=>{const{componentList:s,selectedIs:t}=Os(),n=T();if(function(){const e=T();Ee(["backspace","delete"],(()=>{As()&&e(Cs())})),Ee(["ctrl.c","meta.c"],(()=>{As()&&e(Is())})),Ee(["ctrl.v","meta.v"],(()=>{As()&&e(Ns())})),Ee("uparrow",(()=>{As()&&e(Ss())})),Ee("downarrow",(()=>{As()&&e(Ps())})),Ee(["ctrl.z","meta.z"],(()=>{As()&&e(J.undo())}),{exactMatch:!0}),Ee(["ctrl.shift.z","meta.shift.z"],(()=>{As()&&e(J.redo())}))}(),e)return ts.jsx("div",{className:"mt-6 text-center",children:ts.jsx(ce,{})});const i=e=>{const{type:s,props:t}=e,n=Xt(s);if(null==n)return null;const{Component:i}=n;return ts.jsx(i,{...t})},r=s.map((e=>({...e,id:e.fe_id})));return ts.jsx(sn,{items:r,onDragEnd:(e,s)=>{n(Fs({oldIndex:e,newIndex:s}))},children:ts.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:s.map((e=>{const{fe_id:s}=e,t=k({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return ts.jsx(tn,{id:s,children:ts.jsx("div",{className:t,onClick:e=>{return t=s,e.stopPropagation(),void n(vs(t));var t},children:ts.jsx("div",{className:"pointer-events-none",children:i(e)})})},s)}))})})},an=()=>ts.jsx("div",{className:"text-center",children:"未选中组件"}),cn=()=>{const e=T(),{selectedComponent:s}=Os();if(null==s)return ts.jsx(an,{});const{type:t,props:n}=s,i=Xt(t);if(null==i)return ts.jsx(an,{});const{PropComponent:r}=i;return ts.jsx(r,{...n,onChange:t=>{const{fe_id:n}=s;e(bs({fe_id:n,newProps:t}))}})},on=()=>{const e=Hs(),[s]=de.useForm(),t=T();return ts.jsxs(de,{layout:"vertical",initialValues:e,onValuesChange:()=>{t(ms(s.getFieldsValue()))},form:s,children:[ts.jsx(de.Item,{name:"title",label:"问卷标题",rules:[{required:!0,message:"请输入标题"}],children:ts.jsx(xe,{placeholder:"请输入标题"})}),ts.jsx(de.Item,{name:"desc",label:"问卷描述",children:ts.jsx(Ie,{placeholder:"问卷描述信息"})}),ts.jsx(de.Item,{name:"css",label:"样式代码",children:ts.jsx(Ie,{placeholder:"请输入 CSS 样式代码"})}),ts.jsx(de.Item,{name:"js",label:"脚本代码",children:ts.jsx(Ie,{placeholder:"请输入 JS 脚本代码"})})]})},dn=()=>{const[e,t]=s.useState("prop"),{selectedId:n}=Os();s.useEffect((()=>{t(n?"prop":"setting")}),[n]);const i=[{key:"prop",label:ts.jsxs("span",{children:[ts.jsx(I,{}),"属性"]}),children:ts.jsx(cn,{})},{key:"setting",label:ts.jsxs("span",{children:[ts.jsx(N,{}),"页面设置"]}),children:ts.jsx(on,{})}];return ts.jsx(we,{activeKey:e,items:i})},xn=()=>{const e=T(),{loading:s}=Gs(),{title:t}=Hs(),n=t?"问卷编辑 - ".concat(t):"问卷调查";qe(n);return ts.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[ts.jsx(wt,{}),ts.jsx("div",{className:"flex-1 py-3",children:ts.jsxs("div",{className:"mx-6 h-100% flex",children:[ts.jsx("div",{className:"w-75 bg-white px-3",children:ts.jsx(rn,{})}),ts.jsx("div",{className:"relative flex-1 overflow-hidden",onClick:()=>{e(vs(""))},children:ts.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:ts.jsx(ln,{loading:s})})}),ts.jsx("div",{className:"w-75 bg-white px-3",children:ts.jsx(dn,{})})]})})]})},mn=()=>ts.jsx("div",{className:"mt-15 text-center",children:ts.jsx(ce,{})}),un=()=>{const e=ee();return ts.jsx("div",{className:"flex-1",children:ts.jsx(ue,{status:"warning",title:"该页面尚未发布",extra:ts.jsx(le,{type:"primary",onClick:()=>e(-1),children:"返回"})})})},hn=()=>{const e=ee(),{title:t}=Hs(),{id:n}=Q(),i=s.useRef(null),r=s.useMemo((()=>{const e="http://localhost:5173/survey-sage/question/".concat(n),s=ts.jsx("div",{className:"text-center",children:ts.jsx(Se,{value:e||"-"})});return ts.jsxs(ie,{children:[ts.jsx(xe,{value:e,style:{width:"300px"},ref:i}),ts.jsx(ye,{title:"拷贝链接",children:ts.jsx(le,{icon:ts.jsx(x,{}),onClick:()=>{const s=i.current;if(null!=s){s.select();try{navigator.clipboard.writeText(e)}catch(t){}}}})}),ts.jsx(Ne,{content:s,children:ts.jsx(le,{icon:ts.jsx(S,{})})})]})}),[n]);return ts.jsx("div",{className:"border-coolGray border-b-solid bg-white py-3",children:ts.jsxs("div",{className:"mx-6 flex",children:[ts.jsx("div",{className:"flex-1",children:ts.jsxs(ie,{children:[ts.jsx(le,{type:"link",icon:ts.jsx(b,{}),onClick:()=>{e(-1)},children:"返回"}),ts.jsx("span",{className:"text-5 line-height-none",children:t})]})}),ts.jsx("div",{className:"flex-1 text-center",children:r}),ts.jsx("div",{className:"flex-1 text-right",children:ts.jsx(le,{type:"primary",onClick:()=>{e("/question/edit/".concat(n))},children:"编辑问卷"})})]})})},{Title:pn}=me,jn=()=>ts.jsx(ts.Fragment,{children:Yt.map(((e,t)=>{const{groupId:n,groupName:i,components:r}=e;return ts.jsxs("div",{children:[ts.jsx(pn,{level:3,style:{fontSize:"16px",marginTop:t>0?"20px":"0"},children:i}),ts.jsx("div",{children:r.map((e=>(e=>{const{title:t,type:n,Component:i,defaultProps:r}=e,l=T(),a=s.useCallback((()=>{l(ys({fe_id:H(),title:t,type:n,props:r}))}),[]);return ts.jsx("div",{onClick:a,className:"mb-3 cursor-pointer rounded border-solid bg-white p-3 hover:border-cyan",children:ts.jsx("div",{className:"pointer-events-none",children:ts.jsx(i,{})})},n)})(e)))})]},n)}))}),fn=()=>ts.jsx(ts.Fragment,{children:"ComponentLayer"}),gn=()=>{const e=[{key:"componentLib",label:ts.jsxs("span",{children:[ts.jsx(w,{}),"组件库"]}),children:ts.jsx(jn,{})},{key:"layers",label:ts.jsxs("span",{children:[ts.jsx(r,{}),"图层"]}),children:ts.jsx(fn,{})}];return ts.jsx(we,{defaultActiveKey:"componentLib",items:e})},vn=()=>ts.jsx(ts.Fragment,{children:"StatContainerCenter"}),yn=()=>{const[e,t]=s.useState("prop"),{selectedId:n}=Os();s.useEffect((()=>{t(n?"prop":"setting")}),[n]);const i=[{key:"prop",label:ts.jsxs("span",{children:[ts.jsx(I,{}),"属性"]}),children:ts.jsx("div",{children:"props"})},{key:"setting",label:ts.jsxs("span",{children:[ts.jsx(N,{}),"页面设置"]}),children:ts.jsx("div",{children:"PageSetting"})}];return ts.jsx(we,{activeKey:e,items:i})},bn=()=>ts.jsxs("div",{className:"mx-6 h-full flex",children:[ts.jsx("div",{className:"w-73 bg-white px-3",children:ts.jsx(gn,{})}),ts.jsx("div",{className:"relative flex-1 overflow-hidden",children:ts.jsx(vn,{})}),ts.jsx("div",{className:"w-75 bg-white px-3",children:ts.jsx(yn,{})})]}),Cn=()=>{const{loading:e,questionData:s}=Gs(),{title:t,isPubulished:n}=Hs();return qe("问卷调查 - ".concat(t)),n?ts.jsx(un,{}):ts.jsxs("div",{className:"min-h-screen flex flex-col bg-cyan",children:[ts.jsx(hn,{}),ts.jsxs("div",{className:"flex-1 py-3",children:[e&&ts.jsx(mn,{}),!e&&ts.jsx(bn,{})]})]})},{Title:kn,Paragraph:wn}=me,In=()=>{const e=ee();return ts.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:ts.jsxs("div",{className:"text-center",children:[ts.jsx(kn,{children:"问卷调查 | 在线投票"}),ts.jsx(wn,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),ts.jsx("div",{className:"h-15 font-24",children:ts.jsx(le,{className:"b-rounded-4",type:"primary",onClick:()=>e(qn),children:"开始使用"})})]})})},{Title:Nn}=me,Sn="USERNAME",Pn="PASSWORD";const _n=()=>{const e=ee(),t=T(),[n]=de.useForm();s.useEffect((()=>{const{username:e,password:s}={username:localStorage.getItem(Sn),password:localStorage.getItem(Pn)};n.setFieldsValue({username:e,password:s})}),[]);const{run:i}=Le((async(e,s)=>{const n=await async function(e,s){const t={username:e,password:s};return await zs.post("/api/user/login",t)}(e,s);return n.token&&t(cs({username:e,nickname:e})),n}),{manual:!0,onSuccess(s){const{token:t=""}=s;!function(e){localStorage.setItem(Ds,e)}(t),re.success("登录成功"),e(qn)}});return ts.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[ts.jsx("div",{children:ts.jsxs(ie,{children:[ts.jsx(Nn,{level:2,children:ts.jsx(c,{})}),ts.jsx(Nn,{level:2,children:"登录"})]})}),ts.jsx("div",{children:ts.jsxs(de,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{const{username:s,password:t,remember:n}=e||{};i(s,t),n?function(e,s){localStorage.setItem(Sn,e),localStorage.setItem(Pn,s)}(s,t):(localStorage.removeItem(Sn),localStorage.removeItem(Pn))},children:[ts.jsx(de.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:ts.jsx(xe,{})}),ts.jsx(de.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:ts.jsx(xe.Password,{})}),ts.jsx(de.Item,{name:"remember",valuePropName:"checked",wrapperCol:{offset:0,span:10},children:ts.jsx(be,{children:"记住我"})}),ts.jsx(de.Item,{wrapperCol:{offset:4,span:18},children:ts.jsxs(ie,{children:[ts.jsx(le,{type:"primary",htmlType:"submit",children:"登录"}),ts.jsx(Y,{to:Vn,children:"注册新用户"})]})})]})})]})},Fn=te([{path:"/",element:ts.jsx(st,{}),children:[{path:"/",element:ts.jsx(In,{})},{path:"login",element:ts.jsx(_n,{})},{path:"register",element:ts.jsx(rt,{})},{path:"manage",element:ts.jsx(tt,{}),children:[{path:"list",element:ts.jsx(mt,{})},{path:"star",element:ts.jsx(gt,{})},{path:"trash",element:ts.jsx(jt,{})}]},{path:"*",element:ts.jsx(lt,{})}]},{path:"question",element:ts.jsx(nt,{}),children:[{path:"edit/:id",element:ts.jsx(xn,{})},{path:"stat/:id",element:ts.jsx(Cn,{})}]}],{basename:"/survey-sage"}),En="/",Ln="/login",Vn="/register",qn="/manage/list";const Tn=()=>ts.jsx(Pe,{theme:{algorithm:_e.defaultAlgorithm},children:ts.jsx(ne,{router:Fn})});ns.createRoot(document.getElementById("root")).render(ts.jsx(P.StrictMode,{children:ts.jsx(z,{store:Es,children:ts.jsx(Tn,{})})}));export{e as __vite_legacy_guard};
