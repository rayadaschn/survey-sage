System.register(["./index-legacy-95335f36.js","./react-redux-legacy-ae375a2f.js","./ahooks-legacy-d8b4bfed.js","./index-legacy-2f866b2e.js","./@ant-design/icons-legacy-3b08bf95.js","./redux-undo-legacy-f3ba457c.js","./antd-legacy-dca60dc3.js","./react-router-dom-legacy-4de26926.js","./@dnd-kit/core-legacy-21272773.js","./@dnd-kit/sortable-legacy-67e03475.js","./@dnd-kit/utilities-legacy-ded65fa0.js","./@reduxjs/toolkit-legacy-00116e75.js","./lodash-es-legacy-e3523841.js","./axios-legacy-787fab56.js","./recharts-legacy-da0924fe.js"],(function(e,s){"use strict";var n,i,t,l,r,c,d,o,a,x,j,h,m,p,u,f,g,v,b,y,k,C,N,w,I,_,L,S,z,E,D,P,F,H,M,T,q,B,K,V,J,A,O,R,W,$,G,Q,U,X,Y,Z,ee,se,ne,ie,te,le,re,ce,de,oe,ae,xe,je,he,me;return{setters:[e=>{n=e.r,i=e.c,t=e.p,l=e.s,r=e.a,c=e.j,d=e.b,o=e.t,a=e.m,x=e.d,j=e.u,h=e.e,m=e.n,p=e.f,u=e.g,f=e.h,g=e.i},e=>{v=e.a},e=>{b=e.I,y=e.F,k=e.J,C=e.H},e=>{N=e.u,w=e.a,I=e.c,_=e.g,L=e.b},e=>{S=e.ai,z=e.W,E=e.am,D=e.ae,P=e.an,F=e.ao,H=e.K,M=e.ap,T=e.aq,q=e.r,B=e.ad,K=e.L,V=e.O,J=e.z,A=e.ar,O=e.M,R=e.as,W=e.at},e=>{$=e.M},e=>{G=e.S,Q=e.f,U=e.B,X=e.I,Y=e.m,Z=e.T,ee=e.g,se=e.a,ne=e.F,ie=e.h},e=>{te=e.d,le=e.b},e=>{re=e.d,ce=e.e,de=e.D,oe=e.f,ae=e.M},e=>{xe=e.S,je=e.v,he=e.u},e=>{me=e.C},null,null,null,null],execute:function(){const s=()=>document.activeElement===document.body,pe=()=>{const e=v(),{selectedId:s,componentList:l,selectedComponent:r,copiedComponent:x}=N(),j=l.findIndex((e=>e.fe_id===s)),h=j<=0,m=j+1>=l.length,p=r?.isLocked?"primary":"default",u=[{title:"删除",shape:"circle",icon:c.jsx(S,{}),onClick:()=>{e(n())}},{title:"隐藏",shape:"circle",icon:c.jsx(z,{}),onClick:()=>{e(d({fe_id:s,isHidden:!0}))}},{title:"锁定",type:p,shape:"circle",icon:c.jsx(E,{}),onClick:()=>{e(o({fe_id:s}))}},{title:"复制",shape:"circle",icon:c.jsx(D,{}),onClick:()=>{e(i())}},{title:"粘贴",shape:"circle",icon:c.jsx(P,{}),onClick:()=>{e(t())},disabled:null==x},{title:"上移",shape:"circle",icon:c.jsx(F,{}),onClick:()=>{h||e(a({oldIndex:j,newIndex:j-1}))},disabled:h},{title:"下移",shape:"circle",icon:c.jsx(H,{}),onClick:()=>{m||e(a({oldIndex:j,newIndex:j+1}))},disabled:m},{title:"撤销",shape:"circle",icon:c.jsx(M,{}),onClick:()=>{e($.undo())}},{title:"重做",shape:"circle",icon:c.jsx(T,{}),onClick:()=>{e($.redo())}}];return c.jsx(G,{children:u.map((e=>{const{title:s,type:n,shape:i,icon:t,onClick:l,disabled:r}=e;return c.jsx(Q,{title:s,children:c.jsx(U,{type:n,shape:i,icon:t,onClick:l,disabled:r})},s)}))})},ue=()=>{const{title:e}=w(),s=v(),[n,i]=q.useState(!1),t=e=>{const n=e.target.value.trim();n&&s(x(n))};return n?c.jsx(X,{value:e,onChange:t,onPressEnter:()=>i(!1),onBlur:()=>i(!1)}):c.jsxs(G,{children:[c.jsx("div",{children:e}),c.jsx(U,{icon:c.jsx(B,{}),type:"text",onClick:()=>i(!0)})]})},fe=()=>{const{id:e}=te(),{componentList:s=[]}=N(),n=w(),{loading:i,run:t}=y((async()=>{e&&await j(e,{...n,componentList:s})}),{manual:!0});return b(["ctrl.s","meta.s"],(e=>{e.preventDefault(),i||t()})),k((()=>{t()}),[s,n],{wait:1e3}),c.jsx(U,{onClick:t,disabled:i,icon:i?c.jsx(K,{}):null,children:"保存"})},ge=()=>{const e=le(),{id:s}=te(),{componentList:n=[]}=N(),i=w(),{loading:t,run:l}=y((async()=>{s&&await j(s,{...i,componentList:n,isPublished:!0})}),{manual:!0,onSuccess(){Y.success("发布成功"),e("/question/stat/"+s)}});return c.jsx(U,{type:"primary",onClick:l,disabled:t,icon:t?c.jsx(K,{}):null,children:"发布"})},ve=()=>c.jsxs(G,{children:[c.jsx(fe,{}),c.jsx(ge,{})]}),be=()=>{const e=le();return c.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[c.jsx("div",{className:"flex-1",children:c.jsxs(G,{children:[c.jsx(U,{type:"link",icon:c.jsx(V,{}),onClick:()=>e(-1),children:"返回"}),c.jsx("div",{className:"mb-0 text-[18px] leading-none",children:c.jsx(ue,{})})]})}),c.jsx("div",{className:"flex-1 text-center leading-[2]",children:c.jsx(pe,{})}),c.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:c.jsx(ve,{})})]})},{Title:ye}=Z,ke=()=>c.jsx(c.Fragment,{children:I.map(((e,s)=>{const{groupId:n,groupName:i,components:t}=e;return c.jsxs("div",{children:[c.jsx(ye,{level:3,style:{fontSize:"16px",marginTop:s>0?"20px":"0"},children:i}),c.jsx("div",{children:t.map((e=>(e=>{const{title:s,type:n,Component:i,defaultProps:t}=e,l=v(),r=q.useCallback((()=>{l(h({fe_id:m(),title:s,type:n,props:t}))}),[]);return c.jsx("div",{onClick:r,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:c.jsx("div",{className:"pointer-events-none",children:c.jsx(i,{})})},n)})(e)))})]},n)}))}),Ce=e=>{const{children:s,items:n,onDragEnd:i}=e,t=re(ce(ae,{activationConstraint:{distance:8}}));return c.jsx(de,{sensors:t,collisionDetection:oe,onDragEnd:e=>{const{active:s,over:t}=e;if(null!=t&&s.id!==t.id){const e=n.findIndex((e=>e.fe_id===s.id)),l=n.findIndex((e=>e.fe_id===t.id));i(e,l)}},children:c.jsx(xe,{items:n,strategy:je,children:s})})},Ne=({id:e,children:s})=>{const{attributes:n,listeners:i,setNodeRef:t,transform:l,transition:r}=he({id:e}),d={transform:me.Transform.toString(l),transition:r};return c.jsx("div",{ref:t,style:d,...n,...i,children:s})},we=()=>{const{componentList:e,selectedId:s}=N(),n=v(),[i,t]=q.useState(""),l=e=>{const i=e.target.value.trim();i&&s&&n(u({fe_id:s,title:i}))},r=e.map((e=>({...e,id:e.fe_id})));return c.jsx(Ce,{items:r,onDragEnd:(e,s)=>{n(a({oldIndex:e,newIndex:s}))},children:e.map((r=>{const{fe_id:a,title:x,isHidden:j,isLocked:h}=r,m=J({"flex-auto line-height-loose":!0,"color-blue":a===s}),u="opacity-20",f=J({[u]:j}),g=J({[u]:j});return c.jsx(Ne,{id:a,children:c.jsxs("div",{className:"flex border-b border-b-green-200 border-b-solid py-2",children:[c.jsxs("div",{className:m,onClick:()=>(i=>{const l=e.find((e=>e.fe_id===i));return l&&l.isHidden?Y.info("不能选中隐藏的组件!"):i!==s?(n(p(i)),void t("")):void t(i)})(a),children:[a===i&&c.jsx(X,{value:x,onChange:l,onPressEnter:()=>t(""),onBlur:()=>t("")}),a!==i&&x]}),c.jsx("div",{className:"w-12 text-end",children:c.jsxs(G,{children:[c.jsx(U,{size:"small",shape:"circle",className:f,icon:c.jsx(z,{}),type:j?"primary":"text",onClick:()=>((e,s)=>{n(d({fe_id:e,isHidden:s}))})(a,!j)}),c.jsx(U,{size:"small",shape:"circle",className:g,icon:c.jsx(E,{}),type:h?"primary":"text",onClick:()=>(e=>{n(o({fe_id:e}))})(a)})]})})]})},a)}))})},Ie=()=>{const e=[{key:"componentLib",label:c.jsxs("span",{children:[c.jsx(A,{}),"组件库"]}),children:c.jsx(ke,{})},{key:"layers",label:c.jsxs("span",{children:[c.jsx(O,{}),"图层"]}),children:c.jsx(we,{})}];return c.jsx(c.Fragment,{children:c.jsx(ee,{items:e,defaultActiveKey:"componentLib"})})},_e=({loading:e})=>{const{componentList:d,selectedIs:o}=N(),x=v();if(function(){const e=v();b(["backspace","delete"],(()=>{s()&&e(n())})),b(["ctrl.c","meta.c"],(()=>{s()&&e(i())})),b(["ctrl.v","meta.v"],(()=>{s()&&e(t())})),b("uparrow",(()=>{s()&&e(l())})),b("downarrow",(()=>{s()&&e(r())})),b(["ctrl.z","meta.z"],(()=>{s()&&e($.undo())}),{exactMatch:!0}),b(["ctrl.shift.z","meta.shift.z"],(()=>{s()&&e($.redo())}))}(),e)return c.jsx("div",{className:"mt-6 text-center",children:c.jsx(se,{})});const j=e=>{const{type:s,props:n}=e,i=_(s);if(null==i)return null;const{Component:t}=i;return c.jsx(t,{...n})},h=d.map((e=>({...e,id:e.fe_id})));return c.jsx(Ce,{items:h,onDragEnd:(e,s)=>{x(a({oldIndex:e,newIndex:s}))},children:c.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:d.map((e=>{const{fe_id:s}=e,n=J({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return c.jsx(Ne,{id:s,children:c.jsx("div",{className:n,onClick:e=>{return n=s,e.stopPropagation(),void x(p(n));var n},children:c.jsx("div",{className:"pointer-events-none",children:j(e)})})},s)}))})})},Le=()=>c.jsx("div",{className:"text-center",children:"未选中组件"}),Se=()=>{const e=v(),{selectedComponent:s}=N();if(null==s)return c.jsx(Le,{});const{type:n,props:i}=s,t=_(n);if(null==t)return c.jsx(Le,{});const{PropComponent:l}=t;return c.jsx(l,{...i,onChange:n=>{const{fe_id:i}=s;e(f({fe_id:i,newProps:n}))}})},ze=()=>{const e=w(),[s]=ne.useForm(),n=v();return c.jsxs(ne,{layout:"vertical",initialValues:e,onValuesChange:()=>{n(g(s.getFieldsValue()))},form:s,children:[c.jsx(ne.Item,{name:"title",label:"问卷标题",rules:[{required:!0,message:"请输入标题"}],children:c.jsx(X,{placeholder:"请输入标题"})}),c.jsx(ne.Item,{name:"desc",label:"问卷描述",children:c.jsx(ie,{placeholder:"问卷描述信息"})}),c.jsx(ne.Item,{name:"css",label:"样式代码",children:c.jsx(ie,{placeholder:"请输入 CSS 样式代码"})}),c.jsx(ne.Item,{name:"js",label:"脚本代码",children:c.jsx(ie,{placeholder:"请输入 JS 脚本代码"})})]})},Ee=()=>{const[e,s]=q.useState("prop"),{selectedId:n}=N();q.useEffect((()=>{s(n?"prop":"setting")}),[n]);const i=[{key:"prop",label:c.jsxs("span",{children:[c.jsx(R,{}),"属性"]}),children:c.jsx(Se,{})},{key:"setting",label:c.jsxs("span",{children:[c.jsx(W,{}),"页面设置"]}),children:c.jsx(ze,{})}];return c.jsx(ee,{activeKey:e,items:i})};e("default",(()=>{const e=v(),{loading:s}=L(),{title:n}=w();return C(n?`问卷编辑 - ${n}`:"问卷调查"),c.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[c.jsx(be,{}),c.jsx("div",{className:"flex-1 py-3",children:c.jsxs("div",{className:"mx-6 h-100% flex",children:[c.jsx("div",{className:"w-75 bg-white px-3",children:c.jsx(Ie,{})}),c.jsx("div",{className:"relative flex-1 overflow-hidden",onClick:()=>{e(p(""))},children:c.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:c.jsx(_e,{loading:s})})}),c.jsx("div",{className:"w-75 bg-white px-3",children:c.jsx(Ee,{})})]})})]})}))}}}));
