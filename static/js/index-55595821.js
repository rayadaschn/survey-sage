import{k as e,j as s,S as t}from"./index-8dfea021.js";import"./react-redux-f2c040a7.js";import{F as n,H as i}from"./ahooks-4a9cec88.js";import{a as r,u as a,g as o,b as l}from"./index-b0f351a5.js";import{r as c,ae as d,au as x,O as p,z as m}from"./@ant-design/icons-8d84517b.js";import{a as j,R as u,B as h,S as f,I as v,f as y,i as g,Q as C,T as S,d as b,c as N}from"./antd-41055c6a.js";import{b as w,d as k}from"./react-router-dom-68488153.js";import"./@dnd-kit/core-0365c8c8.js";import"./@dnd-kit/utilities-cf8ac1fd.js";import"./@reduxjs/toolkit-ecf8b8f6.js";import"./@dnd-kit/sortable-bbe48c8b.js";import"./lodash-es-34fbd7b9.js";import"./redux-undo-58253284.js";import"./axios-83bdef92.js";import"./recharts-62b39eab.js";const I=()=>s.jsx("div",{className:"mt-15 text-center",children:s.jsx(j,{})}),T=()=>{const e=w();return s.jsx("div",{className:"flex-1",children:s.jsx(u,{status:"warning",title:"该页面尚未发布",extra:s.jsx(h,{type:"primary",onClick:()=>e(-1),children:"返回"})})})},z=()=>{const e=w(),{title:t}=r(),{id:n}=k(),i=c.useRef(null),a=c.useMemo((()=>{const e="http://localhost:5173/survey-sage/question/".concat(n),t=s.jsx("div",{className:"text-center",children:s.jsx(C,{value:e||"-"})});return s.jsxs(f,{children:[s.jsx(v,{value:e,style:{width:"300px"},ref:i}),s.jsx(y,{title:"拷贝链接",children:s.jsx(h,{icon:s.jsx(d,{}),onClick:()=>{const s=i.current;if(null!=s){s.select();try{navigator.clipboard.writeText(e)}catch(t){}}}})}),s.jsx(g,{content:t,children:s.jsx(h,{icon:s.jsx(x,{})})})]})}),[n]);return s.jsx("div",{className:"border-coolGray border-b-solid bg-white py-3",children:s.jsxs("div",{className:"mx-6 flex",children:[s.jsx("div",{className:"flex-1",children:s.jsxs(f,{children:[s.jsx(h,{type:"link",icon:s.jsx(p,{}),onClick:()=>{e(-1)},children:"返回"}),s.jsx("span",{className:"text-5 line-height-none",children:t})]})}),s.jsx("div",{className:"flex-1 text-center",children:a}),s.jsx("div",{className:"flex-1 text-right",children:s.jsx(h,{type:"primary",onClick:()=>{e("/question/edit/".concat(n))},children:"编辑问卷"})})]})})},q=e=>{const{selectedComponentId:t,setSelectedComponentId:n,setSelectedComponentType:i}=e,{componentList:r}=a();return s.jsx("div",{className:"min-h-full overflow-y-auto bg-white",children:r.filter((e=>!e.isHidden)).map((e=>{const{fe_id:r,props:a,type:l}=e,c=o(l);if(null==c)return null;const{Component:d}=c,x=m({"m-3 border-solid border-white px-2 py-3 b-rounded hover:border-blueGray":!0,"border-gray":r===t});return s.jsx("div",{className:x,onClick:()=>{n(r),i(l)},children:s.jsx("div",{className:"pointer-events-none opacity-[0.8]",children:s.jsx(d,{...a})})},r)}))})},{Title:F}=S,_=i=>{const{selectedComponentId:r,setSelectedComponentId:o,setSelectedComponentType:l}=i,{id:d=""}=k(),[x,p]=c.useState(1),[m,u]=c.useState(t),[h,f]=c.useState(0),[v,y]=c.useState([]),{loading:g}=n((async()=>await async function(s,t){const n="/api/stat/".concat(s);return await e.get(n,{params:t})}(d,{page:x,pageSize:m})),{refreshDeps:[d,x,m],onSuccess(e){const{total:s,list:t=[]}=e;f(s),y(t)}}),{componentList:C}=a(),S=C.map((e=>{const{fe_id:t,title:n,props:i={},type:a}=e,c=i.title||n;return{title:s.jsx("div",{style:{cursor:"pointer"},onClick:()=>{o(t),l(a)},children:s.jsx("span",{style:{color:t===r?"#1890ff":"inherit"},children:c})}),dataIndex:t}})),w=v.map((e=>({...e,key:e._id}))),I=s.jsxs(s.Fragment,{children:[s.jsx(b,{columns:S,dataSource:w,pagination:!1}),s.jsx("div",{style:{textAlign:"center",marginTop:"18px"},children:s.jsx(N,{total:h,pageSize:m,current:x,onChange:e=>p(e),onShowSizeChange:(e,s)=>{p(e),u(s)}})})]});return s.jsxs("div",{children:[s.jsxs(F,{level:3,children:["答卷数量: ",!g&&h]}),g&&s.jsx("div",{style:{textAlign:"center"},children:s.jsx(j,{})}),!g&&I]})},{Title:A}=S,D=t=>{const{selectedComponentId:i,selectedComponentType:r}=t,{id:a=""}=k(),[l,d]=c.useState([]),{run:x}=n((async(s,t)=>await async function(s,t){const n="/api/stat/".concat(s,"/").concat(t);return await e.get(n)}(s,t)),{manual:!0,onSuccess(e){d(e.stat)}});c.useEffect((()=>{i&&x(a,i)}),[a,i]);return s.jsxs(s.Fragment,{children:[s.jsx(A,{level:3,children:"图表统计"}),s.jsx("div",{children:(()=>{if(!i)return s.jsx("div",{children:"暂未选中组件"});const{StatComponent:e}=o(r)||{};return null==e?s.jsx("div",{children:"该组件暂无统计图表"}):s.jsx(e,{stat:l})})()})]})},G=()=>{const[e,t]=c.useState(""),[n,i]=c.useState("");return s.jsxs("div",{className:"mx-6 h-full flex",children:[s.jsx("div",{className:"w-73 bg-white px-3",children:s.jsx(q,{selectedComponentId:e,setSelectedComponentId:t,setSelectedComponentType:i})}),s.jsx("div",{className:"relative mx-3 flex-1 overflow-hidden",children:s.jsx(_,{selectedComponentId:e,setSelectedComponentId:t,setSelectedComponentType:i})}),s.jsx("div",{className:"w-75 bg-white px-3",children:s.jsx(D,{selectedComponentId:e,selectedComponentType:n})})]})},H=()=>{const{loading:e,questionData:t}=l(),{title:n,isPubulished:a}=r();return i("问卷调查 - ".concat(n)),a?s.jsx(T,{}):s.jsxs("div",{className:"min-h-screen flex flex-col bg-cyan",children:[s.jsx(z,{}),s.jsxs("div",{className:"flex-1 py-3",children:[e&&s.jsx(I,{}),!e&&s.jsx(G,{})]})]})};export{H as default};
