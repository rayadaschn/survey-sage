function e(){import.meta.url,import("_").catch((()=>1))}import{r as s,af as t,ag as n,U as i,M as r,ah as l,ai as a,aj as c,ad as o,ak as d,ae as x,al as m,W as u,am as h,an as p,ao as j,K as f,ap as g,aq as v,L as y,O as C,ar as b,z as k,as as w,at as I,au as N,av as S,R as P}from"./@ant-design/icons-74a3c655.js";import{r as _,d as F,e as E,D as L,f as V,M as q}from"./@dnd-kit/core-d69b4d30.js";import{u as T,a as R,P as z}from"./react-redux-70fabaf9.js";import{c as D,p as A,a as O}from"./@reduxjs/toolkit-9493dcd7.js";import{a as H,S as B,v as M,u as U}from"./@dnd-kit/sortable-97301ac0.js";import{c as K}from"./lodash-es-34fbd7b9.js";import{C as W,D as G,M as $}from"./redux-undo-58253284.js";import{L as J,u as Y,a as Q,b as X,c as Z,O as ee,d as se,R as te}from"./react-router-dom-a5073cc0.js";import{S as ne,m as ie,B as re,L as le,a as ae,D as ce,F as oe,I as de,T as xe,R as me,b as ue,P as he,M as pe,E as je,c as fe,d as ge,e as ve,C as ye,f as Ce,g as be,h as ke,i as we,j as Ie,Q as Ne,k as Se,t as Pe}from"./antd-4dd5c312.js";import{a as _e}from"./axios-83bdef92.js";import{F as Fe,G as Ee,H as Le,I as Ve,J as qe}from"./ahooks-d1ed29b4.js";import{R as Te,B as Re,C as ze,X as De,Y as Ae,T as Oe,a as He,P as Be,b as Me,c as Ue}from"./recharts-cc46d28e.js";import{C as Ke}from"./@dnd-kit/utilities-456bb9d8.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var We={exports:{}},Ge={},$e=s,Je=Symbol.for("react.element"),Ye=Symbol.for("react.fragment"),Qe=Object.prototype.hasOwnProperty,Xe=$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ze={key:!0,ref:!0,__self:!0,__source:!0};function es(e,s,t){var n,i={},r=null,l=null;for(n in void 0!==t&&(r=""+t),void 0!==s.key&&(r=""+s.key),void 0!==s.ref&&(l=s.ref),s)Qe.call(s,n)&&!Ze.hasOwnProperty(n)&&(i[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===i[n]&&(i[n]=s[n]);return{$$typeof:Je,type:e,key:r,ref:l,props:i,_owner:Xe.current}}Ge.Fragment=Ye,Ge.jsx=es,Ge.jsxs=es,We.exports=Ge;var ss=We.exports;var ts={},ns=_;ts.createRoot=ns.createRoot,ts.hydrateRoot=ns.hydrateRoot;const is={username:"",nickname:""},rs=D({name:"user",initialState:is,reducers:{loginReducer:(e,s)=>s.payload,logoutReducer:()=>is}}),ls=rs.reducer,{loginReducer:as,logoutReducer:cs}=rs.actions,os=D({name:"pageInfo",initialState:{title:"",desc:"",js:"",css:""},reducers:{resetPageInfo:(e,s)=>s.payload,changePageTitle:A(((e,s)=>{e.title=s.payload}))}}),ds=os.reducer,{resetPageInfo:xs,changePageTitle:ms}=os.actions;let us=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,s)=>e+=(s&=63)<36?s.toString(36):s<62?(s-26).toString(36).toUpperCase():s>62?"-":"_"),"");function hs(e,s){const t=s.filter((e=>!e.isHidden)),n=t.findIndex((s=>s.fe_id===e));if(n<0)return"";let i="";const r=t.length;return i=r<=1?"":n+1===r?t[n-1].fe_id:t[n+1].fe_id,i}function ps(e,s){const{selectedId:t,componentList:n}=e,i=n.findIndex((e=>e.fe_id===t));i<0?e.componentList.push(s):e.componentList.splice(i+1,0,s),e.selectedId=s.fe_id}const js=D({name:"components",initialState:{componentList:[],selectedId:"",copiedComponent:null},reducers:{resetComponents:(e,s)=>s.payload,changeSelectedId:A(((e,s)=>{e.selectedId=s.payload})),addComponent:A(((e,s)=>{ps(e,s.payload)})),changeComponentProps:A(((e,s)=>{const{fe_id:t,newProps:n}=s.payload,i=e.componentList.find((e=>e.fe_id===t));i&&(i.props={...i.props,...n})})),removeSelectedComponent:A((e=>{const{componentList:s=[],selectedId:t}=e,n=hs(t,s);e.selectedId=n;const i=s.findIndex((e=>e.fe_id===t));s.splice(i,1)})),changeComponentHidden:A(((e,s)=>{const{componentList:t=[]}=e,{fe_id:n,isHidden:i}=s.payload;let r="";r=i?hs(n,t):n,e.selectedId=r;const l=t.find((e=>e.fe_id===n));l&&(l.isHidden=i)})),toggleComponentLocked:A(((e,s)=>{const{fe_id:t}=s.payload,n=e.componentList.find((e=>e.fe_id===t));n&&(n.isLocked=!n.isLocked)})),copySelectedComponent:A((e=>{const{selectedId:s,componentList:t=[]}=e,n=t.find((e=>e.fe_id===s));null!=n&&(e.copiedComponent=K(n))})),pasteCopiedComponent:A((e=>{const{copiedComponent:s}=e;null!=s&&(s.fe_id=us(),ps(e,s))})),selectPrevComponent:A((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n<=0||(e.selectedId=t[n-1].fe_id)})),selectNextComponent:A((e=>{const{selectedId:s,componentList:t}=e,n=t.findIndex((e=>e.fe_id===s));n<0||n+1!==t.length&&(e.selectedId=t[n+1].fe_id)})),changeComponentTitle:A(((e,s)=>{const{title:t,fe_id:n}=s.payload,i=e.componentList.find((e=>e.fe_id===n));i&&(i.title=t)})),moveComponent:A(((e,s)=>{const{componentList:t}=e,{oldIndex:n,newIndex:i}=s.payload;e.componentList=H(t,n,i)}))}}),{resetComponents:fs,changeSelectedId:gs,addComponent:vs,changeComponentProps:ys,removeSelectedComponent:Cs,changeComponentHidden:bs,toggleComponentLocked:ks,copySelectedComponent:ws,pasteCopiedComponent:Is,selectPrevComponent:Ns,selectNextComponent:Ss,changeComponentTitle:Ps,moveComponent:_s}=js.actions,Fs=O({reducer:{user:ls,pageInfo:ds,components:W(js.reducer,{limit:20,filter:G(["components/resetComponents","components/changeSelectedId","components/selectPrevComponent","components/selectNextComponent"])})}}),Es=()=>ss.jsx("div",{children:ss.jsx(J,{to:"/",children:ss.jsx(ne,{children:ss.jsxs("div",{className:"text-7 color-white",children:[ss.jsx(t,{}),ss.jsx("span",{children:"问卷调查"})]})})})}),Ls="keyword",Vs="page",qs="pageSize",Ts=["#FF2D2D","#BE77FF","#2894FF","#00EC00","#EAC100","#FF9D6F"],Rs=_e.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});Rs.interceptors.request.use((e=>(e.headers.Authorization="Bearer ".concat(localStorage.getItem(zs)||""),e)),(e=>(ie.error(e.message),Promise.reject(e)))),Rs.interceptors.response.use((e=>{const s=e.data||{},{errno:t,data:n,msg:i}=s;return 203===t||0!==t&&200!==t?(ie.error(i||"请求失败"),Promise.reject(n)):n}),(e=>{var s;let t="";switch(null==(s=e.response)?void 0:s.status){case 401:t="token 失效，请重新登录";break;case 403:t="拒绝访问";break;case 404:t="请求地址错误";break;case 500:t="服务器故障";break;default:t="网络连接故障"}return ie.error(t),Promise.reject(e)}));const zs="USER_TOKEN";const Ds=()=>document.activeElement===document.body;function As(){const e=R((e=>e.components.present)),{componentList:s=[],selectedId:t,copiedComponent:n}=e,i=s.find((e=>e.fe_id===t));return{componentList:s,selectedId:t,selectedComponent:i,copiedComponent:n}}function Os(){return R((e=>e.pageInfo))}function Hs(){const{username:e,nickname:s}=R((e=>e.user));return{username:e,nickname:s}}async function Bs(){return await Rs.post("/api/question/")}async function Ms(e={}){return await Rs.get("/api/question",{params:e})}async function Us(e,s){const t="/api/question/".concat(e);return await Rs.patch(t,s)}async function Ks(){return await Rs.get("/api/user/info")}function Ws(){const{id:e=""}=Y(),t=T(),{data:n,loading:i,error:r,run:l}=Ee((async e=>{if(!e)throw new Error("缺少问卷 id");const s=await async function(e){const s="/api/question/".concat(e);return await Rs.get(s)}(e);return s}),{manual:!0});return s.useEffect((()=>{if(!n)return;const{title:e="",desc:s="",js:i="",css:r="",componentList:l=[]}=n;let a="";l.length>0&&(a=l[0].fe_id),t(fs({componentList:l,selectedId:a,copiedComponent:null})),t(xs({title:e,desc:s,js:i,css:r}))}),[n]),s.useEffect((()=>{l(e)}),[e]),{loading:i,error:r}}function Gs(e={}){const{isStar:s,isDeleted:t}=e,[n]=Q(),{data:i,loading:r,error:l,refresh:a}=Ee((async()=>{const e=n.get(Ls)||"",i=parseInt(n.get(Vs)||"")||1,r=parseInt(n.get(qs)||"")||10;return await Ms({keyword:e,isStar:s,isDeleted:t,page:i,pageSize:r})}),{refreshDeps:[n]});return{data:i,loading:r,error:l,refresh:a}}function $s(){const e=T(),[t,n]=s.useState(!0),{run:i}=Ee(Ks,{manual:!0,onSuccess(s){const{username:t,nickname:n}=s;e(as({username:t,nickname:n}))},onFinally(){n(!1)}}),{username:r}=Hs();return s.useEffect((()=>{r?n(!1):i()}),[t]),{waitingUserData:t}}function Js(e){const{username:t}=Hs(),{pathname:n}=X(),i=Z();s.useEffect((()=>{e||(t?function(e){return[In,Nn].includes(e)}(n)&&i(Sn):function(e){return[wn,In,Nn].includes(e)}(n)||i(In))}),[e,t,n])}const Ys=()=>{const e=Z(),s=T(),{username:t,nickname:i}=Hs();const r=ss.jsxs(ss.Fragment,{children:[ss.jsxs("span",{className:"color-light",children:[ss.jsx(n,{}),i]}),ss.jsx(re,{type:"link",onClick:function(){s(cs()),localStorage.removeItem(zs),ie.success("退出成功"),e(In)},children:"退出"})]}),l=ss.jsx(J,{to:In,children:"登录"});return ss.jsx(ss.Fragment,{children:t?r:l})},{Header:Qs,Content:Xs,Footer:Zs}=le,et=()=>{const{waitingUserData:e}=$s();return Js(e),ss.jsxs(le,{children:[ss.jsxs(Qs,{className:"px-6",children:[ss.jsx("div",{className:"float-left",children:ss.jsx(Es,{})}),"MainLayout header",ss.jsx("div",{className:"float-right",children:ss.jsx(Ys,{})})]}),ss.jsx(Xs,{className:"min-h-[calc(100vh-140px)]",children:e?ss.jsx("div",{className:"mt-15 text-center",children:ss.jsx(ae,{})}):ss.jsx(ee,{})}),ss.jsx(Zs,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"问卷调查 ©2023 - present. Created by Huy"})]})},st=()=>{const e=Z(),{pathname:s}=X(),{loading:t,run:n}=Ee(Bs,{manual:!0,onSuccess(s){e("question/edit/".concat(s.id)),ie.success("创建成功")}});return ss.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[ss.jsx("div",{className:"w-30",children:ss.jsxs(ne,{direction:"vertical",children:[ss.jsx(re,{type:"primary",size:"large",icon:ss.jsx(i,{}),onClick:n,disabled:t,children:"新建问卷"}),ss.jsx(ce,{}),ss.jsx(re,{type:s.startsWith("/manage/list")?"default":"text",size:"large",icon:ss.jsx(r,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),ss.jsx(re,{type:s.startsWith("/manage/star")?"default":"text",size:"large",icon:ss.jsx(l,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),ss.jsx(re,{type:s.startsWith("/manage/trash")?"default":"text",size:"large",icon:ss.jsx(a,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),ss.jsx("div",{className:"ml-15 flex-1",children:ss.jsx(ee,{})})]})},tt=()=>{const{waitingUserData:e}=$s();return Js(e),ss.jsx("div",{className:"h-screen",children:e?ss.jsx("div",{className:"mt-15 text-center",children:ss.jsx(ae,{})}):ss.jsx(ee,{})})},{Title:nt}=xe,it=()=>{const e=Z(),{run:s}=Ee((async e=>{const{username:s,password:t,nickname:n}=e;await async function(e,s,t){const n={username:e,password:s,nickname:t||e};return await Rs.post("/api/user/register",n)}(s,t,n)}),{manual:!0,onSuccess(){ie.success("注册成功"),e(In)}});return ss.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[ss.jsx("div",{children:ss.jsxs(ne,{children:[ss.jsx(nt,{level:2,children:ss.jsx(c,{})}),ss.jsx(nt,{level:2,children:"注册新用户"})]})}),ss.jsx("div",{children:ss.jsxs(oe,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{s(e)},children:[ss.jsx(oe.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:ss.jsx(de,{})}),ss.jsx(oe.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:ss.jsx(de.Password,{})}),ss.jsx(oe.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(s,t)=>t&&e("password")!==t?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:ss.jsx(de.Password,{})}),ss.jsx(oe.Item,{label:"昵称",name:"nickname",children:ss.jsx(de,{})}),ss.jsx(oe.Item,{wrapperCol:{offset:4,span:18},children:ss.jsxs(ne,{children:[ss.jsx(re,{type:"primary",htmlType:"submit",children:"注册"}),ss.jsx(J,{to:In,children:"已有账户，请登录"})]})})]})})]})},rt=()=>{const e=Z();return ss.jsx(ss.Fragment,{children:ss.jsx(me,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:ss.jsx(re,{type:"primary",onClick:()=>e(Sn),children:"返回首页"})})})},{confirm:lt}=pe,at=e=>{const t=Z(),{_id:n,title:i,isPublished:r,answerContent:c,currentAt:u,isStar:h}=e,[p,j]=s.useState(h),{loading:f,run:g}=Ee((async()=>{await Us(n,{isStar:!p})}),{manual:!0,onSuccess(){j(!p),ie.success("已更新")}}),{loading:v,run:y}=Ee((async()=>await async function(e){const s="/api/question/duplicate/".concat(e);return await Rs.post(s)}(n)),{manual:!0,onSuccess(e){ie.success("复制成功"),t("/question/edit/".concat(e.id))}}),[C,b]=s.useState(!1),{loading:k,run:w}=Ee((async()=>await Us(n,{isDeleted:!0})),{manual:!0,onSuccess(){ie.success("删除成功"),b(!0)}});return C?null:ss.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[ss.jsxs("div",{className:"flex",children:[ss.jsx("div",{className:"flex-1",children:ss.jsx(J,{to:r?"/question/stat/".concat(n):"/question/edit/".concat(n),children:ss.jsxs(ne,{children:[h&&ss.jsx(l,{style:{color:"red"}}),i]})})}),ss.jsx("div",{className:"flex-1 text-center font-size-3",children:ss.jsxs(ne,{children:[r?ss.jsx(ue,{color:"processing",children:"已发布"}):ss.jsx(ue,{children:"未发布"}),ss.jsxs("span",{children:["答卷: ",c]}),ss.jsx("span",{children:u})]})})]}),ss.jsx(ce,{className:"m-3"}),ss.jsxs("div",{className:"flex",children:[ss.jsx("div",{className:"flex-1",children:ss.jsxs(ne,{children:[ss.jsx(re,{icon:ss.jsx(o,{}),type:"text",size:"small",onClick:()=>{t("/question/edit/".concat(n))},children:"编辑问卷"}),ss.jsx(re,{icon:ss.jsx(d,{}),type:"text",size:"small",onClick:()=>{t("/question/stat/".concat(n))},children:"数据统计"})]})}),ss.jsx("div",{className:"flex-1 text-center",children:ss.jsxs(ne,{children:[ss.jsx(re,{type:"text",icon:ss.jsx(l,{}),color:"#999",size:"small",onClick:g,disabled:f,children:p?"取消标星":"标星"}),ss.jsx(he,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:y,children:ss.jsx(re,{type:"text",icon:ss.jsx(x,{}),color:"#999",size:"small",disabled:v,children:"复制"})}),ss.jsx(re,{type:"text",icon:ss.jsx(a,{}),size:"small",color:"#999",onClick:()=>{lt({title:"确定删除该问卷?",icon:ss.jsx(m,{}),onOk:w})},disabled:k,children:"删除"})]})})]})]})},{Search:ct}=de,ot=()=>{const e=Z(),{pathname:t}=X(),[n,i]=s.useState("");const[r]=Q();return s.useEffect((()=>{const e=r.get(Ls)||"";i(e)}),[r]),ss.jsx(ct,{placeholder:"请输入关键字",value:n,onChange:function(e){i(e.target.value)},onSearch:function(s){e({pathname:t,search:"".concat(Ls,"=").concat(s)})},className:"w-50"})},{Title:dt}=xe,xt=()=>{const[e,t]=s.useState(!1),[n,i]=s.useState(1),[r,l]=s.useState([]),[a,c]=s.useState(0),o=a>r.length,[d]=Q(),x=d.get(Ls)||"";s.useEffect((()=>{t(!1),i(1),l([]),c(0)}),[x]);const{run:m,loading:u}=Ee((async()=>await Ms({page:n,pageSize:10,keyword:x})),{manual:!0,onSuccess(e){const{list:s=[],total:t=0}=e;l(r.concat(s)),c(t),i(n+1)}}),h=s.useRef(null),{run:p}=Le((()=>{const e=h.current;if(null==e)return;const s=e.getBoundingClientRect();if(null==s)return;const{bottom:n}=s;n<=document.body.clientHeight&&(m(),t(!0))}),{wait:1e3});s.useEffect((()=>{p()}),[d]),s.useEffect((()=>(o&&window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)})),[d,o]);const j=s.useMemo((()=>!e||u?ss.jsx(ae,{}):0===a?ss.jsx(je,{description:"暂无数据"}):o?ss.jsx("span",{children:"开始加载下一页"}):ss.jsx("span",{children:"没有更多了..."})),[e,u,o]);return ss.jsxs(ss.Fragment,{children:[ss.jsxs("div",{className:"flex",children:[ss.jsx("div",{className:"flex-1",children:ss.jsx(dt,{level:3,children:"我的问卷"})}),ss.jsx("div",{className:"flex-1 text-center",children:ss.jsx(ot,{})})]}),ss.jsx("div",{className:"mb-5",children:r.length>0&&r.map((e=>{const{_id:s}=e;return ss.jsx(at,{...e},s)}))}),ss.jsx("div",{className:"text-center color-blue",children:ss.jsx("div",{ref:h,children:j})})]})},mt=e=>{const{total:t}=e,[n,i]=s.useState(1),[r,l]=s.useState(10),[a]=Q();s.useEffect((()=>{const e=parseInt(a.get(Vs)||"")||1;i(e);const s=parseInt(a.get(qs)||"")||10;l(s)}),[a]);const c=Z(),{pathname:o}=X();return ss.jsx(fe,{current:n,pageSize:r,total:t,onChange:(e,s)=>{a.set(Vs,e.toString()),a.set(qs,s.toString()),c({pathname:o,search:a.toString()})}})},{Title:ut}=xe,{confirm:ht}=pe,pt=()=>{Ve("问卷调查");const{data:e={},loading:t,refresh:n}=Gs({isDeleted:!0}),{list:i=[],total:r=0}=e,[l,a]=s.useState([]),c=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?ss.jsx(ue,{color:"processing",children:"已发布"}):ss.jsx(ue,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:o}=Ee((async()=>{for await(const e of l)await Us(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){ie.success("恢复成功"),n(),a([])}}),{run:d}=Ee((async()=>await async function(e){return await Rs.delete("/api/question",{data:{ids:e}})}(l)),{manual:!0,onSuccess(){ie.success("删除成功"),n(),a([])}});return ss.jsxs(ss.Fragment,{children:[ss.jsxs("div",{className:"flex",children:[ss.jsx("div",{className:"flex-1",children:ss.jsx(ut,{level:3,children:"回收站"})}),ss.jsx("div",{className:"flex-1 text-center",children:ss.jsx(ot,{})})]}),ss.jsxs("div",{className:"mb-5",children:[t&&ss.jsx("div",{className:"text-center",children:ss.jsx(ae,{})}),!t&&0===i.length&&ss.jsx(je,{description:"暂无数据"}),i.length>0&&ss.jsxs("div",{children:[ss.jsxs(ne,{className:"mb",children:[ss.jsx(re,{type:"primary",disabled:0===l.length,onClick:o,children:"恢复"}),ss.jsx(re,{danger:!0,disabled:0===l.length,onClick:()=>{ht({title:"确定彻底删除该问卷?",icon:ss.jsx(m,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),ss.jsx(ge,{rowKey:e=>e._id,dataSource:i,columns:c,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{a(e)}}})]})]}),ss.jsx("div",{className:"text-center color-blue",children:i.length>0&&ss.jsx(mt,{total:r})})]})},{Title:jt}=xe,ft=()=>{const{data:e={},loading:s}=Gs({isStar:!0}),{list:t=[],total:n=0}=e;return ss.jsxs(ss.Fragment,{children:[ss.jsxs("div",{className:"flex",children:[ss.jsx("div",{className:"flex-1",children:ss.jsx(jt,{level:3,children:"星标问卷"})}),ss.jsx("div",{className:"flex-1 text-center",children:ss.jsx(ot,{})})]}),ss.jsxs("div",{className:"mb-5",children:[s&&ss.jsx("div",{className:"text-center",children:ss.jsx(ae,{})}),!s&&0===t.length&&ss.jsx(je,{description:"暂无数据"}),t.length>0&&t.map((e=>{const{_id:s}=e;return ss.jsx(at,{...e},s)}))]}),ss.jsx("div",{className:"text-center color-blue",children:t.length>0&&ss.jsx(mt,{total:n})})]})},gt=()=>{const e=T(),{selectedId:s,componentList:t,selectedComponent:n,copiedComponent:i}=As(),r=t.findIndex((e=>e.fe_id===s)),l=r<=0,c=r+1>=t.length,o=(null==n?void 0:n.isLocked)?"primary":"default",d=[{title:"删除",shape:"circle",icon:ss.jsx(a,{}),onClick:()=>{e(Cs())}},{title:"隐藏",shape:"circle",icon:ss.jsx(u,{}),onClick:()=>{e(bs({fe_id:s,isHidden:!0}))}},{title:"锁定",type:o,shape:"circle",icon:ss.jsx(h,{}),onClick:()=>{e(ks({fe_id:s}))}},{title:"复制",shape:"circle",icon:ss.jsx(x,{}),onClick:()=>{e(ws())}},{title:"粘贴",shape:"circle",icon:ss.jsx(p,{}),onClick:()=>{e(Is())},disabled:null==i},{title:"上移",shape:"circle",icon:ss.jsx(j,{}),onClick:()=>{l||e(_s({oldIndex:r,newIndex:r-1}))},disabled:l},{title:"下移",shape:"circle",icon:ss.jsx(f,{}),onClick:()=>{c||e(_s({oldIndex:r,newIndex:r+1}))},disabled:c},{title:"撤销",shape:"circle",icon:ss.jsx(g,{}),onClick:()=>{e($.undo())}},{title:"重做",shape:"circle",icon:ss.jsx(v,{}),onClick:()=>{e($.redo())}}];return ss.jsx(ne,{children:d.map((e=>{const{title:s,type:t,shape:n,icon:i,onClick:r,disabled:l}=e;return ss.jsx(ve,{title:s,children:ss.jsx(re,{type:t,shape:n,icon:i,onClick:r,disabled:l})},s)}))})},vt=()=>{const{title:e}=Os(),t=T(),[n,i]=s.useState(!1),r=e=>{const s=e.target.value.trim();s&&t(ms(s))};return n?ss.jsx(de,{value:e,onChange:r,onPressEnter:()=>i(!1),onBlur:()=>i(!1)}):ss.jsxs(ne,{children:[ss.jsx("div",{children:e}),ss.jsx(re,{icon:ss.jsx(o,{}),type:"text",onClick:()=>i(!0)})]})},yt=()=>{const{id:e}=Y(),{componentList:s=[]}=As(),t=Os(),{loading:n,run:i}=Ee((async()=>{e&&await Us(e,{...t,componentList:s})}),{manual:!0});return Fe(["ctrl.s","meta.s"],(e=>{e.preventDefault(),n||i()})),qe((()=>{i()}),[s,t],{wait:1e3}),ss.jsx(re,{onClick:i,disabled:n,icon:n?ss.jsx(y,{}):null,children:"保存"})},Ct=()=>{const e=Z(),{id:s}=Y(),{componentList:t=[]}=As(),n=Os(),{loading:i,run:r}=Ee((async()=>{s&&await Us(s,{...n,componentList:t,isPublished:!0})}),{manual:!0,onSuccess(){ie.success("发布成功"),e("/question/stat/"+s)}});return ss.jsx(re,{type:"primary",onClick:r,disabled:i,icon:i?ss.jsx(y,{}):null,children:"发布"})},bt=()=>ss.jsxs(ne,{children:[ss.jsx(yt,{}),ss.jsx(Ct,{})]}),kt=()=>{const e=Z();return ss.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[ss.jsx("div",{className:"flex-1",children:ss.jsxs(ne,{children:[ss.jsx(re,{type:"link",icon:ss.jsx(C,{}),onClick:()=>e(-1),children:"返回"}),ss.jsx("div",{className:"mb-0 text-[18px] leading-none",children:ss.jsx(vt,{})})]})}),ss.jsx("div",{className:"flex-1 text-center leading-[2]",children:ss.jsx(gt,{})}),ss.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:ss.jsx(bt,{})})]})},wt={title:"多选标题",isVertical:!1,list:[{value:"item1",text:"选项1",checked:!1},{value:"item2",text:"选项2",checked:!1},{value:"item3",text:"选项3",checked:!1}]},{Paragraph:It}=xe,Nt={title:"多选",type:"questionCheckbox",Component:e=>{const{title:s,isVertical:t,list:n=[]}={...wt,...e};return ss.jsxs("div",{children:[ss.jsx(It,{strong:!0,children:s}),ss.jsx(ne,{direction:t?"vertical":"horizontal",children:n.map((e=>{const{value:s,text:t,checked:n}=e;return ss.jsx(ye,{value:s,checked:n,children:t},s)}))})]})},PropComponent:e=>{const{title:s,isVertical:t,list:n=[],onChange:r,disabled:l}=e,[a]=oe.useForm();return ss.jsxs(oe,{layout:"vertical",form:a,initialValues:{title:s,isVertical:t,list:n},disabled:l,onValuesChange:()=>{if(null==r)return;const e=a.getFieldsValue();e.list&&(e.list=e.list.filter((e=>!(null==e.text))));const{list:s=[]}=e;s.forEach((e=>{e.value||(e.value=us(5))})),r(e)},children:[ss.jsx(oe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:ss.jsx(de,{})}),ss.jsx(oe.Item,{label:"选项",children:ss.jsx(oe.List,{name:"list",children:(e,{add:s,remove:t})=>ss.jsxs(ss.Fragment,{children:[e.map((({key:e,name:s},n)=>ss.jsxs(ne,{align:"baseline",children:[ss.jsx(oe.Item,{name:[s,"checked"],valuePropName:"checked",children:ss.jsx(ye,{})}),ss.jsx(oe.Item,{name:[s,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,s)=>{const{list:t=[]}=a.getFieldsValue();let n=0;return t.forEach((e=>{e.text===s&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:ss.jsx(de,{placeholder:"输入选项文字..."})}),n>0&&ss.jsx(b,{onClick:()=>t(s)})]},e))),ss.jsx(oe.Item,{children:ss.jsx(re,{type:"link",onClick:()=>s({text:"",value:"",checked:!1}),icon:ss.jsx(i,{}),block:!0,children:"添加选项"})})]})})}),ss.jsx(oe.Item,{name:"isVertical",valuePropName:"checked",children:ss.jsx(ye,{children:"竖向排列"})})]})},StatComponent:({stat:e})=>ss.jsx("div",{style:{width:"400px",height:"300px"},children:ss.jsx(Te,{width:"100%",height:"100%",children:ss.jsxs(Re,{width:400,height:300,data:e,margin:{top:5,right:30,left:0,bottom:5},children:[ss.jsx(ze,{strokeDasharray:"3 3"}),ss.jsx(De,{dataKey:"name"}),ss.jsx(Ae,{}),ss.jsx(Oe,{}),ss.jsx(He,{dataKey:"count",fill:"#8884d8"})]})})}),defaultProps:wt},St={title:"问卷标题",desc:"问卷描述"},{Title:Pt,Paragraph:_t}=xe,{TextArea:Ft}=de,Et={title:"问卷信息",type:"questionInfo",Component:e=>{const{title:s,desc:t=""}={...St,...e},n=t.split("\n");return ss.jsxs("div",{style:{textAlign:"center"},children:[ss.jsx(Pt,{style:{fontSize:"24px"},children:s}),ss.jsx(_t,{children:n.map(((e,s)=>ss.jsxs("span",{children:[s>0&&ss.jsx("br",{}),e]},s)))})]})},PropComponent:e=>{const{title:t,desc:n,onChange:i,disabled:r}=e,[l]=oe.useForm();return s.useEffect((()=>{l.setFieldsValue({title:t,desc:n})}),[t,n]),ss.jsxs(oe,{layout:"vertical",initialValues:{title:t,desc:n},onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,form:l,children:[ss.jsx(oe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入问卷标题"}],children:ss.jsx(de,{})}),ss.jsx(oe.Item,{label:"描述",name:"desc",children:ss.jsx(Ft,{})})]})},defaultProps:St},Lt={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Vt}=xe,qt={title:"输入框",type:"questionInput",Component:e=>{const{title:s,placeholder:t}={...Lt,...e};return ss.jsxs("div",{children:[ss.jsx(Vt,{strong:!0,children:s}),ss.jsx("div",{children:ss.jsx(de,{placeholder:t})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:i,disabled:r}=e,[l]=oe.useForm();return s.useEffect((()=>{l.setFieldsValue({title:t,placeholder:n})}),[t,n]),ss.jsxs(oe,{layout:"vertical",initialValues:{title:t,placeholder:n},form:l,onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,children:[ss.jsx(oe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:ss.jsx(de,{})}),ss.jsx(oe.Item,{label:"Placeholder",name:"placeholder",children:ss.jsx(de,{})})]})},defaultProps:Lt},Tt={text:"一行段落",isCenter:!1},{Paragraph:Rt}=xe,{TextArea:zt}=de,Dt={title:"段落",type:"questionParagraph",Component:e=>{const{text:s="",isCenter:t=!1}={...Tt,...e},n=s.split("\n");return ss.jsx(Rt,{style:{textAlign:t?"center":"start",marginBottom:"0"},children:n.map(((e,s)=>ss.jsxs("span",{children:[s>0&&ss.jsx("br",{}),e]},s)))})},PropComponent:e=>{const{text:t,isCenter:n,onChange:i,disabled:r}=e,[l]=oe.useForm();return s.useEffect((()=>{l.setFieldsValue({text:t,isCenter:n})}),[t,n]),ss.jsxs(oe,{layout:"vertical",initialValues:{text:t,isCenter:n},onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,form:l,children:[ss.jsx(oe.Item,{label:"段落内容",name:"text",rules:[{required:!0,message:"请输入段落内容"}],children:ss.jsx(zt,{})}),ss.jsx(oe.Item,{name:"isCenter",valuePropName:"checked",children:ss.jsx(ye,{children:"居中显示"})})]})},defaultProps:Tt},At={title:"单选标题",isVertical:!1,options:[{value:"item1",text:"选项1"},{value:"item2",text:"选项2"},{value:"item3",text:"选项3"}],value:""},{Paragraph:Ot}=xe;const Ht={title:"单选",type:"questionRadio",Component:e=>{const{title:s,options:t=[],value:n,isVertical:i}={...At,...e};return ss.jsxs("div",{children:[ss.jsx(Ot,{strong:!0,children:s}),ss.jsx(Ce.Group,{value:n,children:ss.jsx(ne,{direction:i?"vertical":"horizontal",children:t.map((e=>{const{value:s,text:t}=e;return ss.jsx(Ce,{value:s,children:t},s)}))})})]})},PropComponent:e=>{const{title:t,isVertical:n,value:r,options:l=[],onChange:a,disabled:c}=e,[o]=oe.useForm();return s.useEffect((()=>{o.setFieldsValue({title:t,isVertical:n,value:r,options:l})}),[t,n,r,l]),ss.jsxs(oe,{layout:"vertical",initialValues:{title:t,isVertical:n,value:r,options:l},onValuesChange:function(){if(null==a)return;const e=o.getFieldsValue();e.options&&(e.options=e.options.filter((e=>!(null==e.text))));const{options:s=[]}=e;s.forEach((e=>{e.value||(e.value=us(5))})),a(e)},disabled:c,form:o,children:[ss.jsx(oe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:ss.jsx(de,{})}),ss.jsx(oe.Item,{label:"选项",children:ss.jsx(oe.List,{name:"options",children:(e,{add:s,remove:t})=>ss.jsxs(ss.Fragment,{children:[e.map((({key:e,name:s},n)=>ss.jsxs(ne,{align:"baseline",children:[ss.jsx(oe.Item,{name:[s,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,s)=>{const{options:t=[]}=o.getFieldsValue();let n=0;return t.forEach((e=>{e.text===s&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:ss.jsx(de,{placeholder:"输入选项文字..."})}),n>1&&ss.jsx(b,{onClick:()=>t(s)})]},e))),ss.jsx(oe.Item,{children:ss.jsx(re,{type:"link",onClick:()=>s({text:"",value:""}),icon:ss.jsx(i,{}),block:!0,children:"添加选项"})})]})})}),ss.jsx(oe.Item,{label:"默认选中",name:"value",children:ss.jsx(be,{value:r,options:l.map((({text:e,value:s})=>({value:s,label:e||""})))})}),ss.jsx(oe.Item,{name:"isVertical",valuePropName:"checked",children:ss.jsx(ye,{children:"竖向排列"})})]})},defaultProps:At,StatComponent:({stat:e=[]})=>{const t=s.useMemo((()=>{let s=0;return e.forEach((e=>s+=e.count)),s}),[e]);return ss.jsx("div",{style:{width:"300px",height:"400px"},children:ss.jsx(Te,{width:"100%",height:"100%",children:ss.jsxs(Be,{children:[ss.jsx(Me,{dataKey:"count",data:e,cx:"50%",cy:"50%",outerRadius:50,fill:"#8884d8",label:e=>"".concat(e.name,": ").concat((100*(e.count/t)).toFixed(2),"%"),children:e.map(((e,s)=>ss.jsx(Ue,{fill:Ts[s]},s)))}),ss.jsx(Oe,{})]})})})}},Bt={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Mt}=xe,{TextArea:Ut}=de,Kt={title:"多行输入",type:"questionTextarea",Component:e=>{const{title:s,placeholder:t}={...Bt,...e};return ss.jsxs("div",{children:[ss.jsx(Mt,{strong:!0,children:s}),ss.jsx("div",{children:ss.jsx(Ut,{placeholder:t})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:i,disabled:r}=e,[l]=oe.useForm();return s.useEffect((()=>{l.setFieldsValue({title:t,placeholder:n})}),[t,n]),ss.jsxs(oe,{layout:"vertical",initialValues:{title:t,placeholder:n},form:l,onValuesChange:function(){i&&i(l.getFieldsValue())},disabled:r,children:[ss.jsx(oe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:ss.jsx(de,{})}),ss.jsx(oe.Item,{label:"Placeholder",name:"placeholder",children:ss.jsx(de,{})})]})},defaultProps:Bt},Wt={text:"一级标题",level:1,isCenter:!1},{Title:Gt}=xe,$t={title:"标题",type:"questionTitle",Component:e=>{const{text:s="",level:t=1,isCenter:n=!1}={...Wt,...e};return ss.jsx(Gt,{level:t,style:{textAlign:n?"center":"start",marginBottom:"0",fontSize:(i=t,1===i?"24px":2===i?"20px":"16px")},children:s});var i},PropComponent:e=>{const{text:t,level:n,isCenter:i,onChange:r,disabled:l}=e,[a]=oe.useForm();return s.useEffect((()=>{a.setFieldsValue({text:t,level:n,isCenter:i})}),[t,n,i]),ss.jsxs(oe,{form:a,layout:"vertical",onValuesChange:function(){r&&r(a.getFieldsValue())},initialValues:{text:t,level:n,isCenter:i},disabled:l,children:[ss.jsx(oe.Item,{label:"标题内容",name:"text",rules:[{required:!0,message:"请输入标题内容"}],children:ss.jsx(de,{})}),ss.jsx(oe.Item,{label:"层级",name:"level",children:ss.jsx(be,{options:[{value:1,text:1},{value:2,text:2},{value:3,text:3}]})}),ss.jsx(oe.Item,{name:"isCenter",valuePropName:"checked",children:ss.jsx(ye,{children:"居中显示"})})]})},defaultProps:Wt},Jt=[{groupId:"textGroup",groupName:"文本显示",components:[Et,Dt,$t]},{groupId:"inputGroup",groupName:"用户输入",components:[qt,Kt]},{groupId:"chooseGroup",groupName:"用户选择",components:[Nt,Ht]}],Yt=[Nt,Et,qt,Dt,Ht,Kt,$t];function Qt(e){return Yt.find((s=>s.type===e))}const{Title:Xt}=xe,Zt=()=>ss.jsx(ss.Fragment,{children:Jt.map(((e,t)=>{const{groupId:n,groupName:i,components:r}=e;return ss.jsxs("div",{children:[ss.jsx(Xt,{level:3,style:{fontSize:"16px",marginTop:t>0?"20px":"0"},children:i}),ss.jsx("div",{children:r.map((e=>(e=>{const{title:t,type:n,Component:i,defaultProps:r}=e,l=T(),a=s.useCallback((()=>{l(vs({fe_id:us(),title:t,type:n,props:r}))}),[]);return ss.jsx("div",{onClick:a,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:ss.jsx("div",{className:"pointer-events-none",children:ss.jsx(i,{})})},n)})(e)))})]},n)}))}),en=e=>{const{children:s,items:t,onDragEnd:n}=e,i=F(E(q,{activationConstraint:{distance:8}}));return ss.jsx(L,{sensors:i,collisionDetection:V,onDragEnd:e=>{const{active:s,over:i}=e;if(null!=i&&s.id!==i.id){const e=t.findIndex((e=>e.fe_id===s.id)),r=t.findIndex((e=>e.fe_id===i.id));n(e,r)}},children:ss.jsx(B,{items:t,strategy:M,children:s})})},sn=({id:e,children:s})=>{const{attributes:t,listeners:n,setNodeRef:i,transform:r,transition:l}=U({id:e}),a={transform:Ke.Transform.toString(r),transition:l};return ss.jsx("div",{ref:i,style:a,...t,...n,children:s})},tn=()=>{const{componentList:e,selectedId:t}=As(),n=T(),[i,r]=s.useState(""),l=e=>{const s=e.target.value.trim();s&&t&&n(Ps({fe_id:t,title:s}))},a=e.map((e=>({...e,id:e.fe_id})));return ss.jsx(en,{items:a,onDragEnd:(e,s)=>{n(_s({oldIndex:e,newIndex:s}))},children:e.map((s=>{const{fe_id:a,title:c,isHidden:o,isLocked:d}=s,x=k({"flex-auto line-height-loose":!0,"color-blue":a===t}),m="opacity-20",p=k({[m]:o}),j=k({[m]:o});return ss.jsx(sn,{id:a,children:ss.jsxs("div",{className:"flex border-b border-b-green-200 border-b-solid py-2",children:[ss.jsxs("div",{className:x,onClick:()=>(s=>{const i=e.find((e=>e.fe_id===s));return i&&i.isHidden?ie.info("不能选中隐藏的组件!"):s!==t?(n(gs(s)),void r("")):void r(s)})(a),children:[a===i&&ss.jsx(de,{value:c,onChange:l,onPressEnter:()=>r(""),onBlur:()=>r("")}),a!==i&&c]}),ss.jsx("div",{className:"w-12 text-end",children:ss.jsxs(ne,{children:[ss.jsx(re,{size:"small",shape:"circle",className:p,icon:ss.jsx(u,{}),type:o?"primary":"text",onClick:()=>((e,s)=>{n(bs({fe_id:e,isHidden:s}))})(a,!o)}),ss.jsx(re,{size:"small",shape:"circle",className:j,icon:ss.jsx(h,{}),type:d?"primary":"text",onClick:()=>(e=>{n(ks({fe_id:e}))})(a)})]})})]})},a)}))})},nn=()=>{const e=[{key:"componentLib",label:ss.jsxs("span",{children:[ss.jsx(w,{}),"组件库"]}),children:ss.jsx(Zt,{})},{key:"layers",label:ss.jsxs("span",{children:[ss.jsx(r,{}),"图层"]}),children:ss.jsx(tn,{})}];return ss.jsx(ss.Fragment,{children:ss.jsx(ke,{items:e,defaultActiveKey:"componentLib"})})},rn=({loading:e})=>{const{componentList:s,selectedIs:t}=As(),n=T();if(function(){const e=T();Fe(["backspace","delete"],(()=>{Ds()&&e(Cs())})),Fe(["ctrl.c","meta.c"],(()=>{Ds()&&e(ws())})),Fe(["ctrl.v","meta.v"],(()=>{Ds()&&e(Is())})),Fe("uparrow",(()=>{Ds()&&e(Ns())})),Fe("downarrow",(()=>{Ds()&&e(Ss())})),Fe(["ctrl.z","meta.z"],(()=>{Ds()&&e($.undo())}),{exactMatch:!0}),Fe(["ctrl.shift.z","meta.shift.z"],(()=>{Ds()&&e($.redo())}))}(),e)return ss.jsx("div",{className:"mt-6 text-center",children:ss.jsx(ae,{})});const i=e=>{const{type:s,props:t}=e,n=Qt(s);if(null==n)return null;const{Component:i}=n;return ss.jsx(i,{...t})},r=s.map((e=>({...e,id:e.fe_id})));return ss.jsx(en,{items:r,onDragEnd:(e,s)=>{n(_s({oldIndex:e,newIndex:s}))},children:ss.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:s.map((e=>{const{fe_id:s}=e,t=k({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return ss.jsx(sn,{id:s,children:ss.jsx("div",{className:t,onClick:e=>{return t=s,e.stopPropagation(),void n(gs(t));var t},children:ss.jsx("div",{className:"pointer-events-none",children:i(e)})})},s)}))})})},ln=()=>ss.jsx("div",{className:"text-center",children:"未选中组件"}),an=()=>{const e=T(),{selectedComponent:s}=As();if(null==s)return ss.jsx(ln,{});const{type:t,props:n}=s,i=Qt(t);if(null==i)return ss.jsx(ln,{});const{PropComponent:r}=i;return ss.jsx(r,{...n,onChange:t=>{const{fe_id:n}=s;e(ys({fe_id:n,newProps:t}))}})},cn=()=>{const e=Os(),[s]=oe.useForm(),t=T();return ss.jsxs(oe,{layout:"vertical",initialValues:e,onValuesChange:()=>{t(xs(s.getFieldsValue()))},form:s,children:[ss.jsx(oe.Item,{name:"title",label:"问卷标题",rules:[{required:!0,message:"请输入标题"}],children:ss.jsx(de,{placeholder:"请输入标题"})}),ss.jsx(oe.Item,{name:"desc",label:"问卷描述",children:ss.jsx(we,{placeholder:"问卷描述信息"})}),ss.jsx(oe.Item,{name:"css",label:"样式代码",children:ss.jsx(we,{placeholder:"请输入 CSS 样式代码"})}),ss.jsx(oe.Item,{name:"js",label:"脚本代码",children:ss.jsx(we,{placeholder:"请输入 JS 脚本代码"})})]})},on=()=>{const[e,t]=s.useState("prop"),{selectedId:n}=As();s.useEffect((()=>{t(n?"prop":"setting")}),[n]);const i=[{key:"prop",label:ss.jsxs("span",{children:[ss.jsx(I,{}),"属性"]}),children:ss.jsx(an,{})},{key:"setting",label:ss.jsxs("span",{children:[ss.jsx(N,{}),"页面设置"]}),children:ss.jsx(cn,{})}];return ss.jsx(ke,{activeKey:e,items:i})},dn=()=>{const e=T(),{loading:s}=Ws(),{title:t}=Os(),n=t?"问卷编辑 - ".concat(t):"问卷调查";Ve(n);return ss.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[ss.jsx(kt,{}),ss.jsx("div",{className:"flex-1 py-3",children:ss.jsxs("div",{className:"mx-6 h-100% flex",children:[ss.jsx("div",{className:"w-75 bg-white px-3",children:ss.jsx(nn,{})}),ss.jsx("div",{className:"relative flex-1 overflow-hidden",onClick:()=>{e(gs(""))},children:ss.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:ss.jsx(rn,{loading:s})})}),ss.jsx("div",{className:"w-75 bg-white px-3",children:ss.jsx(on,{})})]})})]})},xn=()=>ss.jsx("div",{className:"mt-15 text-center",children:ss.jsx(ae,{})}),mn=()=>{const e=Z();return ss.jsx("div",{className:"flex-1",children:ss.jsx(me,{status:"warning",title:"该页面尚未发布",extra:ss.jsx(re,{type:"primary",onClick:()=>e(-1),children:"返回"})})})},un=()=>{const e=Z(),{title:t}=Os(),{id:n}=Y(),i=s.useRef(null),r=s.useMemo((()=>{const e="http://localhost:5173/survey-sage/question/".concat(n),s=ss.jsx("div",{className:"text-center",children:ss.jsx(Ne,{value:e||"-"})});return ss.jsxs(ne,{children:[ss.jsx(de,{value:e,style:{width:"300px"},ref:i}),ss.jsx(ve,{title:"拷贝链接",children:ss.jsx(re,{icon:ss.jsx(x,{}),onClick:()=>{const s=i.current;if(null!=s){s.select();try{navigator.clipboard.writeText(e)}catch(t){}}}})}),ss.jsx(Ie,{content:s,children:ss.jsx(re,{icon:ss.jsx(S,{})})})]})}),[n]);return ss.jsx("div",{className:"border-coolGray border-b-solid bg-white py-3",children:ss.jsxs("div",{className:"mx-6 flex",children:[ss.jsx("div",{className:"flex-1",children:ss.jsxs(ne,{children:[ss.jsx(re,{type:"link",icon:ss.jsx(C,{}),onClick:()=>{e(-1)},children:"返回"}),ss.jsx("span",{className:"text-5 line-height-none",children:t})]})}),ss.jsx("div",{className:"flex-1 text-center",children:r}),ss.jsx("div",{className:"flex-1 text-right",children:ss.jsx(re,{type:"primary",onClick:()=>{e("/question/edit/".concat(n))},children:"编辑问卷"})})]})})},hn=()=>ss.jsx("div",{className:"mx-6 flex",children:"主体"}),pn=()=>{const{loading:e,questionData:s}=Ws(),{title:t,isPubulished:n}=Os();return Ve("问卷调查 - ".concat(t)),n?ss.jsx(mn,{}):ss.jsxs("div",{className:"min-h-screen flex flex-col bg-cyan",children:[ss.jsx(un,{}),ss.jsxs("div",{className:"flex-auto py-3",children:[e&&ss.jsx(xn,{}),!e&&ss.jsx(hn,{})]})]})},{Title:jn,Paragraph:fn}=xe,gn=()=>{const e=Z();return ss.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:ss.jsxs("div",{className:"text-center",children:[ss.jsx(jn,{children:"问卷调查 | 在线投票"}),ss.jsx(fn,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),ss.jsx("div",{className:"h-15 font-24",children:ss.jsx(re,{className:"b-rounded-4",type:"primary",onClick:()=>e(Sn),children:"开始使用"})})]})})},{Title:vn}=xe,yn="USERNAME",Cn="PASSWORD";const bn=()=>{const e=Z(),t=T(),[n]=oe.useForm();s.useEffect((()=>{const{username:e,password:s}={username:localStorage.getItem(yn),password:localStorage.getItem(Cn)};n.setFieldsValue({username:e,password:s})}),[]);const{run:i}=Ee((async(e,s)=>{const n=await async function(e,s){const t={username:e,password:s};return await Rs.post("/api/user/login",t)}(e,s);return n.token&&t(as({username:e,nickname:e})),n}),{manual:!0,onSuccess(s){const{token:t=""}=s;!function(e){localStorage.setItem(zs,e)}(t),ie.success("登录成功"),e(Sn)}});return ss.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[ss.jsx("div",{children:ss.jsxs(ne,{children:[ss.jsx(vn,{level:2,children:ss.jsx(c,{})}),ss.jsx(vn,{level:2,children:"登录"})]})}),ss.jsx("div",{children:ss.jsxs(oe,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{const{username:s,password:t,remember:n}=e||{};i(s,t),n?function(e,s){localStorage.setItem(yn,e),localStorage.setItem(Cn,s)}(s,t):(localStorage.removeItem(yn),localStorage.removeItem(Cn))},children:[ss.jsx(oe.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:ss.jsx(de,{})}),ss.jsx(oe.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:ss.jsx(de.Password,{})}),ss.jsx(oe.Item,{name:"remember",valuePropName:"checked",wrapperCol:{offset:0,span:10},children:ss.jsx(ye,{children:"记住我"})}),ss.jsx(oe.Item,{wrapperCol:{offset:4,span:18},children:ss.jsxs(ne,{children:[ss.jsx(re,{type:"primary",htmlType:"submit",children:"登录"}),ss.jsx(J,{to:Nn,children:"注册新用户"})]})})]})})]})},kn=se([{path:"/",element:ss.jsx(et,{}),children:[{path:"/",element:ss.jsx(gn,{})},{path:"login",element:ss.jsx(bn,{})},{path:"register",element:ss.jsx(it,{})},{path:"manage",element:ss.jsx(st,{}),children:[{path:"list",element:ss.jsx(xt,{})},{path:"star",element:ss.jsx(ft,{})},{path:"trash",element:ss.jsx(pt,{})}]},{path:"*",element:ss.jsx(rt,{})}]},{path:"question",element:ss.jsx(tt,{}),children:[{path:"edit/:id",element:ss.jsx(dn,{})},{path:"stat/:id",element:ss.jsx(pn,{})}]}],{basename:"/survey-sage"}),wn="/",In="/login",Nn="/register",Sn="/manage/list";const Pn=()=>ss.jsx(Se,{theme:{algorithm:Pe.defaultAlgorithm},children:ss.jsx(te,{router:kn})});ts.createRoot(document.getElementById("root")).render(ss.jsx(P.StrictMode,{children:ss.jsx(z,{store:Fs,children:ss.jsx(Pn,{})})}));export{e as __vite_legacy_guard};
