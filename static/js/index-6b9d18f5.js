function e(){import.meta.url,import("_").catch((()=>1))}import{r as s,ad as t,ae as n,af as r,M as a,ag as i,ah as c,ai as l,ab as o,aj as d,ac as x,ak as m,al as h,R as u}from"./@ant-design/icons-127ef214.js";import{r as j,S as p,T as f,m as g,B as y,L as v,D as w,F as b,I as S,R as N,a as k,P as I,M as C,b as _,E,c as q,d as P,C as R,e as O,t as T}from"./antd-5fd8baa4.js";import{L as F,u as z,O as L,a as D,b as A,c as M,d as W,R as B}from"./react-router-dom-4411b9bd.js";import{a as U}from"./axios-83bdef92.js";import{u as $,a as H,b as K}from"./ahooks-c4382e31.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var J={exports:{}},V={},Q=s,Y=Symbol.for("react.element"),G=Symbol.for("react.fragment"),X=Object.prototype.hasOwnProperty,Z=Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ee={key:!0,ref:!0,__self:!0,__source:!0};function se(e,s,t){var n,r={},a=null,i=null;for(n in void 0!==t&&(a=""+t),void 0!==s.key&&(a=""+s.key),void 0!==s.ref&&(i=s.ref),s)X.call(s,n)&&!ee.hasOwnProperty(n)&&(r[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===r[n]&&(r[n]=s[n]);return{$$typeof:Y,type:e,key:a,ref:i,props:r,_owner:Z.current}}V.Fragment=G,V.jsx=se,V.jsxs=se,J.exports=V;var te=J.exports;var ne={},re=j;ne.createRoot=re.createRoot,ne.hydrateRoot=re.hydrateRoot;const ae="_container_1fxih_1",{Title:ie}=f,ce=()=>te.jsx("div",{children:te.jsx(F,{to:"/",children:te.jsxs(p,{className:ae,children:[te.jsx(ie,{children:te.jsx(t,{})}),te.jsx(ie,{children:"问卷调查"})]})})}),le="USER_TOKEN";const oe="keyword",de="page",xe="pageSize",me=U.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});async function he(){return await me.get("/api/user/info")}me.interceptors.request.use((e=>(e.headers.Authorization="Bearer ".concat(localStorage.getItem(le)||""),e)),(e=>(g.error(e.message),Promise.reject(e)))),me.interceptors.response.use((e=>{const s=e.data||{},{errno:t,data:n,msg:r}=s;return 203===t||0!==t&&200!==t?(g.error(r||"请求失败"),Promise.reject(n)):n}),(e=>{var s;let t="";switch(null==(s=e.response)?void 0:s.status){case 401:t="token 失效，请重新登录";break;case 403:t="拒绝访问";break;case 404:t="请求地址错误";break;case 500:t="服务器故障";break;default:t="网络连接故障"}return g.error(t),Promise.reject(e)}));const ue=()=>{const e=z(),{data:s}=$(he),{username:t,nickname:r}=s||{};const a=te.jsxs(te.Fragment,{children:[te.jsxs("span",{className:"color-light",children:[te.jsx(n,{}),r]}),te.jsx(y,{type:"link",onClick:function(){localStorage.removeItem(le),g.success("退出成功"),e(Ge)},children:"退出"})]}),i=te.jsx(F,{to:Ge,children:"登录"});return te.jsx(te.Fragment,{children:t?a:i})},{Header:je,Content:pe,Footer:fe}=v,ge=()=>te.jsxs(v,{children:[te.jsxs(je,{className:"px-6",children:[te.jsx("div",{className:"float-left",children:te.jsx(ce,{})}),"MainLayout header",te.jsx("div",{className:"float-right",children:te.jsx(ue,{})})]}),te.jsx(pe,{className:"min-h-[calc(100vh-140px)]",children:te.jsx(L,{})}),te.jsx(fe,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"文件调查@2023 Created by Huy"})]});async function ye(){return await me.post("/api/question/")}async function ve(e={}){return await me.get("/api/question",{params:e})}async function we(e,s){const t="/api/question/".concat(e);return await me.patch(t,s)}const be=()=>{const e=z(),{pathname:s}=D(),{loading:t,run:n}=$(ye,{manual:!0,onSuccess(s){e("question/edit/".concat(s.id)),g.success("创建成功")}});return te.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[te.jsx("div",{className:"w-30",children:te.jsxs(p,{direction:"vertical",children:[te.jsx(y,{type:"primary",size:"large",icon:te.jsx(r,{}),onClick:n,disabled:t,children:"新建问卷"}),te.jsx(w,{}),te.jsx(y,{type:s.startsWith("/manage/list")?"default":"text",size:"large",icon:te.jsx(a,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),te.jsx(y,{type:s.startsWith("/manage/star")?"default":"text",size:"large",icon:te.jsx(i,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),te.jsx(y,{type:s.startsWith("/manage/trash")?"default":"text",size:"large",icon:te.jsx(c,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),te.jsx("div",{className:"ml-15 flex-1",children:te.jsx(L,{})})]})},Se=()=>te.jsxs(te.Fragment,{children:[te.jsx("p",{children:"Question layout"}),te.jsx("div",{children:te.jsx(L,{})})]}),{Title:Ne}=f,ke=()=>{const e=z(),{run:s}=$((async e=>{const{username:s,password:t,nickname:n}=e;await async function(e,s,t){const n={username:e,password:s,nickname:t||e};return await me.post("/api/user/register",n)}(s,t,n)}),{manual:!0,onSuccess(){g.success("注册成功"),e(Ge)}});return te.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[te.jsx("div",{children:te.jsxs(p,{children:[te.jsx(Ne,{level:2,children:te.jsx(l,{})}),te.jsx(Ne,{level:2,children:"注册新用户"})]})}),te.jsx("div",{children:te.jsxs(b,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{s(e)},children:[te.jsx(b.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:te.jsx(S,{})}),te.jsx(b.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:te.jsx(S.Password,{})}),te.jsx(b.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(s,t)=>t&&e("password")!==t?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:te.jsx(S.Password,{})}),te.jsx(b.Item,{label:"昵称",name:"nickname",children:te.jsx(S,{})}),te.jsx(b.Item,{wrapperCol:{offset:4,span:18},children:te.jsxs(p,{children:[te.jsx(y,{type:"primary",htmlType:"submit",children:"注册"}),te.jsx(F,{to:Ge,children:"已有账户，请登录"})]})})]})})]})},Ie=()=>{const e=z();return te.jsx(te.Fragment,{children:te.jsx(N,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:te.jsx(y,{type:"primary",onClick:()=>e(Ze),children:"返回首页"})})})},{confirm:Ce}=C,_e=e=>{const{id:s,title:t,isPublished:n,answerContent:r,currentAt:a,isStar:l}=e,h=z();return te.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[te.jsxs("div",{className:"flex",children:[te.jsx("div",{className:"flex-1",children:te.jsx(F,{to:n?"/question/stat/".concat(s):"/question/edit/".concat(s),children:te.jsxs(p,{children:[l&&te.jsx(i,{style:{color:"red"}}),t]})})}),te.jsx("div",{className:"flex-1 text-center font-size-3",children:te.jsxs(p,{children:[n?te.jsx(k,{color:"processing",children:"已发布"}):te.jsx(k,{children:"未发布"}),te.jsxs("span",{children:["答卷: ",r]}),te.jsx("span",{children:a})]})})]}),te.jsx(w,{className:"m-3"}),te.jsxs("div",{className:"flex",children:[te.jsx("div",{className:"flex-1",children:te.jsxs(p,{children:[te.jsx(y,{icon:te.jsx(o,{}),type:"text",size:"small",onClick:()=>{h("/question/edit/".concat(s))},children:"编辑问卷"}),te.jsx(y,{icon:te.jsx(d,{}),type:"text",size:"small",onClick:()=>{h("/question/stat/".concat(s))},children:"数据统计"})]})}),te.jsx("div",{className:"flex-1 text-center",children:te.jsxs(p,{children:[te.jsx(y,{type:"text",icon:te.jsx(i,{}),color:"#999",size:"small",children:"标星"}),te.jsx(I,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:()=>{},children:te.jsx(y,{type:"text",icon:te.jsx(x,{}),color:"#999",size:"small",children:"复制"})}),te.jsx(y,{type:"text",icon:te.jsx(c,{}),size:"small",color:"#999",onClick:()=>{Ce({title:"确定删除该问卷?",icon:te.jsx(m,{}),onOk:()=>g.success("删除")})},children:"删除"})]})})]})]})},{Search:Ee}=S,qe=()=>{const e=z(),{pathname:t}=D(),[n,r]=s.useState("");const[a]=A();return s.useEffect((()=>{const e=a.get(oe)||"";r(e)}),[a]),te.jsx(Ee,{placeholder:"请输入关键字",value:n,onChange:function(e){r(e.target.value)},onSearch:function(s){e({pathname:t,search:"".concat(oe,"=").concat(s)})},className:"w-50"})},{Title:Pe}=f,Re=()=>{const[e,t]=s.useState(!1),[n,r]=s.useState(1),[a,i]=s.useState([]),[c,l]=s.useState(0),o=c>a.length,[d]=A(),x=d.get(oe)||"";s.useEffect((()=>{t(!1),r(1),i([]),l(0)}),[x]);const{run:m,loading:h}=$((async()=>await ve({page:n,pageSize:10,keyword:x})),{manual:!0,onSuccess(e){const{list:s=[],total:t=0}=e;i(a.concat(s)),l(t),r(n+1)}}),u=s.useRef(null),{run:j}=H((()=>{const e=u.current;if(null==e)return;const s=e.getBoundingClientRect();if(null==s)return;const{bottom:n}=s;n<=document.body.clientHeight&&(m(),t(!0))}),{wait:1e3});s.useEffect((()=>{j()}),[d]),s.useEffect((()=>(o&&window.addEventListener("scroll",j),()=>{window.removeEventListener("scroll",j)})),[d,o]);const p=s.useMemo((()=>!e||h?te.jsx(_,{}):0===c?te.jsx(E,{description:"暂无数据"}):o?te.jsx("span",{children:"开始加载下一页"}):te.jsx("span",{children:"没有更多了..."})),[e,h,o]);return te.jsxs(te.Fragment,{children:[te.jsxs("div",{className:"flex",children:[te.jsx("div",{className:"flex-1",children:te.jsx(Pe,{level:3,children:"我的问卷"})}),te.jsx("div",{className:"flex-1 text-center",children:te.jsx(qe,{})})]}),te.jsx("div",{className:"mb-5",children:a.length>0&&a.map((e=>{const{_id:s}=e;return te.jsx(_e,{...e},s)}))}),te.jsx("div",{className:"text-center color-blue",children:te.jsx("div",{ref:u,children:p})})]})},Oe=e=>{const{total:t}=e,[n,r]=s.useState(1),[a,i]=s.useState(10),[c]=A();s.useEffect((()=>{const e=parseInt(c.get(de)||"")||1;r(e);const s=parseInt(c.get(xe)||"")||10;i(s)}),[c]);const l=z(),{pathname:o}=D();return te.jsx(q,{current:n,pageSize:a,total:t,onChange:(e,s)=>{c.set(de,e.toString()),c.set(xe,s.toString()),l({pathname:o,search:c.toString()})}})};function Te(){const{id:e=""}=M(),[t,n]=s.useState(!0),[r,a]=s.useState({});return s.useEffect((()=>{!async function(){const s=await async function(e){const s="/api/question/".concat(e);return await me.get(s)}(e);a(s),n(!1)}()}),[e]),{loading:t,questionData:r}}function Fe(e={}){const{isStar:s,isDeleted:t}=e,[n]=A(),{data:r,loading:a,error:i,refresh:c}=$((async()=>{const e=n.get(oe)||"",r=parseInt(n.get(de)||"")||1,a=parseInt(n.get(xe)||"")||10;return await ve({keyword:e,isStar:s,isDeleted:t,page:r,pageSize:a})}),{refreshDeps:[n]});return{data:r,loading:a,error:i,refresh:c}}const{Title:ze}=f,{confirm:Le}=C,De=()=>{K("问卷调查");const{data:e={},loading:t,refresh:n}=Fe({isDeleted:!0}),{list:r=[],total:a=0}=e,[i,c]=s.useState([]),l=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?te.jsx(k,{color:"processing",children:"已发布"}):te.jsx(k,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:o}=$((async()=>{for await(const e of i)await we(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){g.success("恢复成功"),n(),c([])}}),{run:d}=$((async()=>await async function(e){return await me.delete("/api/question",{data:{ids:e}})}(i)),{manual:!0,onSuccess(){g.success("删除成功"),n(),c([])}});return te.jsxs(te.Fragment,{children:[te.jsxs("div",{className:"flex",children:[te.jsx("div",{className:"flex-1",children:te.jsx(ze,{level:3,children:"回收站"})}),te.jsx("div",{className:"flex-1 text-center",children:te.jsx(qe,{})})]}),te.jsxs("div",{className:"mb-5",children:[t&&te.jsx("div",{className:"text-center",children:te.jsx(_,{})}),!t&&0===r.length&&te.jsx(E,{description:"暂无数据"}),r.length>0&&te.jsxs("div",{children:[te.jsxs(p,{className:"mb",children:[te.jsx(y,{type:"primary",disabled:0===i.length,onClick:o,children:"恢复"}),te.jsx(y,{danger:!0,disabled:0===i.length,onClick:()=>{Le({title:"确定彻底删除该问卷?",icon:te.jsx(h,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),te.jsx(P,{rowKey:e=>e._id,dataSource:r,columns:l,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{c(e)}}})]})]}),te.jsx("div",{className:"text-center color-blue",children:r.length>0&&te.jsx(Oe,{total:a})})]})},{Title:Ae}=f,Me=()=>{const{data:e={},loading:s}=Fe({isStar:!0}),{list:t=[],total:n=0}=e;return te.jsxs(te.Fragment,{children:[te.jsxs("div",{className:"flex",children:[te.jsx("div",{className:"flex-1",children:te.jsx(Ae,{level:3,children:"星标问卷"})}),te.jsx("div",{className:"flex-1 text-center",children:te.jsx(qe,{})})]}),te.jsxs("div",{className:"mb-5",children:[s&&te.jsx("div",{className:"text-center",children:te.jsx(_,{})}),!s&&0===t.length&&te.jsx(E,{description:"暂无数据"}),t.length>0&&t.map((e=>{const{_id:s}=e;return te.jsx(_e,{...e},s)}))]}),te.jsx("div",{className:"text-center color-blue",children:t.length>0&&te.jsx(Oe,{total:n})})]})},We=()=>{const{loading:e,questionData:s}=Te();return te.jsxs("div",{children:[te.jsx("p",{children:"编辑"}),e?te.jsx("p",{children:"loading"}):te.jsx("p",{children:JSON.stringify(s)})]})},Be=()=>{const{loading:e,questionData:s}=Te();return te.jsxs("div",{children:[te.jsx("p",{children:"Stat"}),e?te.jsx("p",{children:"loading"}):te.jsx("p",{children:JSON.stringify(s)})]})},{Title:Ue,Paragraph:$e}=f,He=()=>{const e=z();return te.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:te.jsxs("div",{className:"text-center",children:[te.jsx(Ue,{children:"问卷调查 | 在线投票"}),te.jsx($e,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),te.jsx("div",{className:"h-15 font-24",children:te.jsx(y,{className:"b-rounded-4",type:"primary",onClick:()=>e(Ze),children:"开始使用"})})]})})},{Title:Ke}=f,Je="USERNAME",Ve="PASSWORD";const Qe=()=>{const e=z(),[t]=b.useForm();s.useEffect((()=>{const{username:e,password:s}={username:localStorage.getItem(Je),password:localStorage.getItem(Ve)};t.setFieldsValue({username:e,password:s})}),[]);const{run:n}=$((async(e,s)=>{const t=await async function(e,s){const t={username:e,password:s};return await me.post("/api/user/login",t)}(e,s);return t}),{manual:!0,onSuccess(s){const{token:t=""}=s;!function(e){localStorage.setItem(le,e)}(t),g.success("登录成功"),e(Ze)}});return te.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[te.jsx("div",{children:te.jsxs(p,{children:[te.jsx(Ke,{level:2,children:te.jsx(l,{})}),te.jsx(Ke,{level:2,children:"登录"})]})}),te.jsx("div",{children:te.jsxs(b,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{const{username:s,password:t,remember:r}=e||{};n(s,t),r?function(e,s){localStorage.setItem(Je,e),localStorage.setItem(Ve,s)}(s,t):(localStorage.removeItem(Je),localStorage.removeItem(Ve))},children:[te.jsx(b.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:te.jsx(S,{})}),te.jsx(b.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:te.jsx(S.Password,{})}),te.jsx(b.Item,{name:"remember",valuePropName:"checked",wrapperCol:{offset:0,span:10},children:te.jsx(R,{children:"记住我"})}),te.jsx(b.Item,{wrapperCol:{offset:4,span:18},children:te.jsxs(p,{children:[te.jsx(y,{type:"primary",htmlType:"submit",children:"登录"}),te.jsx(F,{to:Xe,children:"注册新用户"})]})})]})})]})},Ye=W([{path:"/",element:te.jsx(ge,{}),children:[{path:"/",element:te.jsx(He,{})},{path:"login",element:te.jsx(Qe,{})},{path:"register",element:te.jsx(ke,{})},{path:"manage",element:te.jsx(be,{}),children:[{path:"list",element:te.jsx(Re,{})},{path:"star",element:te.jsx(Me,{})},{path:"trash",element:te.jsx(De,{})}]},{path:"*",element:te.jsx(Ie,{})}]},{path:"question",element:te.jsx(Se,{}),children:[{path:"edit/:id",element:te.jsx(We,{})},{path:"stat/:id",element:te.jsx(Be,{})}]}],{basename:"/survey-sage"}),Ge="/login",Xe="/register",Ze="/manage/list",es=()=>te.jsx(O,{theme:{algorithm:T.defaultAlgorithm},children:te.jsx(B,{router:Ye})});ne.createRoot(document.getElementById("root")).render(te.jsx(u.StrictMode,{children:te.jsx(es,{})}));export{e as __vite_legacy_guard};
