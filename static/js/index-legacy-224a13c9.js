System.register(["./@ant-design/icons-legacy-404cf72d.js","./@dnd-kit/core-legacy-59a50052.js","./react-redux-legacy-c016a398.js","./@reduxjs/toolkit-legacy-4c21445c.js","./@dnd-kit/sortable-legacy-9f74e3d0.js","./lodash-es-legacy-e3523841.js","./redux-undo-legacy-f3ba457c.js","./react-router-dom-legacy-c95831a5.js","./antd-legacy-40b490eb.js","./axios-legacy-787fab56.js","./ahooks-legacy-513b183b.js","./recharts-legacy-885002d2.js","./@dnd-kit/utilities-legacy-d74627d0.js"],(function(e,t){"use strict";var s,n,l,r,i,a,c,o,d,x,m,u,h,p,j,g,f,v,y,b,C,w,k,I,N,S,P,_,F,E,L,V,q,T,R,z,D,$,A,H,O,U,B,M,K,W,G,J,Y,Q,X,Z,ee,te,se,ne,le,re,ie,ae,ce,oe,de,xe,me,ue,he,pe,je,ge,fe,ve,ye,be,Ce,we,ke,Ie,Ne,Se,Pe,_e,Fe,Ee,Le,Ve,qe,Te,Re,ze,De,$e,Ae,He,Oe,Ue,Be,Me,Ke,We;return{setters:[e=>{s=e.r,n=e.af,l=e.ag,r=e.U,i=e.M,a=e.ah,c=e.ai,o=e.aj,d=e.ad,x=e.ak,m=e.ae,u=e.al,h=e.W,p=e.am,j=e.an,g=e.ao,f=e.K,v=e.ap,y=e.aq,b=e.L,C=e.O,w=e.ar,k=e.z,I=e.as,N=e.at,S=e.au,P=e.av,_=e.R},e=>{F=e.r,E=e.d,L=e.e,V=e.D,q=e.f,T=e.M},e=>{R=e.u,z=e.a,D=e.P},e=>{$=e.c,A=e.p,H=e.a,O=e.n},e=>{U=e.a,B=e.S,M=e.v,K=e.u},e=>{W=e.c},e=>{G=e.C,J=e.D,Y=e.M},e=>{Q=e.L,X=e.u,Z=e.a,ee=e.b,te=e.c,se=e.O,ne=e.d,le=e.R},e=>{re=e.S,ie=e.m,ae=e.B,ce=e.L,oe=e.a,de=e.D,xe=e.F,me=e.I,ue=e.T,he=e.R,pe=e.b,je=e.P,ge=e.M,fe=e.E,ve=e.c,ye=e.d,be=e.e,Ce=e.C,we=e.f,ke=e.g,Ie=e.h,Ne=e.i,Se=e.j,Pe=e.Q,_e=e.k,Fe=e.t},e=>{Ee=e.a},e=>{Le=e.F,Ve=e.G,qe=e.H,Te=e.I,Re=e.J},e=>{ze=e.R,De=e.B,$e=e.C,Ae=e.X,He=e.Y,Oe=e.T,Ue=e.a,Be=e.P,Me=e.b,Ke=e.c},e=>{We=e.C}],execute:function(){var e=document.createElement("style");e.textContent='#--unocss--{layer:__ALL__}:root{--w-space-xs: 8px;--w-space-sm: 16px;--w-space: 24px;--w-space-lg: 32px;--w-radius-xs: 4px;--w-radius: 8px;--w-radius-lg: 12px;--w-radius-xl: 16px;--c-white: #fff;--c-black: #000;--c-blue: #3b82f6;--c-red: #ef4444;--c-yellow: #f59e0b;--c-green: #42b983;--c-gray: #9ca3af;--c-disable: rgba(0, 0, 0, .25);--c-brand: var(--c-green);--c-bg: #f8f8f8;--c-text: #374151;--c-tips: var(--c-gray);--c-border: var(--c-gray);--c-mask: rgba(0, 0, 0, .7);--c-hover: var(--c-brand)}:root.dark{--c-bg: #181818;--c-text: #e5e7eb}html{width:100%;overflow-x:hidden}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:"tnum";font-variant:tabular-nums;background-color:var(--c-bg);margin:0}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-thumb{background-color:#374151;border-radius:4px}::-webkit-scrollbar-thumb:hover{background-color:#1f2937}::-webkit-scrollbar-track{background-color:#6b7280;border-radius:4px}\n',document.head.appendChild(e);var t={exports:{}},Ge={},Je=s,Ye=Symbol.for("react.element"),Qe=Symbol.for("react.fragment"),Xe=Object.prototype.hasOwnProperty,Ze=Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,et={key:!0,ref:!0,__self:!0,__source:!0};function tt(e,t,s){var n,l={},r=null,i=null;for(n in void 0!==s&&(r=""+s),void 0!==t.key&&(r=""+t.key),void 0!==t.ref&&(i=t.ref),t)Xe.call(t,n)&&!et.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===l[n]&&(l[n]=t[n]);return{$$typeof:Ye,type:e,key:r,ref:i,props:l,_owner:Ze.current}}Ge.Fragment=Qe,Ge.jsx=tt,Ge.jsxs=tt,t.exports=Ge;var st=t.exports,nt={},lt=F;nt.createRoot=lt.createRoot,nt.hydrateRoot=lt.hydrateRoot;const rt={username:"",nickname:""},it=$({name:"user",initialState:rt,reducers:{loginReducer:(e,t)=>t.payload,logoutReducer:()=>rt}}),at=it.reducer,{loginReducer:ct,logoutReducer:ot}=it.actions,dt=$({name:"pageInfo",initialState:{title:"",desc:"",js:"",css:""},reducers:{resetPageInfo:(e,t)=>t.payload,changePageTitle:A(((e,t)=>{e.title=t.payload}))}}),xt=dt.reducer,{resetPageInfo:mt,changePageTitle:ut}=dt.actions;let ht=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"");function pt(e,t){const s=t.filter((e=>!e.isHidden)),n=s.findIndex((t=>t.fe_id===e));if(n<0)return"";let l="";const r=s.length;return l=r<=1?"":n+1===r?s[n-1].fe_id:s[n+1].fe_id,l}function jt(e,t){const{selectedId:s,componentList:n}=e,l=n.findIndex((e=>e.fe_id===s));l<0?e.componentList.push(t):e.componentList.splice(l+1,0,t),e.selectedId=t.fe_id}const gt=$({name:"components",initialState:{componentList:[],selectedId:"",copiedComponent:null},reducers:{resetComponents:(e,t)=>t.payload,changeSelectedId:A(((e,t)=>{e.selectedId=t.payload})),addComponent:A(((e,t)=>{jt(e,t.payload)})),changeComponentProps:A(((e,t)=>{const{fe_id:s,newProps:n}=t.payload,l=e.componentList.find((e=>e.fe_id===s));l&&(l.props={...l.props,...n})})),removeSelectedComponent:A((e=>{const{componentList:t=[],selectedId:s}=e,n=pt(s,t);e.selectedId=n;const l=t.findIndex((e=>e.fe_id===s));t.splice(l,1)})),changeComponentHidden:A(((e,t)=>{const{componentList:s=[]}=e,{fe_id:n,isHidden:l}=t.payload;let r="";r=l?pt(n,s):n,e.selectedId=r;const i=s.find((e=>e.fe_id===n));i&&(i.isHidden=l)})),toggleComponentLocked:A(((e,t)=>{const{fe_id:s}=t.payload,n=e.componentList.find((e=>e.fe_id===s));n&&(n.isLocked=!n.isLocked)})),copySelectedComponent:A((e=>{const{selectedId:t,componentList:s=[]}=e,n=s.find((e=>e.fe_id===t));null!=n&&(e.copiedComponent=W(n))})),pasteCopiedComponent:A((e=>{const{copiedComponent:t}=e;null!=t&&(t.fe_id=ht(),jt(e,t))})),selectPrevComponent:A((e=>{const{selectedId:t,componentList:s}=e,n=s.findIndex((e=>e.fe_id===t));n<0||n<=0||(e.selectedId=s[n-1].fe_id)})),selectNextComponent:A((e=>{const{selectedId:t,componentList:s}=e,n=s.findIndex((e=>e.fe_id===t));n<0||n+1!==s.length&&(e.selectedId=s[n+1].fe_id)})),changeComponentTitle:A(((e,t)=>{const{title:s,fe_id:n}=t.payload,l=e.componentList.find((e=>e.fe_id===n));l&&(l.title=s)})),moveComponent:A(((e,t)=>{const{componentList:s}=e,{oldIndex:n,newIndex:l}=t.payload;e.componentList=U(s,n,l)}))}}),{resetComponents:ft,changeSelectedId:vt,addComponent:yt,changeComponentProps:bt,removeSelectedComponent:Ct,changeComponentHidden:wt,toggleComponentLocked:kt,copySelectedComponent:It,pasteCopiedComponent:Nt,selectPrevComponent:St,selectNextComponent:Pt,changeComponentTitle:_t,moveComponent:Ft}=gt.actions,Et=gt.reducer,Lt=H({reducer:{user:at,pageInfo:xt,components:G(Et,{limit:20,filter:J(["components/resetComponents","components/changeSelectedId","components/selectPrevComponent","components/selectNextComponent"])})}}),Vt=()=>st.jsx("div",{children:st.jsx(Q,{to:"/",children:st.jsx(re,{children:st.jsxs("div",{className:"text-7 color-white",children:[st.jsx(n,{}),st.jsx("span",{children:"问卷调查"})]})})})}),qt="keyword",Tt="page",Rt="pageSize",zt=["#FF2D2D","#BE77FF","#2894FF","#00EC00","#EAC100","#FF9D6F"],Dt=Ee.create({timeout:1e4,baseURL:"https://huy.wiki:3002/"});Dt.interceptors.request.use((e=>(e.headers.Authorization=`Bearer ${localStorage.getItem($t)||""}`,e)),(e=>(ie.error(e.message),Promise.reject(e)))),Dt.interceptors.response.use((e=>{const t=e.data||{},{errno:s,data:n,msg:l}=t;return 203===s||0!==s&&200!==s?(ie.error(l||"请求失败"),Promise.reject(n)):n}),(e=>{let t="";const s=e.response?.status;switch(s){case 401:t="token 失效，请重新登录";break;case 403:t="拒绝访问";break;case 404:t="请求地址错误";break;case 500:t="服务器故障";break;default:t="网络连接故障"}return ie.error(t),Promise.reject(e)}));const $t="USER_TOKEN",At=()=>document.activeElement===document.body;function Ht(){const e=z((e=>e.components.present)),{componentList:t=[],selectedId:s,copiedComponent:n}=e,l=t.find((e=>e.fe_id===s));return{componentList:t,selectedId:s,selectedComponent:l,copiedComponent:n}}function Ot(){return z((e=>e.pageInfo))}function Ut(){const{username:e,nickname:t}=z((e=>e.user));return{username:e,nickname:t}}async function Bt(){return await Dt.post("/api/question/")}async function Mt(e={}){return await Dt.get("/api/question",{params:e})}async function Kt(e,t){const s=`/api/question/${e}`;return await Dt.patch(s,t)}async function Wt(){return await Dt.get("/api/user/info")}function Gt(){const{id:e=""}=X(),t=R(),{data:n,loading:l,error:r,run:i}=Ve((async e=>{if(!e)throw new Error("缺少问卷 id");const t=await async function(e){const t=`/api/question/${e}`;return await Dt.get(t)}(e);return t}),{manual:!0});return s.useEffect((()=>{if(!n)return;const{title:e="",desc:s="",js:l="",css:r="",componentList:i=[]}=n;let a="";i.length>0&&(a=i[0].fe_id),t(ft({componentList:i,selectedId:a,copiedComponent:null})),t(mt({title:e,desc:s,js:l,css:r}))}),[n]),s.useEffect((()=>{i(e)}),[e]),{loading:l,error:r}}function Jt(e={}){const{isStar:t,isDeleted:s}=e,[n]=Z(),{data:l,loading:r,error:i,refresh:a}=Ve((async()=>{const e=n.get(qt)||"",l=parseInt(n.get(Tt)||"")||1,r=parseInt(n.get(Rt)||"")||10;return await Mt({keyword:e,isStar:t,isDeleted:s,page:l,pageSize:r})}),{refreshDeps:[n]});return{data:l,loading:r,error:i,refresh:a}}function Yt(){const e=R(),[t,n]=s.useState(!0),{run:l}=Ve(Wt,{manual:!0,onSuccess(t){const{username:s,nickname:n}=t;e(ct({username:s,nickname:n}))},onFinally(){n(!1)}}),{username:r}=Ut();return s.useEffect((()=>{r?n(!1):l()}),[t]),{waitingUserData:t}}function Qt(e){const{username:t}=Ut(),{pathname:n}=ee(),l=te();s.useEffect((()=>{e||(t?function(e){return[Vn,qn].includes(e)}(n)&&l(Tn):function(e){return[Ln,Vn,qn].includes(e)}(n)||l(Vn))}),[e,t,n])}const Xt=()=>{const e=te(),t=R(),{username:s,nickname:n}=Ut(),r=st.jsxs(st.Fragment,{children:[st.jsxs("span",{className:"color-light",children:[st.jsx(l,{}),n]}),st.jsx(ae,{type:"link",onClick:function(){t(ot()),localStorage.removeItem($t),ie.success("退出成功"),e(Vn)},children:"退出"})]}),i=st.jsx(Q,{to:Vn,children:"登录"});return st.jsx(st.Fragment,{children:s?r:i})},{Header:Zt,Content:es,Footer:ts}=ce,ss=()=>{const{waitingUserData:e}=Yt();return Qt(e),st.jsxs(ce,{children:[st.jsxs(Zt,{className:"px-6",children:[st.jsx("div",{className:"float-left",children:st.jsx(Vt,{})}),"MainLayout header",st.jsx("div",{className:"float-right",children:st.jsx(Xt,{})})]}),st.jsx(es,{className:"min-h-[calc(100vh-140px)]",children:e?st.jsx("div",{className:"mt-15 text-center",children:st.jsx(oe,{})}):st.jsx(se,{})}),st.jsx(ts,{className:"border-t border-gray-200 border-solid bg-white text-center",children:"问卷调查 ©2023 - present. Created by Huy"})]})},ns=()=>{const e=te(),{pathname:t}=ee(),{loading:s,run:n}=Ve(Bt,{manual:!0,onSuccess(t){e(`question/edit/${t.id}`),ie.success("创建成功")}});return st.jsxs("div",{className:"mx-auto my-0 w-300 flex py-6",children:[st.jsx("div",{className:"w-30",children:st.jsxs(re,{direction:"vertical",children:[st.jsx(ae,{type:"primary",size:"large",icon:st.jsx(r,{}),onClick:n,disabled:s,children:"新建问卷"}),st.jsx(de,{}),st.jsx(ae,{type:t.startsWith("/manage/list")?"default":"text",size:"large",icon:st.jsx(i,{}),onClick:()=>e("/manage/list"),children:"我的问卷"}),st.jsx(ae,{type:t.startsWith("/manage/star")?"default":"text",size:"large",icon:st.jsx(a,{}),onClick:()=>e("/manage/star"),children:"星标问卷"}),st.jsx(ae,{type:t.startsWith("/manage/trash")?"default":"text",size:"large",icon:st.jsx(c,{}),onClick:()=>e("/manage/trash"),children:"回收站"})]})}),st.jsx("div",{className:"ml-15 flex-1",children:st.jsx(se,{})})]})},ls=()=>{const{waitingUserData:e}=Yt();return Qt(e),st.jsx("div",{className:"h-screen",children:e?st.jsx("div",{className:"mt-15 text-center",children:st.jsx(oe,{})}):st.jsx(se,{})})},{Title:rs}=ue,is=()=>{const e=te(),{run:t}=Ve((async e=>{const{username:t,password:s,nickname:n}=e;await async function(e,t,s){const n={username:e,password:t,nickname:s||e};return await Dt.post("/api/user/register",n)}(t,s,n)}),{manual:!0,onSuccess(){ie.success("注册成功"),e(Vn)}});return st.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[st.jsx("div",{children:st.jsxs(re,{children:[st.jsx(rs,{level:2,children:st.jsx(o,{})}),st.jsx(rs,{level:2,children:"注册新用户"})]})}),st.jsx("div",{children:st.jsxs(xe,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{t(e)},children:[st.jsx(xe.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:st.jsx(me,{})}),st.jsx(xe.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:st.jsx(me.Password,{})}),st.jsx(xe.Item,{label:"确认密码",name:" confirm",rules:[{required:!0,message:"请输入密码"},({getFieldValue:e})=>({validator:(t,s)=>s&&e("password")!==s?Promise.reject(new Error("两次密码不一致")):Promise.resolve()})],children:st.jsx(me.Password,{})}),st.jsx(xe.Item,{label:"昵称",name:"nickname",children:st.jsx(me,{})}),st.jsx(xe.Item,{wrapperCol:{offset:4,span:18},children:st.jsxs(re,{children:[st.jsx(ae,{type:"primary",htmlType:"submit",children:"注册"}),st.jsx(Q,{to:Vn,children:"已有账户，请登录"})]})})]})})]})},as=()=>{const e=te();return st.jsx(st.Fragment,{children:st.jsx(he,{status:"404",title:"404",subTitle:"抱歉，您访问的页面不存在",extra:st.jsx(ae,{type:"primary",onClick:()=>e(Tn),children:"返回首页"})})})},{confirm:cs}=ge,os=e=>{const t=te(),{_id:n,title:l,isPublished:r,answerContent:i,currentAt:o,isStar:h}=e,[p,j]=s.useState(h),{loading:g,run:f}=Ve((async()=>{await Kt(n,{isStar:!p})}),{manual:!0,onSuccess(){j(!p),ie.success("已更新")}}),{loading:v,run:y}=Ve((async()=>await async function(e){const t=`/api/question/duplicate/${e}`;return await Dt.post(t)}(n)),{manual:!0,onSuccess(e){ie.success("复制成功"),t(`/question/edit/${e.id}`)}}),[b,C]=s.useState(!1),{loading:w,run:k}=Ve((async()=>await Kt(n,{isDeleted:!0})),{manual:!0,onSuccess(){ie.success("删除成功"),C(!0)}});return b?null:st.jsxs("div",{className:"mb-2.5 border-rounded bg-white p-3 transition-transform hover:scale-105 hover:transform hover:shadow-md",children:[st.jsxs("div",{className:"flex",children:[st.jsx("div",{className:"flex-1",children:st.jsx(Q,{to:r?`/question/stat/${n}`:`/question/edit/${n}`,children:st.jsxs(re,{children:[h&&st.jsx(a,{style:{color:"red"}}),l]})})}),st.jsx("div",{className:"flex-1 text-center font-size-3",children:st.jsxs(re,{children:[r?st.jsx(pe,{color:"processing",children:"已发布"}):st.jsx(pe,{children:"未发布"}),st.jsxs("span",{children:["答卷: ",i]}),st.jsx("span",{children:o})]})})]}),st.jsx(de,{className:"m-3"}),st.jsxs("div",{className:"flex",children:[st.jsx("div",{className:"flex-1",children:st.jsxs(re,{children:[st.jsx(ae,{icon:st.jsx(d,{}),type:"text",size:"small",onClick:()=>{t(`/question/edit/${n}`)},children:"编辑问卷"}),st.jsx(ae,{icon:st.jsx(x,{}),type:"text",size:"small",onClick:()=>{t(`/question/stat/${n}`)},children:"数据统计"})]})}),st.jsx("div",{className:"flex-1 text-center",children:st.jsxs(re,{children:[st.jsx(ae,{type:"text",icon:st.jsx(a,{}),color:"#999",size:"small",onClick:f,disabled:g,children:p?"取消标星":"标星"}),st.jsx(je,{title:"确定复制该问卷?",okText:"确认",cancelText:"取消",onConfirm:y,children:st.jsx(ae,{type:"text",icon:st.jsx(m,{}),color:"#999",size:"small",disabled:v,children:"复制"})}),st.jsx(ae,{type:"text",icon:st.jsx(c,{}),size:"small",color:"#999",onClick:()=>{cs({title:"确定删除该问卷?",icon:st.jsx(u,{}),onOk:k})},disabled:w,children:"删除"})]})})]})]})},{Search:ds}=me,xs=()=>{const e=te(),{pathname:t}=ee(),[n,l]=s.useState(""),[r]=Z();return s.useEffect((()=>{const e=r.get(qt)||"";l(e)}),[r]),st.jsx(ds,{placeholder:"请输入关键字",value:n,onChange:function(e){l(e.target.value)},onSearch:function(s){e({pathname:t,search:`${qt}=${s}`})},className:"w-50"})},{Title:ms}=ue,us=()=>{const[e,t]=s.useState(!1),[n,l]=s.useState(1),[r,i]=s.useState([]),[a,c]=s.useState(0),o=a>r.length,[d]=Z(),x=d.get(qt)||"";s.useEffect((()=>{t(!1),l(1),i([]),c(0)}),[x]);const{run:m,loading:u}=Ve((async()=>await Mt({page:n,pageSize:10,keyword:x})),{manual:!0,onSuccess(e){const{list:t=[],total:s=0}=e;i(r.concat(t)),c(s),l(n+1)}}),h=s.useRef(null),{run:p}=qe((()=>{const e=h.current;if(null==e)return;const s=e.getBoundingClientRect();if(null==s)return;const{bottom:n}=s;n<=document.body.clientHeight&&(m(),t(!0))}),{wait:1e3});s.useEffect((()=>{p()}),[d]),s.useEffect((()=>(o&&window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)})),[d,o]);const j=s.useMemo((()=>!e||u?st.jsx(oe,{}):0===a?st.jsx(fe,{description:"暂无数据"}):o?st.jsx("span",{children:"开始加载下一页"}):st.jsx("span",{children:"没有更多了..."})),[e,u,o]);return st.jsxs(st.Fragment,{children:[st.jsxs("div",{className:"flex",children:[st.jsx("div",{className:"flex-1",children:st.jsx(ms,{level:3,children:"我的问卷"})}),st.jsx("div",{className:"flex-1 text-center",children:st.jsx(xs,{})})]}),st.jsx("div",{className:"mb-5",children:r.length>0&&r.map((e=>{const{_id:t}=e;return st.jsx(os,{...e},t)}))}),st.jsx("div",{className:"text-center color-blue",children:st.jsx("div",{ref:h,children:j})})]})},hs=e=>{const{total:t}=e,[n,l]=s.useState(1),[r,i]=s.useState(10),[a]=Z();s.useEffect((()=>{const e=parseInt(a.get(Tt)||"")||1;l(e);const t=parseInt(a.get(Rt)||"")||10;i(t)}),[a]);const c=te(),{pathname:o}=ee();return st.jsx(ve,{current:n,pageSize:r,total:t,onChange:(e,t)=>{a.set(Tt,e.toString()),a.set(Rt,t.toString()),c({pathname:o,search:a.toString()})}})},{Title:ps}=ue,{confirm:js}=ge,gs=()=>{Te("问卷调查");const{data:e={},loading:t,refresh:n}=Jt({isDeleted:!0}),{list:l=[],total:r=0}=e,[i,a]=s.useState([]),c=[{title:"标题",dataIndex:"title"},{title:"是否发布",dataIndex:"isPublished",render:e=>e?st.jsx(pe,{color:"processing",children:"已发布"}):st.jsx(pe,{children:"未发布"})},{title:"答卷",dataIndex:"answerCount"},{title:"创建时间",dataIndex:"createdAt"}],{run:o}=Ve((async()=>{for await(const e of i)await Kt(e,{isDeleted:!1})}),{manual:!0,debounceWait:500,onSuccess(){ie.success("恢复成功"),n(),a([])}}),{run:d}=Ve((async()=>await async function(e){return await Dt.delete("/api/question",{data:{ids:e}})}(i)),{manual:!0,onSuccess(){ie.success("删除成功"),n(),a([])}});return st.jsxs(st.Fragment,{children:[st.jsxs("div",{className:"flex",children:[st.jsx("div",{className:"flex-1",children:st.jsx(ps,{level:3,children:"回收站"})}),st.jsx("div",{className:"flex-1 text-center",children:st.jsx(xs,{})})]}),st.jsxs("div",{className:"mb-5",children:[t&&st.jsx("div",{className:"text-center",children:st.jsx(oe,{})}),!t&&0===l.length&&st.jsx(fe,{description:"暂无数据"}),l.length>0&&st.jsxs("div",{children:[st.jsxs(re,{className:"mb",children:[st.jsx(ae,{type:"primary",disabled:0===i.length,onClick:o,children:"恢复"}),st.jsx(ae,{danger:!0,disabled:0===i.length,onClick:()=>{js({title:"确定彻底删除该问卷?",icon:st.jsx(u,{}),content:"删除以后不可撤回",onOk:d})},children:"彻底删除"})]}),st.jsx(ye,{rowKey:e=>e._id,dataSource:l,columns:c,pagination:!1,rowSelection:{type:"checkbox",onChange:e=>{a(e)}}})]})]}),st.jsx("div",{className:"text-center color-blue",children:l.length>0&&st.jsx(hs,{total:r})})]})},{Title:fs}=ue,vs=()=>{const{data:e={},loading:t}=Jt({isStar:!0}),{list:s=[],total:n=0}=e;return st.jsxs(st.Fragment,{children:[st.jsxs("div",{className:"flex",children:[st.jsx("div",{className:"flex-1",children:st.jsx(fs,{level:3,children:"星标问卷"})}),st.jsx("div",{className:"flex-1 text-center",children:st.jsx(xs,{})})]}),st.jsxs("div",{className:"mb-5",children:[t&&st.jsx("div",{className:"text-center",children:st.jsx(oe,{})}),!t&&0===s.length&&st.jsx(fe,{description:"暂无数据"}),s.length>0&&s.map((e=>{const{_id:t}=e;return st.jsx(os,{...e},t)}))]}),st.jsx("div",{className:"text-center color-blue",children:s.length>0&&st.jsx(hs,{total:n})})]})},ys=()=>{const e=R(),{selectedId:t,componentList:s,selectedComponent:n,copiedComponent:l}=Ht(),r=s.findIndex((e=>e.fe_id===t)),i=r<=0,a=r+1>=s.length,o=n?.isLocked?"primary":"default",d=[{title:"删除",shape:"circle",icon:st.jsx(c,{}),onClick:()=>{e(Ct())}},{title:"隐藏",shape:"circle",icon:st.jsx(h,{}),onClick:()=>{e(wt({fe_id:t,isHidden:!0}))}},{title:"锁定",type:o,shape:"circle",icon:st.jsx(p,{}),onClick:()=>{e(kt({fe_id:t}))}},{title:"复制",shape:"circle",icon:st.jsx(m,{}),onClick:()=>{e(It())}},{title:"粘贴",shape:"circle",icon:st.jsx(j,{}),onClick:()=>{e(Nt())},disabled:null==l},{title:"上移",shape:"circle",icon:st.jsx(g,{}),onClick:()=>{i||e(Ft({oldIndex:r,newIndex:r-1}))},disabled:i},{title:"下移",shape:"circle",icon:st.jsx(f,{}),onClick:()=>{a||e(Ft({oldIndex:r,newIndex:r+1}))},disabled:a},{title:"撤销",shape:"circle",icon:st.jsx(v,{}),onClick:()=>{e(Y.undo())}},{title:"重做",shape:"circle",icon:st.jsx(y,{}),onClick:()=>{e(Y.redo())}}];return st.jsx(re,{children:d.map((e=>{const{title:t,type:s,shape:n,icon:l,onClick:r,disabled:i}=e;return st.jsx(be,{title:t,children:st.jsx(ae,{type:s,shape:n,icon:l,onClick:r,disabled:i})},t)}))})},bs=()=>{const{title:e}=Ot(),t=R(),[n,l]=s.useState(!1),r=e=>{const s=e.target.value.trim();s&&t(ut(s))};return n?st.jsx(me,{value:e,onChange:r,onPressEnter:()=>l(!1),onBlur:()=>l(!1)}):st.jsxs(re,{children:[st.jsx("div",{children:e}),st.jsx(ae,{icon:st.jsx(d,{}),type:"text",onClick:()=>l(!0)})]})},Cs=()=>{const{id:e}=X(),{componentList:t=[]}=Ht(),s=Ot(),{loading:n,run:l}=Ve((async()=>{e&&await Kt(e,{...s,componentList:t})}),{manual:!0});return Le(["ctrl.s","meta.s"],(e=>{e.preventDefault(),n||l()})),Re((()=>{l()}),[t,s],{wait:1e3}),st.jsx(ae,{onClick:l,disabled:n,icon:n?st.jsx(b,{}):null,children:"保存"})},ws=()=>{const e=te(),{id:t}=X(),{componentList:s=[]}=Ht(),n=Ot(),{loading:l,run:r}=Ve((async()=>{t&&await Kt(t,{...n,componentList:s,isPublished:!0})}),{manual:!0,onSuccess(){ie.success("发布成功"),e("/question/stat/"+t)}});return st.jsx(ae,{type:"primary",onClick:r,disabled:l,icon:l?st.jsx(b,{}):null,children:"发布"})},ks=()=>st.jsxs(re,{children:[st.jsx(Cs,{}),st.jsx(ws,{})]}),Is=()=>{const e=te();return st.jsxs("div",{className:"mx-6 flex border-b border-green-300 bg-white py-4",children:[st.jsx("div",{className:"flex-1",children:st.jsxs(re,{children:[st.jsx(ae,{type:"link",icon:st.jsx(C,{}),onClick:()=>e(-1),children:"返回"}),st.jsx("div",{className:"mb-0 text-[18px] leading-none",children:st.jsx(bs,{})})]})}),st.jsx("div",{className:"flex-1 text-center leading-[2]",children:st.jsx(ys,{})}),st.jsx("div",{className:"mr-3 flex-1 text-right leading-[2]",children:st.jsx(ks,{})})]})},Ns={title:"多选标题",isVertical:!1,list:[{value:"item1",text:"选项1",checked:!1},{value:"item2",text:"选项2",checked:!1},{value:"item3",text:"选项3",checked:!1}]},{Paragraph:Ss}=ue,Ps={title:"多选",type:"questionCheckbox",Component:e=>{const{title:t,isVertical:s,list:n=[]}={...Ns,...e};return st.jsxs("div",{children:[st.jsx(Ss,{strong:!0,children:t}),st.jsx(re,{direction:s?"vertical":"horizontal",children:n.map((e=>{const{value:t,text:s,checked:n}=e;return st.jsx(Ce,{value:t,checked:n,children:s},t)}))})]})},PropComponent:e=>{const{title:t,isVertical:s,list:n=[],onChange:l,disabled:i}=e,[a]=xe.useForm();return st.jsxs(xe,{layout:"vertical",form:a,initialValues:{title:t,isVertical:s,list:n},disabled:i,onValuesChange:()=>{if(null==l)return;const e=a.getFieldsValue();e.list&&(e.list=e.list.filter((e=>!(null==e.text))));const{list:t=[]}=e;t.forEach((e=>{e.value||(e.value=ht(5))})),l(e)},children:[st.jsx(xe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:st.jsx(me,{})}),st.jsx(xe.Item,{label:"选项",children:st.jsx(xe.List,{name:"list",children:(e,{add:t,remove:s})=>st.jsxs(st.Fragment,{children:[e.map((({key:e,name:t},n)=>st.jsxs(re,{align:"baseline",children:[st.jsx(xe.Item,{name:[t,"checked"],valuePropName:"checked",children:st.jsx(Ce,{})}),st.jsx(xe.Item,{name:[t,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,t)=>{const{list:s=[]}=a.getFieldsValue();let n=0;return s.forEach((e=>{e.text===t&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:st.jsx(me,{placeholder:"输入选项文字..."})}),n>0&&st.jsx(w,{onClick:()=>s(t)})]},e))),st.jsx(xe.Item,{children:st.jsx(ae,{type:"link",onClick:()=>t({text:"",value:"",checked:!1}),icon:st.jsx(r,{}),block:!0,children:"添加选项"})})]})})}),st.jsx(xe.Item,{name:"isVertical",valuePropName:"checked",children:st.jsx(Ce,{children:"竖向排列"})})]})},StatComponent:({stat:e})=>st.jsx("div",{style:{width:"400px",height:"300px"},children:st.jsx(ze,{width:"100%",height:"100%",children:st.jsxs(De,{width:400,height:300,data:e,margin:{top:5,right:30,left:0,bottom:5},children:[st.jsx($e,{strokeDasharray:"3 3"}),st.jsx(Ae,{dataKey:"name"}),st.jsx(He,{}),st.jsx(Oe,{}),st.jsx(Ue,{dataKey:"count",fill:"#8884d8"})]})})}),defaultProps:Ns},_s={title:"问卷标题",desc:"问卷描述"},{Title:Fs,Paragraph:Es}=ue,{TextArea:Ls}=me,Vs={title:"问卷信息",type:"questionInfo",Component:e=>{const{title:t,desc:s=""}={..._s,...e},n=s.split("\n");return st.jsxs("div",{style:{textAlign:"center"},children:[st.jsx(Fs,{style:{fontSize:"24px"},children:t}),st.jsx(Es,{children:n.map(((e,t)=>st.jsxs("span",{children:[t>0&&st.jsx("br",{}),e]},t)))})]})},PropComponent:e=>{const{title:t,desc:n,onChange:l,disabled:r}=e,[i]=xe.useForm();return s.useEffect((()=>{i.setFieldsValue({title:t,desc:n})}),[t,n]),st.jsxs(xe,{layout:"vertical",initialValues:{title:t,desc:n},onValuesChange:function(){l&&l(i.getFieldsValue())},disabled:r,form:i,children:[st.jsx(xe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入问卷标题"}],children:st.jsx(me,{})}),st.jsx(xe.Item,{label:"描述",name:"desc",children:st.jsx(Ls,{})})]})},defaultProps:_s},qs={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Ts}=ue,Rs={title:"输入框",type:"questionInput",Component:e=>{const{title:t,placeholder:s}={...qs,...e};return st.jsxs("div",{children:[st.jsx(Ts,{strong:!0,children:t}),st.jsx("div",{children:st.jsx(me,{placeholder:s})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:l,disabled:r}=e,[i]=xe.useForm();return s.useEffect((()=>{i.setFieldsValue({title:t,placeholder:n})}),[t,n]),st.jsxs(xe,{layout:"vertical",initialValues:{title:t,placeholder:n},form:i,onValuesChange:function(){l&&l(i.getFieldsValue())},disabled:r,children:[st.jsx(xe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:st.jsx(me,{})}),st.jsx(xe.Item,{label:"Placeholder",name:"placeholder",children:st.jsx(me,{})})]})},defaultProps:qs},zs={text:"一行段落",isCenter:!1},{Paragraph:Ds}=ue,{TextArea:$s}=me,As={title:"段落",type:"questionParagraph",Component:e=>{const{text:t="",isCenter:s=!1}={...zs,...e},n=t.split("\n");return st.jsx(Ds,{style:{textAlign:s?"center":"start",marginBottom:"0"},children:n.map(((e,t)=>st.jsxs("span",{children:[t>0&&st.jsx("br",{}),e]},t)))})},PropComponent:e=>{const{text:t,isCenter:n,onChange:l,disabled:r}=e,[i]=xe.useForm();return s.useEffect((()=>{i.setFieldsValue({text:t,isCenter:n})}),[t,n]),st.jsxs(xe,{layout:"vertical",initialValues:{text:t,isCenter:n},onValuesChange:function(){l&&l(i.getFieldsValue())},disabled:r,form:i,children:[st.jsx(xe.Item,{label:"段落内容",name:"text",rules:[{required:!0,message:"请输入段落内容"}],children:st.jsx($s,{})}),st.jsx(xe.Item,{name:"isCenter",valuePropName:"checked",children:st.jsx(Ce,{children:"居中显示"})})]})},defaultProps:zs},Hs={title:"单选标题",isVertical:!1,options:[{value:"item1",text:"选项1"},{value:"item2",text:"选项2"},{value:"item3",text:"选项3"}],value:""},{Paragraph:Os}=ue,Us={title:"单选",type:"questionRadio",Component:e=>{const{title:t,options:s=[],value:n,isVertical:l}={...Hs,...e};return st.jsxs("div",{children:[st.jsx(Os,{strong:!0,children:t}),st.jsx(we.Group,{value:n,children:st.jsx(re,{direction:l?"vertical":"horizontal",children:s.map((e=>{const{value:t,text:s}=e;return st.jsx(we,{value:t,children:s},t)}))})})]})},PropComponent:e=>{const{title:t,isVertical:n,value:l,options:i=[],onChange:a,disabled:c}=e,[o]=xe.useForm();return s.useEffect((()=>{o.setFieldsValue({title:t,isVertical:n,value:l,options:i})}),[t,n,l,i]),st.jsxs(xe,{layout:"vertical",initialValues:{title:t,isVertical:n,value:l,options:i},onValuesChange:function(){if(null==a)return;const e=o.getFieldsValue();e.options&&(e.options=e.options.filter((e=>!(null==e.text))));const{options:t=[]}=e;t.forEach((e=>{e.value||(e.value=ht(5))})),a(e)},disabled:c,form:o,children:[st.jsx(xe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:st.jsx(me,{})}),st.jsx(xe.Item,{label:"选项",children:st.jsx(xe.List,{name:"options",children:(e,{add:t,remove:s})=>st.jsxs(st.Fragment,{children:[e.map((({key:e,name:t},n)=>st.jsxs(re,{align:"baseline",children:[st.jsx(xe.Item,{name:[t,"text"],rules:[{required:!0,message:"请输入选项文字"},{validator:(e,t)=>{const{options:s=[]}=o.getFieldsValue();let n=0;return s.forEach((e=>{e.text===t&&n++})),1===n?Promise.resolve():Promise.reject(new Error("和其他选项重复了"))}}],children:st.jsx(me,{placeholder:"输入选项文字..."})}),n>1&&st.jsx(w,{onClick:()=>s(t)})]},e))),st.jsx(xe.Item,{children:st.jsx(ae,{type:"link",onClick:()=>t({text:"",value:""}),icon:st.jsx(r,{}),block:!0,children:"添加选项"})})]})})}),st.jsx(xe.Item,{label:"默认选中",name:"value",children:st.jsx(ke,{value:l,options:i.map((({text:e,value:t})=>({value:t,label:e||""})))})}),st.jsx(xe.Item,{name:"isVertical",valuePropName:"checked",children:st.jsx(Ce,{children:"竖向排列"})})]})},defaultProps:Hs,StatComponent:({stat:e=[]})=>{const t=s.useMemo((()=>{let t=0;return e.forEach((e=>t+=e.count)),t}),[e]);return st.jsx("div",{style:{width:"300px",height:"400px"},children:st.jsx(ze,{width:"100%",height:"100%",children:st.jsxs(Be,{children:[st.jsx(Me,{dataKey:"count",data:e,cx:"50%",cy:"50%",outerRadius:50,fill:"#8884d8",label:e=>`${e.name}: ${function(e){return(100*e).toFixed(2)}(e.count/t)}%`,children:e.map(((e,t)=>st.jsx(Ke,{fill:zt[t]},t)))}),st.jsx(Oe,{})]})})})}},Bs={title:"输入框标题",placeholder:"请输入..."},{Paragraph:Ms}=ue,{TextArea:Ks}=me,Ws={title:"多行输入",type:"questionTextarea",Component:e=>{const{title:t,placeholder:s}={...Bs,...e};return st.jsxs("div",{children:[st.jsx(Ms,{strong:!0,children:t}),st.jsx("div",{children:st.jsx(Ks,{placeholder:s})})]})},PropComponent:e=>{const{title:t,placeholder:n,onChange:l,disabled:r}=e,[i]=xe.useForm();return s.useEffect((()=>{i.setFieldsValue({title:t,placeholder:n})}),[t,n]),st.jsxs(xe,{layout:"vertical",initialValues:{title:t,placeholder:n},form:i,onValuesChange:function(){l&&l(i.getFieldsValue())},disabled:r,children:[st.jsx(xe.Item,{label:"标题",name:"title",rules:[{required:!0,message:"请输入标题"}],children:st.jsx(me,{})}),st.jsx(xe.Item,{label:"Placeholder",name:"placeholder",children:st.jsx(me,{})})]})},defaultProps:Bs},Gs={text:"一级标题",level:1,isCenter:!1},{Title:Js}=ue,Ys={title:"标题",type:"questionTitle",Component:e=>{const{text:t="",level:s=1,isCenter:n=!1}={...Gs,...e};return st.jsx(Js,{level:s,style:{textAlign:n?"center":"start",marginBottom:"0",fontSize:(l=s,1===l?"24px":2===l?"20px":"16px")},children:t});var l},PropComponent:e=>{const{text:t,level:n,isCenter:l,onChange:r,disabled:i}=e,[a]=xe.useForm();return s.useEffect((()=>{a.setFieldsValue({text:t,level:n,isCenter:l})}),[t,n,l]),st.jsxs(xe,{form:a,layout:"vertical",onValuesChange:function(){r&&r(a.getFieldsValue())},initialValues:{text:t,level:n,isCenter:l},disabled:i,children:[st.jsx(xe.Item,{label:"标题内容",name:"text",rules:[{required:!0,message:"请输入标题内容"}],children:st.jsx(me,{})}),st.jsx(xe.Item,{label:"层级",name:"level",children:st.jsx(ke,{options:[{value:1,text:1},{value:2,text:2},{value:3,text:3}]})}),st.jsx(xe.Item,{name:"isCenter",valuePropName:"checked",children:st.jsx(Ce,{children:"居中显示"})})]})},defaultProps:Gs},Qs=[{groupId:"textGroup",groupName:"文本显示",components:[Vs,As,Ys]},{groupId:"inputGroup",groupName:"用户输入",components:[Rs,Ws]},{groupId:"chooseGroup",groupName:"用户选择",components:[Ps,Us]}],Xs=[Ps,Vs,Rs,As,Us,Ws,Ys];function Zs(e){return Xs.find((t=>t.type===e))}const{Title:en}=ue,tn=()=>st.jsx(st.Fragment,{children:Qs.map(((e,t)=>{const{groupId:n,groupName:l,components:r}=e;return st.jsxs("div",{children:[st.jsx(en,{level:3,style:{fontSize:"16px",marginTop:t>0?"20px":"0"},children:l}),st.jsx("div",{children:r.map((e=>(e=>{const{title:t,type:n,Component:l,defaultProps:r}=e,i=R(),a=s.useCallback((()=>{i(yt({fe_id:ht(),title:t,type:n,props:r}))}),[]);return st.jsx("div",{onClick:a,className:"mb-3 cursor-pointer border border-light rounded border-solid bg-light p-3 hover:border-[#d9d9d9]",children:st.jsx("div",{className:"pointer-events-none",children:st.jsx(l,{})})},n)})(e)))})]},n)}))}),sn=e=>{const{children:t,items:s,onDragEnd:n}=e,l=E(L(T,{activationConstraint:{distance:8}}));return st.jsx(V,{sensors:l,collisionDetection:q,onDragEnd:e=>{const{active:t,over:l}=e;if(null!=l&&t.id!==l.id){const e=s.findIndex((e=>e.fe_id===t.id)),r=s.findIndex((e=>e.fe_id===l.id));n(e,r)}},children:st.jsx(B,{items:s,strategy:M,children:t})})},nn=({id:e,children:t})=>{const{attributes:s,listeners:n,setNodeRef:l,transform:r,transition:i}=K({id:e}),a={transform:We.Transform.toString(r),transition:i};return st.jsx("div",{ref:l,style:a,...s,...n,children:t})},ln=()=>{const{componentList:e,selectedId:t}=Ht(),n=R(),[l,r]=s.useState(""),i=e=>{const s=e.target.value.trim();s&&t&&n(_t({fe_id:t,title:s}))},a=e.map((e=>({...e,id:e.fe_id})));return st.jsx(sn,{items:a,onDragEnd:(e,t)=>{n(Ft({oldIndex:e,newIndex:t}))},children:e.map((s=>{const{fe_id:a,title:c,isHidden:o,isLocked:d}=s,x=k({"flex-auto line-height-loose":!0,"color-blue":a===t}),m="opacity-20",u=k({[m]:o}),j=k({[m]:o});return st.jsx(nn,{id:a,children:st.jsxs("div",{className:"flex border-b border-b-green-200 border-b-solid py-2",children:[st.jsxs("div",{className:x,onClick:()=>(s=>{const l=e.find((e=>e.fe_id===s));return l&&l.isHidden?ie.info("不能选中隐藏的组件!"):s!==t?(n(vt(s)),void r("")):void r(s)})(a),children:[a===l&&st.jsx(me,{value:c,onChange:i,onPressEnter:()=>r(""),onBlur:()=>r("")}),a!==l&&c]}),st.jsx("div",{className:"w-12 text-end",children:st.jsxs(re,{children:[st.jsx(ae,{size:"small",shape:"circle",className:u,icon:st.jsx(h,{}),type:o?"primary":"text",onClick:()=>((e,t)=>{n(wt({fe_id:e,isHidden:t}))})(a,!o)}),st.jsx(ae,{size:"small",shape:"circle",className:j,icon:st.jsx(p,{}),type:d?"primary":"text",onClick:()=>(e=>{n(kt({fe_id:e}))})(a)})]})})]})},a)}))})},rn=()=>{const e=[{key:"componentLib",label:st.jsxs("span",{children:[st.jsx(I,{}),"组件库"]}),children:st.jsx(tn,{})},{key:"layers",label:st.jsxs("span",{children:[st.jsx(i,{}),"图层"]}),children:st.jsx(ln,{})}];return st.jsx(st.Fragment,{children:st.jsx(Ie,{items:e,defaultActiveKey:"componentLib"})})},an=({loading:e})=>{const{componentList:t,selectedIs:s}=Ht(),n=R();if(function(){const e=R();Le(["backspace","delete"],(()=>{At()&&e(Ct())})),Le(["ctrl.c","meta.c"],(()=>{At()&&e(It())})),Le(["ctrl.v","meta.v"],(()=>{At()&&e(Nt())})),Le("uparrow",(()=>{At()&&e(St())})),Le("downarrow",(()=>{At()&&e(Pt())})),Le(["ctrl.z","meta.z"],(()=>{At()&&e(Y.undo())}),{exactMatch:!0}),Le(["ctrl.shift.z","meta.shift.z"],(()=>{At()&&e(Y.redo())}))}(),e)return st.jsx("div",{className:"mt-6 text-center",children:st.jsx(oe,{})});const l=e=>{const{type:t,props:s}=e,n=Zs(t);if(null==n)return null;const{Component:l}=n;return st.jsx(l,{...s})},r=t.map((e=>({...e,id:e.fe_id})));return st.jsx(sn,{items:r,onDragEnd:(e,t)=>{n(Ft({oldIndex:e,newIndex:t}))},children:st.jsx("div",{className:"min-h-[100%] overflow-hidden bg-white",children:t.map((e=>{const{fe_id:t}=e,s=k({"m-3 border border-white rounded-sm border-solid p-3 hover:border-gray-200":!0});return st.jsx(nn,{id:t,children:st.jsx("div",{className:s,onClick:e=>{return s=t,e.stopPropagation(),void n(vt(s));var s},children:st.jsx("div",{className:"pointer-events-none",children:l(e)})})},t)}))})})},cn=()=>st.jsx("div",{className:"text-center",children:"未选中组件"}),on=()=>{const e=R(),{selectedComponent:t}=Ht();if(null==t)return st.jsx(cn,{});const{type:s,props:n}=t,l=Zs(s);if(null==l)return st.jsx(cn,{});const{PropComponent:r}=l;return st.jsx(r,{...n,onChange:s=>{const{fe_id:n}=t;e(bt({fe_id:n,newProps:s}))}})},dn=()=>{const e=Ot(),[t]=xe.useForm(),s=R();return st.jsxs(xe,{layout:"vertical",initialValues:e,onValuesChange:()=>{s(mt(t.getFieldsValue()))},form:t,children:[st.jsx(xe.Item,{name:"title",label:"问卷标题",rules:[{required:!0,message:"请输入标题"}],children:st.jsx(me,{placeholder:"请输入标题"})}),st.jsx(xe.Item,{name:"desc",label:"问卷描述",children:st.jsx(Ne,{placeholder:"问卷描述信息"})}),st.jsx(xe.Item,{name:"css",label:"样式代码",children:st.jsx(Ne,{placeholder:"请输入 CSS 样式代码"})}),st.jsx(xe.Item,{name:"js",label:"脚本代码",children:st.jsx(Ne,{placeholder:"请输入 JS 脚本代码"})})]})},xn=()=>{const[e,t]=s.useState("prop"),{selectedId:n}=Ht();s.useEffect((()=>{t(n?"prop":"setting")}),[n]);const l=[{key:"prop",label:st.jsxs("span",{children:[st.jsx(N,{}),"属性"]}),children:st.jsx(on,{})},{key:"setting",label:st.jsxs("span",{children:[st.jsx(S,{}),"页面设置"]}),children:st.jsx(dn,{})}];return st.jsx(Ie,{activeKey:e,items:l})},mn=()=>{const e=R(),{loading:t}=Gt(),{title:s}=Ot();return Te(s?`问卷编辑 - ${s}`:"问卷调查"),st.jsxs("div",{className:"h-screen flex flex-col bg-[#f0f2f5]",children:[st.jsx(Is,{}),st.jsx("div",{className:"flex-1 py-3",children:st.jsxs("div",{className:"mx-6 h-100% flex",children:[st.jsx("div",{className:"w-75 bg-white px-3",children:st.jsx(rn,{})}),st.jsx("div",{className:"relative flex-1 overflow-hidden",onClick:()=>{e(vt(""))},children:st.jsx("div",{className:"absolute left-1/2 top-1/2 h-178 w-150 transform items-center justify-center overflow-auto shadow-2xl -translate-x-1/2 -translate-y-1/2",children:st.jsx(an,{loading:t})})}),st.jsx("div",{className:"w-75 bg-white px-3",children:st.jsx(xn,{})})]})})]})},un=()=>st.jsx("div",{className:"mt-15 text-center",children:st.jsx(oe,{})}),hn=()=>{const e=te();return st.jsx("div",{className:"flex-1",children:st.jsx(he,{status:"warning",title:"该页面尚未发布",extra:st.jsx(ae,{type:"primary",onClick:()=>e(-1),children:"返回"})})})},pn=()=>{const e=te(),{title:t}=Ot(),{id:n}=X(),l=s.useRef(null),r=s.useMemo((()=>{const e=`http://localhost:5173/survey-sage/question/${n}`,t=st.jsx("div",{className:"text-center",children:st.jsx(Pe,{value:e||"-"})});return st.jsxs(re,{children:[st.jsx(me,{value:e,style:{width:"300px"},ref:l}),st.jsx(be,{title:"拷贝链接",children:st.jsx(ae,{icon:st.jsx(m,{}),onClick:()=>{const t=l.current;if(null!=t){t.select();try{navigator.clipboard.writeText(e)}catch(s){}}}})}),st.jsx(Se,{content:t,children:st.jsx(ae,{icon:st.jsx(P,{})})})]})}),[n]);return st.jsx("div",{className:"border-coolGray border-b-solid bg-white py-3",children:st.jsxs("div",{className:"mx-6 flex",children:[st.jsx("div",{className:"flex-1",children:st.jsxs(re,{children:[st.jsx(ae,{type:"link",icon:st.jsx(C,{}),onClick:()=>{e(-1)},children:"返回"}),st.jsx("span",{className:"text-5 line-height-none",children:t})]})}),st.jsx("div",{className:"flex-1 text-center",children:r}),st.jsx("div",{className:"flex-1 text-right",children:st.jsx(ae,{type:"primary",onClick:()=>{e(`/question/edit/${n}`)},children:"编辑问卷"})})]})})},{Title:jn}=ue,gn=()=>st.jsx(st.Fragment,{children:Qs.map(((e,t)=>{const{groupId:n,groupName:l,components:r}=e;return st.jsxs("div",{children:[st.jsx(jn,{level:3,style:{fontSize:"16px",marginTop:t>0?"20px":"0"},children:l}),st.jsx("div",{children:r.map((e=>(e=>{const{title:t,type:n,Component:l,defaultProps:r}=e,i=R(),a=s.useCallback((()=>{i(yt({fe_id:O(),title:t,type:n,props:r}))}),[]);return st.jsx("div",{onClick:a,className:"mb-3 cursor-pointer rounded border-solid bg-white p-3 hover:border-cyan",children:st.jsx("div",{className:"pointer-events-none",children:st.jsx(l,{})})},n)})(e)))})]},n)}))}),fn=()=>st.jsx(st.Fragment,{children:"ComponentLayer"}),vn=()=>{const e=[{key:"componentLib",label:st.jsxs("span",{children:[st.jsx(I,{}),"组件库"]}),children:st.jsx(gn,{})},{key:"layers",label:st.jsxs("span",{children:[st.jsx(i,{}),"图层"]}),children:st.jsx(fn,{})}];return st.jsx(Ie,{defaultActiveKey:"componentLib",items:e})},yn=()=>st.jsx(st.Fragment,{children:"StatContainerCenter"}),bn=()=>{const[e,t]=s.useState("prop"),{selectedId:n}=Ht();s.useEffect((()=>{t(n?"prop":"setting")}),[n]);const l=[{key:"prop",label:st.jsxs("span",{children:[st.jsx(N,{}),"属性"]}),children:st.jsx("div",{children:"props"})},{key:"setting",label:st.jsxs("span",{children:[st.jsx(S,{}),"页面设置"]}),children:st.jsx("div",{children:"PageSetting"})}];return st.jsx(Ie,{activeKey:e,items:l})},Cn=()=>st.jsxs("div",{className:"mx-6 h-full flex",children:[st.jsx("div",{className:"w-73 bg-white px-3",children:st.jsx(vn,{})}),st.jsx("div",{className:"relative flex-1 overflow-hidden",children:st.jsx(yn,{})}),st.jsx("div",{className:"w-75 bg-white px-3",children:st.jsx(bn,{})})]}),wn=()=>{const{loading:e,questionData:t}=Gt(),{title:s,isPubulished:n}=Ot();return Te(`问卷调查 - ${s}`),n?st.jsx(hn,{}):st.jsxs("div",{className:"min-h-screen flex flex-col bg-cyan",children:[st.jsx(pn,{}),st.jsxs("div",{className:"flex-1 py-3",children:[e&&st.jsx(un,{}),!e&&st.jsx(Cn,{})]})]})},{Title:kn,Paragraph:In}=ue,Nn=()=>{const e=te();return st.jsx("div",{className:"h-150 flex flex-col items-center justify-center",children:st.jsxs("div",{className:"text-center",children:[st.jsx(kn,{children:"问卷调查 | 在线投票"}),st.jsx(In,{children:"已经累计创建问卷 500 份，发布问卷 80 份，收到答卷 2000 份"}),st.jsx("div",{className:"h-15 font-24",children:st.jsx(ae,{className:"b-rounded-4",type:"primary",onClick:()=>e(Tn),children:"开始使用"})})]})})},{Title:Sn}=ue,Pn="USERNAME",_n="PASSWORD",Fn=()=>{const e=te(),t=R(),[n]=xe.useForm();s.useEffect((()=>{const{username:e,password:t}={username:localStorage.getItem(Pn),password:localStorage.getItem(_n)};n.setFieldsValue({username:e,password:t})}),[]);const{run:l}=Ve((async(e,s)=>{const n=await async function(e,t){const s={username:e,password:t};return await Dt.post("/api/user/login",s)}(e,s);return n.token&&t(ct({username:e,nickname:e})),n}),{manual:!0,onSuccess(t){const{token:s=""}=t;!function(e){localStorage.setItem($t,e)}(s),ie.success("登录成功"),e(Tn)}});return st.jsxs("div",{className:"flex flex-col items-center justify-center bg-white",children:[st.jsx("div",{children:st.jsxs(re,{children:[st.jsx(Sn,{level:2,children:st.jsx(o,{})}),st.jsx(Sn,{level:2,children:"登录"})]})}),st.jsx("div",{children:st.jsxs(xe,{labelCol:{span:6},wrapperCol:{span:16},onFinish:e=>{const{username:t,password:s,remember:n}=e||{};l(t,s),n?function(e,t){localStorage.setItem(Pn,e),localStorage.setItem(_n,t)}(t,s):(localStorage.removeItem(Pn),localStorage.removeItem(_n))},children:[st.jsx(xe.Item,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"},{type:"string",min:5,max:20,message:"字符长度在 5-20 之间"},{pattern:/^\w+$/,message:"只能所字符下划线"}],children:st.jsx(me,{})}),st.jsx(xe.Item,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}],children:st.jsx(me.Password,{})}),st.jsx(xe.Item,{name:"remember",valuePropName:"checked",wrapperCol:{offset:0,span:10},children:st.jsx(Ce,{children:"记住我"})}),st.jsx(xe.Item,{wrapperCol:{offset:4,span:18},children:st.jsxs(re,{children:[st.jsx(ae,{type:"primary",htmlType:"submit",children:"登录"}),st.jsx(Q,{to:qn,children:"注册新用户"})]})})]})})]})},En=ne([{path:"/",element:st.jsx(ss,{}),children:[{path:"/",element:st.jsx(Nn,{})},{path:"login",element:st.jsx(Fn,{})},{path:"register",element:st.jsx(is,{})},{path:"manage",element:st.jsx(ns,{}),children:[{path:"list",element:st.jsx(us,{})},{path:"star",element:st.jsx(vs,{})},{path:"trash",element:st.jsx(gs,{})}]},{path:"*",element:st.jsx(as,{})}]},{path:"question",element:st.jsx(ls,{}),children:[{path:"edit/:id",element:st.jsx(mn,{})},{path:"stat/:id",element:st.jsx(wn,{})}]}],{basename:"/survey-sage"}),Ln="/",Vn="/login",qn="/register",Tn="/manage/list",Rn=()=>st.jsx(_e,{theme:{algorithm:Fe.defaultAlgorithm},children:st.jsx(le,{router:En})});nt.createRoot(document.getElementById("root")).render(st.jsx(_.StrictMode,{children:st.jsx(D,{store:Lt,children:st.jsx(Rn,{})})}))}}}));
